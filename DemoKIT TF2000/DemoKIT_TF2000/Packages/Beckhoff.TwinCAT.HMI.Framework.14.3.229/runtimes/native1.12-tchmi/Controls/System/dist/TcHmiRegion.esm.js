var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};const TcHmi=window.TcHmi,{EventHandler}=TcHmi;import{TcHmiControl}from"../dist/TcHmiControl.esm.js";import{TcHmiContent}from"../dist/TcHmiContent.esm.js";let partialContentManager;TCHMI_ENGINEERING&&import("../../../System/Engineering/dist/DesignerModePartialContentManager.js").then(module=>{partialContentManager=module.partialContentManager}).catch(ex=>{TcHmi.Log.errorEx("[Source=Control, Module=TcHmi.Controls.System.TcHmiRegion] Failed to load partialContentManager:",ex?.toString())});let TcHmiRegion=(()=>{var _a;let ___onContentCreated_decorators,___onContentRemoved_decorators,___onResized_decorators,___cleanUpPostAttach_decorators,_classSuper=TcHmiControl,_instanceExtraInitializers=[];return class TcHmiRegion extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onContentCreated_decorators=[EventHandler()],___onContentRemoved_decorators=[EventHandler()],___onResized_decorators=[EventHandler()],___cleanUpPostAttach_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],__esDecorate(this,null,___onContentCreated_decorators,{kind:"method",name:"__onContentCreated",static:!1,private:!1,access:{has:obj=>"__onContentCreated"in obj,get:obj=>obj.__onContentCreated},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onContentRemoved_decorators,{kind:"method",name:"__onContentRemoved",static:!1,private:!1,access:{has:obj=>"__onContentRemoved"in obj,get:obj=>obj.__onContentRemoved},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onResized_decorators,{kind:"method",name:"__onResized",static:!1,private:!1,access:{has:obj=>"__onResized"in obj,get:obj=>obj.__onResized},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___cleanUpPostAttach_decorators,{kind:"method",name:"__cleanUpPostAttach",static:!1,private:!1,access:{has:obj=>"__cleanUpPostAttach"in obj,get:obj=>obj.__cleanUpPostAttach},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.System."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs),TCHMI_ENGINEERING&&this.__destroyOnDestroy.push(TcHmi.EventProvider.register("System.onContentCreated",this.__onContentCreated),TcHmi.EventProvider.register("System.onContentRemoved",this.__onContentRemoved)),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(this.getId()+".onResized",this.__onResized));let spinnerDiv=this.__element[0].querySelector(".TcHmi_System_Controls_TcHmiRegion-loading-spinner-container");if(spinnerDiv)spinnerDiv.remove(),this.__processTargetMarkupLoadingSpinnerDiv=spinnerDiv;else{let loadingSpinnerDivTempDiv=document.createElement("div");loadingSpinnerDivTempDiv.innerHTML='<div class="TcHmi_System_Controls_TcHmiRegion-loading-spinner-container"><div class="TcHmi_System_Controls_TcHmiRegion-loading-spinner"><div></div><div></div><div></div><div></div></div></div>',this.__processTargetMarkupLoadingSpinnerDiv=loadingSpinnerDivTempDiv.firstElementChild}}__template=__runInitializers(this,_instanceExtraInitializers);__targetContent;__targetContentMarkup;__targetMarkup=null;__currentContent=null;__scaleMode;__scrolling;__elementTemplateRoot;__xhr;__destroyRequestCurrentPartialContents;__processTargetMarkupCompileTimeout=0;__processTargetMarkupCleanupOldTimeout=0;__processTargetMarkupLoadingSpinnerDiv;__processTargetMarkupOldContent=null;__processTargetMarkupOldContentOldOpacity;__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_System_TcHmiRegion-template"),0===this.__elementTemplateRoot.length&&(this.__elementTemplateRoot=this.__element.find(".tchmi-region-template")),0===this.__elementTemplateRoot.length)throw new Error("Invalid Template.html");super.__previnit()}__init(){super.__init(),this.__processScrolling(),this.__processScaleMode()}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){this.__keepAlive||(TcHmi.Engineering.ErrorPane.remove("E_REGION["+this.getId()+"]_CONTENT_ALREADY_USED"),this.__xhr&&(this.__xhr.abort(),this.__xhr=void 0),this.__cleanUpPostAttach(),this.__processTargetMarkupCompileTimeout&&(clearTimeout(this.__processTargetMarkupCompileTimeout),this.__processTargetMarkupCompileTimeout=0),this.__processTargetMarkupCleanupOldTimeout&&(clearTimeout(this.__processTargetMarkupCleanupOldTimeout),this.__processTargetMarkupCleanupOldTimeout=0),TCHMI_ENGINEERING&&this.__destroyRequestCurrentPartialContents&&(this.__destroyRequestCurrentPartialContents(),this.__destroyRequestCurrentPartialContents=void 0),this.__currentContent?.getKeepAlive()&&this.__removeChild(this.__currentContent),this.__processTargetMarkupOldContent=null,super.destroy())}__setKeepAlive(value){if(super.__setKeepAlive(value),this.__currentContent){let partialUrl=tchmi_path(this.__targetContent),partialKeepAliveConfig=!1;if(partialUrl&&!0===TcHmi.System.Data.isKeepAlivePartial.get(partialUrl)&&(partialKeepAliveConfig=!0),partialUrl&&this.__targetContentMarkup&&(partialKeepAliveConfig||this.__keepAlive)&&!TcHmi.System.Data.Caches.partialMarkupCache.has(this.__targetContentMarkup)){let tempDiv=document.createElement("div");tempDiv.innerHTML=this.__targetContentMarkup,tempDiv.firstElementChild&&TcHmi.System.Data.Caches.partialMarkupCache.set(partialUrl,{markup:this.__targetContentMarkup,partialId:tempDiv.firstElementChild.id})}!value&&partialKeepAliveConfig||this.__currentContent.__setKeepAlive(value)}}__tryContentRefresh(url,content){null===this.__targetContent||tchmi_path(url)!==tchmi_path(this.__targetContent)||null!=content&&this.__targetMarkup===content||(null!=content?this.__processTargetContent(content):this.__processTargetContent())}__onContentCreated(_event,data){this.__tryContentRefresh(data.url,null)}__onContentRemoved(_event,data){this.__tryContentRefresh(data.url,null)}__onResized(_event,ctrl){this.__asyncWorkData["System.TcHmiRegion.resized"]=!0,this.__requestAsyncWork()}__doAsyncWork(timestamp){super.__doAsyncWork(timestamp),this.__asyncWorkData["System.TcHmiRegion.resized"]&&(this.__asyncWorkData["System.TcHmiRegion.resized"]=!1,this.__processScrolling(),this.__processScaleMode())}__isRecursionSave(path){let tempParent=this.__parent;for(;null!==tempParent;){if(tempParent.getType()===TcHmiRegion.#tchmiFQN&&void 0!==tempParent.getTargetContent&&tchmi_path(tempParent.getTargetContent())===path)return tempParent=null,!1;tempParent=tempParent.getParent()}return!0}setWidthMode(valueNew){let convertedValue=TcHmi.ValueConverter.toSizeModeWithContent(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("WidthMode")),convertedValue!==this.__widthMode&&(this.__widthMode=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"WidthMode"}),this.__processWidthMode())}__processWidth(callerControl){if("Content"===this.getWidthMode()){let newWidthStr="";if(null!==this.__currentContent){const contentPixelSize=this.__currentContent.__getContentWidth();null!==contentPixelSize&&(newWidthStr=contentPixelSize.toFixed(3)+"px"),callerControl&&this.__currentContent===callerControl||"Content"!==this.__currentContent.getWidthMode()||this.__currentContent.__processWidth(this)}TcHmi.StyleProvider.setSimpleElementStyle(this.__element,"width",newWidthStr)}super.__processWidth(callerControl)}setHeightMode(valueNew){let convertedValue=TcHmi.ValueConverter.toSizeModeWithContent(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("HeightMode")),convertedValue!==this.__heightMode&&(this.__heightMode=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeightMode"}),this.__processHeightMode())}__processHeight(callerControl){if("Content"===this.__heightMode&&(this.__intHeight=null,null!==this.__currentContent)){const contentPixelSize=this.__currentContent.__getContentHeight();null!==contentPixelSize&&(this.__intHeight=contentPixelSize.toFixed(3)+"px"),callerControl&&this.__currentContent===callerControl||"Content"!==this.__currentContent.getHeightMode()||this.__currentContent.__processHeight(this)}super.__processHeight(callerControl)}__getContentWidth(){if("Collapsed"===this.__visibility)return null;let contentPixelSize=null;return"Content"!==this.getWidthMode()?contentPixelSize=super.__getContentWidth():null!==this.__currentContent&&(contentPixelSize=this.__currentContent.__getContentWidth()),TcHmi.Controls.limitPixelDimensionToControlBound(this,"width",contentPixelSize)}__getContentHeight(){if("Collapsed"===this.__visibility)return null;let contentPixelSize=null;return"Content"!==this.getHeightMode()?contentPixelSize=super.__getContentHeight():null!==this.__currentContent&&(contentPixelSize=this.__currentContent.__getContentHeight()),TcHmi.Controls.limitPixelDimensionToControlBound(this,"height",contentPixelSize)}setTargetContent(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TargetContent")),convertedValue=""===convertedValue?null:tchmi_path(convertedValue),convertedValue!==this.__targetContent&&(this.__targetContent=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TargetContent"}),this.__processTargetContent())}getTargetContent(){return this.__targetContent}__destroyAndRemoveTargetCtrl(objToDestroy){objToDestroy.getIsDestroyed()||objToDestroy.destroy(),this.__removeChild(objToDestroy)}__reportBenchmarkObject(benchmarkObj){const baseName=this.__id+" loads "+(benchmarkObj.targetContent??"null");performance.measure(baseName,{start:benchmarkObj.processStart,end:benchmarkObj.screenUpdated,detail:{htmlFetchTime:benchmarkObj.htmlFetchEnd-benchmarkObj.htmlFetchStart,compileTime:benchmarkObj.compileEnd-benchmarkObj.compileStart,addContentToDomTime:benchmarkObj.addContentToDomEnd-benchmarkObj.addContentToDomStart,syncAttach:benchmarkObj.syncAttachEnd-benchmarkObj.syncAttachStart,asyncAttach:benchmarkObj.asyncAttachEnd-benchmarkObj.asyncAttachStart,overallTime:benchmarkObj.screenUpdated-benchmarkObj.processStart,removeContentFromDomTime:benchmarkObj.removeContentFromDomEnd-benchmarkObj.removeContentFromDomStart}});try{isNaN(benchmarkObj.htmlFetchEnd)||performance.measure(baseName+":htmlfetch",{start:benchmarkObj.htmlFetchStart,end:benchmarkObj.htmlFetchEnd}),isNaN(benchmarkObj.compileEnd)||performance.measure(baseName+":compile",{start:benchmarkObj.compileStart,end:benchmarkObj.compileEnd}),isNaN(benchmarkObj.addContentToDomEnd)||performance.measure(baseName+":addContentToDom",{start:benchmarkObj.addContentToDomStart,end:benchmarkObj.addContentToDomEnd}),isNaN(benchmarkObj.syncAttachEnd)||performance.measure(baseName+":syncAttach",{start:benchmarkObj.syncAttachStart,end:benchmarkObj.syncAttachEnd}),isNaN(benchmarkObj.asyncAttachEnd)||performance.measure(baseName+":asyncAttach",{start:benchmarkObj.asyncAttachStart,end:benchmarkObj.asyncAttachEnd}),isNaN(benchmarkObj.removeContentFromDomEnd)||performance.measure(baseName+":removeContentFromDom",{start:benchmarkObj.removeContentFromDomStart,end:benchmarkObj.removeContentFromDomEnd})}catch(ex){}}__processTargetContent(override=null){TcHmi.Engineering.ErrorPane.remove("E_REGION["+this.getId()+"]_CONTENT_ALREADY_USED");const benchmarkObj={targetContent:this.__targetContent??null,processStart:NaN,htmlFetchStart:NaN,htmlFetchEnd:NaN,compileStart:NaN,compileEnd:NaN,addContentToDomStart:NaN,addContentToDomEnd:NaN,syncAttachStart:NaN,syncAttachEnd:NaN,asyncAttachStart:NaN,asyncAttachEnd:NaN,removeContentFromDomStart:NaN,removeContentFromDomEnd:NaN,screenUpdated:NaN};if(-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.processStart=performance.now()),this.__targetMarkup=null,!this.__targetContent)return this.__currentContent&&(-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.removeContentFromDomStart=performance.now()),this.__destroyAndRemoveTargetCtrl(this.__currentContent),this.__currentContent=null),void(-1===TCHMI_CONSOLE_LOG_LEVEL&&window.requestAnimationFrame(()=>{benchmarkObj.removeContentFromDomEnd=benchmarkObj.screenUpdated=performance.now(),this.__reportBenchmarkObject(benchmarkObj)}));const partialUrl=tchmi_path(this.__targetContent);let partialMarkup;if(this.__isRecursionSave(partialUrl)||TcHmi.Log.Controls.error(this,TcHmiRegion.#tchmiFQN,{Attribute:"TargetContent"},`Loading content=${this.__targetContent} was blocked to avoid recursion!`),-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.htmlFetchStart=performance.now()),partialMarkup=override?{markup:override}:TcHmi.System.Data.Caches.partialMarkupCache.get(partialUrl),partialMarkup)-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.htmlFetchEnd=performance.now()),this.__xhr&&this.__xhr.abort(),this.__targetContentMarkup=partialMarkup.markup,this.__processTargetMarkup(partialMarkup.partialId,benchmarkObj),partialMarkup=void 0;else if(TCHMI_ENGINEERING)partialContentManager?(this.__destroyRequestCurrentPartialContents&&(this.__destroyRequestCurrentPartialContents(),this.__destroyRequestCurrentPartialContents=void 0),this.__destroyRequestCurrentPartialContents=partialContentManager.requestCurrentPartialContents([{path:partialUrl}],data=>{this.__destroyRequestCurrentPartialContents=void 0,-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.htmlFetchEnd=performance.now()),data.error===TcHmi.Errors.NONE&&data.targetPartials?.length?(this.__targetContentMarkup=data.targetPartials.at(0)?.content,this.__processTargetMarkup(void 0,benchmarkObj)):data.error!==TcHmi.Errors.E_DESTROYED&&TcHmi.Log.Controls.error(this,TcHmiRegion.#tchmiFQN,{Attribute:"TargetContent"},`Loading ${partialUrl} failed with error: ${TcHmi.Log.buildMessage(data.details)}`)})):TcHmi.Log.Controls.error(this,TcHmiRegion.#tchmiFQN,"Internal Error: Failed to load partialContentManager");else{this.__xhr&&this.__xhr.abort();let xhr=new XMLHttpRequest;this.__xhr=xhr,xhr.open("GET",tchmi_encode_uri_components(partialUrl)),xhr.addEventListener("load",_event=>{-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.htmlFetchEnd=performance.now()),200===xhr.status?(this.__targetContentMarkup=xhr.responseText,this.__processTargetMarkup(void 0,benchmarkObj)):TcHmi.Log.Controls.error(this,TcHmiRegion.#tchmiFQN,{Attribute:"TargetContent"},`Loading ${partialUrl} failed. Details: HTTP error ${xhr.status+" "+xhr.statusText}`),this.__xhr=void 0}),xhr.addEventListener("error",_event=>{-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.htmlFetchEnd=performance.now()),TcHmi.Log.Controls.error(this,TcHmiRegion.#tchmiFQN,{Attribute:"TargetContent"},`Loading ${partialUrl} failed. HTTP error ${xhr.status+" "+xhr.statusText}`),this.__xhr=void 0}),xhr.send()}}__cleanUpPostAttach(benchmarkObj){this.__processTargetMarkupCleanupOldTimeout&&clearTimeout(this.__processTargetMarkupCleanupOldTimeout),this.__processTargetMarkupCleanupOldTimeout=0,this.__processTargetMarkupOldContent&&!this.__currentContent||this.__processTargetMarkupOldContent&&this.__currentContent&&this.__processTargetMarkupOldContent.getId()!==this.__currentContent.getId()?(this.__processTargetMarkupOldContent.__setLifeCycleState(37),this.__processTargetMarkupOldContent.getElement()[0].style.opacity=this.__processTargetMarkupOldContentOldOpacity??"",this.__processTargetMarkupOldContentOldOpacity=void 0,this.__destroyAndRemoveTargetCtrl(this.__processTargetMarkupOldContent),this.__processTargetMarkupOldContent=null):this.__processTargetMarkupOldContent&&(this.__processTargetMarkupOldContent.__setLifeCycleState(37),this.__processTargetMarkupOldContent.getElement()[0].style.opacity=this.__processTargetMarkupOldContentOldOpacity??"",this.__processTargetMarkupOldContent=null,this.__processTargetMarkupOldContentOldOpacity=void 0),-1===TCHMI_CONSOLE_LOG_LEVEL&&benchmarkObj&&(benchmarkObj.removeContentFromDomEnd=performance.now(),benchmarkObj.screenUpdated&&this.__reportBenchmarkObject(benchmarkObj))}__processTargetMarkup(controlId,benchmarkObj){if(!this.__targetContent)return;let markup=this.__targetContentMarkup;if(!markup)return;let partialUrl=tchmi_path(this.__targetContent),partialUrlOld=null;if(this.__currentContent){let element=this.__currentContent.getElement();element&&element.length>0&&(partialUrlOld=element[0].getAttribute("data-tchmi-partial-url"))}let partialKeepAliveConfig=!1;partialUrl&&!0===TcHmi.System.Data.isKeepAlivePartial.get(partialUrl)&&(partialKeepAliveConfig=!0);let loadSync,partialOldKeepAliveConfig=!1;if(partialUrlOld&&!0===TcHmi.System.Data.isKeepAlivePartial.get(partialUrlOld)&&(partialOldKeepAliveConfig=!0),partialUrl&&(partialKeepAliveConfig||this.__keepAlive)&&!TcHmi.System.Data.Caches.partialMarkupCache.has(partialUrl)){let tempDiv=document.createElement("div");tempDiv.innerHTML=markup,tempDiv.firstElementChild&&TcHmi.System.Data.Caches.partialMarkupCache.set(partialUrl,{markup,partialId:tempDiv.firstElementChild.id})}partialUrlOld&&!partialOldKeepAliveConfig&&partialUrl!==partialUrlOld&&TcHmi.System.Data.Caches.partialMarkupCache.delete(partialUrlOld),this.__processTargetMarkupCompileTimeout&&(clearTimeout(this.__processTargetMarkupCompileTimeout),this.__processTargetMarkupCompileTimeout=0,this.__processTargetMarkupLoadingSpinnerDiv.remove(),this.__currentContent&&(this.__currentContent.__setLifeCycleState(37),this.__currentContent.getElement()[0].style.opacity=this.__processTargetMarkupOldContentOldOpacity??"",this.__processTargetMarkupOldContentOldOpacity=void 0)),this.__processTargetMarkupCleanupOldTimeout&&(clearTimeout(this.__processTargetMarkupCleanupOldTimeout),this.__processTargetMarkupCleanupOldTimeout=0,this.__processTargetMarkupOldContent&&(this.__processTargetMarkupOldContent.__setLifeCycleState(37),this.__processTargetMarkupOldContent.getElement()[0].style.opacity=this.__processTargetMarkupOldContentOldOpacity??"",this.__processTargetMarkupOldContentOldOpacity=void 0,this.__destroyAndRemoveTargetCtrl(this.__processTargetMarkupOldContent),this.__processTargetMarkupOldContent=null)),this.__processTargetMarkupOldContent=this.__currentContent,this.__processTargetMarkupOldContent&&(this.__processTargetMarkupOldContent.__setLifeCycleState(36),this.__processTargetMarkupOldContentOldOpacity=this.__processTargetMarkupOldContent.getElement()[0].style.opacity,this.__processTargetMarkupOldContent.getElement()[0].style.opacity="0"),this.__isAttached&&"Collapsed"!==this.__visibility?(loadSync=TcHmi.System.Data.isLoadSyncContent.get(partialUrl),-1===TCHMI_CONSOLE_LOG_LEVEL&&performance.mark("TcHmiRegion: Sync load "+loadSync+" for "+this.__id)):(loadSync=!0,-1===TCHMI_CONSOLE_LOG_LEVEL&&(this.__isAttached?performance.mark("TcHmiRegion: Sync load forced for collapsed "+this.__id):performance.mark("TcHmiRegion: Sync load forced for detached "+this.__id))),TCHMI_DESIGNER||loadSync||this.__elementTemplateRoot[0].appendChild(this.__processTargetMarkupLoadingSpinnerDiv);const TcHmiRegion_PlaceNewContent=()=>{let curContentCtrlObj,partialId;this.__processTargetMarkupCompileTimeout=0;let elemContentPartial=null;if(controlId)partialId=controlId;else if(markup){let tempDiv=document.createElement("div");tempDiv.innerHTML=markup,elemContentPartial=tempDiv.firstElementChild,elemContentPartial&&(elemContentPartial.remove(),partialId=elemContentPartial.id)}if(curContentCtrlObj=TcHmi.Controls.get(partialId),curContentCtrlObj){let ctrlParent=curContentCtrlObj.getParent();if(ctrlParent&&ctrlParent!==this)return this.__processTargetMarkupLoadingSpinnerDiv.remove(),TcHmi.Engineering.ErrorPane.add("E_REGION["+this.getId()+"]_CONTENT_ALREADY_USED","[Source=Control, Module="+this.__type+(TcHmiRegion.#tchmiFQN!==this.__type?", Origin="+TcHmiRegion.#tchmiFQN:"")+", Id="+this.getId()+", Attribute=TargetContent] Loading content="+this.__targetContent+" was blocked because it is already used in region with id="+ctrlParent.getId()+".",TcHmi.Engineering.ErrorPane.MessageType.Error),TcHmi.Log.Controls.error(this,TcHmiRegion.#tchmiFQN,{Attribute:"TargetContent"},`Loading content=${this.__targetContent} was blocked because it is already used in region with id=${ctrlParent.getId()}.`),void(this.__currentContent&&(this.__destroyAndRemoveTargetCtrl(this.__currentContent),this.__currentContent=null))}else if(!elemContentPartial&&markup){let tempDiv=document.createElement("div");tempDiv.innerHTML=markup,elemContentPartial=tempDiv.firstElementChild,elemContentPartial?.remove()}if(markup&&(this.__targetMarkup=markup),!curContentCtrlObj&&elemContentPartial){if(!elemContentPartial.hasAttribute("data-tchmi-type"))return this.__currentContent&&(this.__destroyAndRemoveTargetCtrl(this.__currentContent),this.__currentContent=null),this.__processTargetMarkupLoadingSpinnerDiv.remove(),void TcHmi.Log.Controls.error(this,TcHmiRegion.#tchmiFQN,{Attribute:"TargetContent"},`Loading content=${this.__targetContent} failed, because its first html element is no tchmi control (missing data-tchmi-type attribute).`);this.__targetContent&&elemContentPartial.setAttribute("data-tchmi-partial-url",tchmi_path(this.__targetContent)),-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.compileStart=performance.now()),curContentCtrlObj=TcHmi.System.Services.controlManager.compile(elemContentPartial,this).control,-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.compileEnd=performance.now()),curContentCtrlObj&&(partialKeepAliveConfig||this.__keepAlive)&&curContentCtrlObj.__setKeepAlive(!0)}if(curContentCtrlObj&&!(curContentCtrlObj instanceof TcHmiContent))return this.__currentContent&&(this.__destroyAndRemoveTargetCtrl(this.__currentContent),this.__currentContent=null),this.__processTargetMarkupLoadingSpinnerDiv.remove(),TcHmi.Log.Controls.error(this,TcHmiRegion.#tchmiFQN,{Attribute:"TargetContent"},"Wrong content type (not TcHmi.Controls.System.TcHmiContent)."),void(-1===TCHMI_CONSOLE_LOG_LEVEL&&window.requestAnimationFrame(()=>{benchmarkObj.screenUpdated=performance.now(),this.__reportBenchmarkObject(benchmarkObj)}));this.__currentContent=curContentCtrlObj??null,this.__currentContent?(-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.addContentToDomStart=performance.now()),"No"!==this.__scrolling&&(this.__elementTemplateRoot[0].scrollTop=0,this.__elementTemplateRoot[0].scrollLeft=0),this.__elementTemplateRoot[0].appendChild(this.__currentContent.getElement()[0]),this.__addChild(this.__currentContent),this.__processTargetMarkupLoadingSpinnerDiv.remove(),-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.addContentToDomEnd=benchmarkObj.removeContentFromDomStart=performance.now()),!partialOldKeepAliveConfig&&(this.__processTargetMarkupOldContent&&!this.__currentContent||this.__processTargetMarkupOldContent&&this.__currentContent&&this.__processTargetMarkupOldContent.getId()!==this.__currentContent.getId())&&this.__processTargetMarkupOldContent.__setKeepAlive(!1),this.__processTargetMarkupOldContent&&TcHmi.System.Services.controlManager.forceDetach(this.__processTargetMarkupOldContent),this.__processTargetMarkupCleanupOldTimeout=setTimeout(this.__cleanUpPostAttach.bind(benchmarkObj)),TcHmi.EventProvider.register(this.__currentContent.getId()+".onAttached",(e,tco)=>{e.destroy(),null!==this.__currentContent&&("Content"===this.getWidthMode()&&this.__processWidth(),"Content"===this.getHeightMode()&&this.__processHeight())}),-1===TCHMI_CONSOLE_LOG_LEVEL&&TcHmi.EventProvider.register("System.onPrevControlsAttached",(e,controls)=>{e.destroy(),benchmarkObj.syncAttachEnd=benchmarkObj.asyncAttachStart=performance.now(),window.requestAnimationFrame(()=>{benchmarkObj.asyncAttachEnd=performance.now(),benchmarkObj.screenUpdated=performance.now(),benchmarkObj.removeContentFromDomEnd&&this.__reportBenchmarkObject(benchmarkObj)})})):(this.__processTargetMarkupLoadingSpinnerDiv.remove(),this.__processTargetMarkupOldContent&&(this.__destroyAndRemoveTargetCtrl(this.__processTargetMarkupOldContent),this.__processTargetMarkupOldContent=null)),TcHmi.EventProvider.raise(this.__id+".onTargetContentReplaced",this.__currentContent),this.__processScrolling(),this.__processScaleMode(),-1===TCHMI_CONSOLE_LOG_LEVEL&&(benchmarkObj.syncAttachStart=performance.now())};loadSync?TcHmiRegion_PlaceNewContent():this.__processTargetMarkupCompileTimeout=setTimeout(TcHmiRegion_PlaceNewContent)}__processIsEnabled(){super.__processIsEnabled(),this.__currentContent&&this.__currentContent.__processIsEnabled()}__processAccessConfig(){super.__processAccessConfig(),this.__currentContent&&this.__currentContent.__processAccessConfig()}setScaleMode(valueNew){let convertedValue=TcHmi.ValueConverter.toScaleModeString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ScaleMode")),convertedValue!==this.__scaleMode&&(this.__scaleMode=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ScaleMode"}),this.__attributesInitialized&&(this.__processScrolling(),this.__processScaleMode()))}getScaleMode(){return this.__scaleMode}__rescaleId=0;__processScaleMode(){if(null===this.__currentContent)return;const contentElement=this.__currentContent.getElement();switch(this.__scaleMode){case"ScaleToFit":{const contentDim=TcHmi.StyleProvider.getComputedElementStyle(contentElement,["width","height"]),ratioW=this.__elementTemplateRoot[0].clientWidth/parseFloat(contentDim.width),ratioH=this.__elementTemplateRoot[0].clientHeight/parseFloat(contentDim.height),ratio=ratioW>ratioH?ratioH:ratioW;contentElement[0].style.transform="scale("+ratio+")",contentElement[0].style.transformOrigin="0 0"}break;case"ScaleToFitWidth":{const cntentDim=TcHmi.StyleProvider.getComputedElementStyle(contentElement,"width"),ratio=this.__elementTemplateRoot[0].clientWidth/parseFloat(cntentDim.width);contentElement[0].style.transform="scale("+ratio+")",contentElement[0].style.transformOrigin="0 0",this.__rescaleId||"No"===this.__scrolling||(this.__rescaleId=window.setTimeout(()=>{this.__processScaleMode(),this.__rescaleId=0}))}break;case"ScaleToFitHeight":{const cntentDim=TcHmi.StyleProvider.getComputedElementStyle(contentElement,"height"),ratio=this.__elementTemplateRoot[0].clientHeight/parseFloat(cntentDim.height);contentElement[0].style.transform="scale("+ratio+")",contentElement[0].style.transformOrigin="0 0",this.__rescaleId||"No"===this.__scrolling||(this.__rescaleId=window.setTimeout(()=>{this.__processScaleMode(),this.__rescaleId=0}))}break;case"ScaleToFill":{const contentDim=TcHmi.StyleProvider.getComputedElementStyle(contentElement,["width","height"]),zoomRatio=1,ratioW=this.__elementTemplateRoot[0].clientWidth/parseFloat(contentDim.width)*zoomRatio,ratioH=this.__elementTemplateRoot[0].clientHeight/parseFloat(contentDim.height)*zoomRatio;contentElement[0].style.transform="scale("+ratioW+","+ratioH+")",contentElement[0].style.transformOrigin="0 0"}break;default:contentElement[0].style.transform="",contentElement[0].style.transformOrigin=""}}setScrolling(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);if(null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Scrolling")),convertedValue!==this.__scrolling){switch(convertedValue){case"Yes":case"Auto":this.__scrolling=convertedValue;break;default:this.__scrolling="No"}TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Scrolling"}),this.__attributesInitialized&&(this.__processScrolling(),this.__processScaleMode())}}getScrolling(){return this.__scrolling}__processScrolling(){let newCss={};switch(this.__scrolling){case"Yes":case"Auto":this.__scaleMode&&"None"!==this.__scaleMode&&"ScaleToFitHeight"!==this.__scaleMode?newCss["overflow-x"]="":newCss["overflow-x"]="auto",this.__scaleMode&&"None"!==this.__scaleMode&&"ScaleToFitWidth"!==this.__scaleMode?newCss["overflow-y"]="":newCss["overflow-y"]="auto";break;default:newCss["overflow-x"]="",newCss["overflow-y"]="",this.__elementTemplateRoot[0].scrollTop=0,this.__elementTemplateRoot[0].scrollLeft=0}TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,newCss),this.__processWidth(),this.__processHeight()}getCurrentContent(){return this.__currentContent}}})();export{TcHmiRegion};TcHmi.Controls.registerEx("TcHmiRegion","TcHmi.Controls.System",TcHmiRegion,{injectInGlobalObject:!0});