var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};const TcHmi=window.TcHmi;import{TcHmiControl}from"../dist/TcHmiControl.esm.js";import{TcHmiRegion}from"../dist/TcHmiRegion.esm.js";import{TcHmiUserControlHost}from"../dist/TcHmiUserControlHost.esm.js";let TcHmiPopup=(()=>{var _a;let ___onResolverForTargetFileWatchCallback_decorators,_classSuper=TcHmiControl,_instanceExtraInitializers=[];return class TcHmiPopup extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onResolverForTargetFileWatchCallback_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],__esDecorate(this,null,___onResolverForTargetFileWatchCallback_decorators,{kind:"method",name:"__onResolverForTargetFileWatchCallback",static:!1,private:!1,access:{has:obj=>"__onResolverForTargetFileWatchCallback"in obj,get:obj=>obj.__onResolverForTargetFileWatchCallback},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.System."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs)}__elementTemplateRoot=__runInitializers(this,_instanceExtraInitializers);__popup=null;__targetFile;__targetFileAttributesPreserved;__headerText;__buttons;__value={property:void 0,description:null,destroyPropertyChanged:null,value:void 0,writeToUserControl:!1,hasBeenSet:!1};__restoreBounds;__movable;__modal=void 0;__closeOnBackground=void 0;__targetFileHostPreload;__targetFileHostKeepAlive;__scrolling;__fileHost;__popupSize={top:null,left:null,width:null,height:null};__resizeDestroyFnc;__moveDestroyFnc;__boundsChangedDestroy;__buttonPressedDestroy;__openInProgress=!1;__ignoreNextPromptAnswer=!1;__previnit(){let templateRoot=this.__element.find(".TcHmi_Controls_System_TcHmiPopup-template");if(0===templateRoot.length)throw new Error("Invalid Template.html");this.__elementTemplateRoot=templateRoot[0],super.__previnit()}__init(){super.__init(),this.__targetFileHostPreload&&this.__buildFileHost()}__attach(){super.__attach();const updateBound=(event,ctrl,options)=>{this.__modal&&event.name===this.__id+".onMoved"||this.__popup?.setBounds({width:this.getRenderedWidth(),height:this.getRenderedHeight(),left:this.__renderedSizeCache.viewportLeft,top:this.__renderedSizeCache.viewportTop})};this.__resizeDestroyFnc=TcHmi.EventProvider.register(this.__id+".onResized",updateBound),this.__moveDestroyFnc=TcHmi.EventProvider.register(this.__id+".onMoved",updateBound)}__detach(){super.__detach(),this.__popup?.abort({result:null}),this.__resizeDestroyFnc?.(),this.__resizeDestroyFnc=void 0,this.__moveDestroyFnc?.(),this.__moveDestroyFnc=void 0}destroy(){this.__keepAlive||(this.__popup?.abort({result:null}),this.__popup?.destroy(),this.__popup=null,this.__boundsChangedDestroy?.(),this.__boundsChangedDestroy=void 0,this.__buttonPressedDestroy?.(),this.__buttonPressedDestroy=void 0,this.__value.destroyPropertyChanged?.(),this.__value.destroyPropertyChanged=null,this.__fileHost&&(this.__fileHost.destroy(),this.__fileHost=null),super.destroy())}__buildFileHost(){if(this.__fileHost&&(this.__value.destroyPropertyChanged?.(),this.__value.destroyPropertyChanged=null,this.__fileHost.destroy(),this.__fileHost=null),!this.__targetFile)return;let path=this.__targetFile.path,attributes=null;if(this.__targetFile.attributes&&(attributes=tchmi_clone_object(this.__targetFile.attributes)),path){if(path.toLowerCase().endsWith(".content")){let attributesExtended={"data-tchmi-target-content":path,"data-tchmi-left":0,"data-tchmi-top":0,"data-tchmi-width":100,"data-tchmi-height":100,"data-tchmi-width-unit":"%","data-tchmi-height-unit":"%","data-tchmi-scrolling":this.__scrolling};this.__fileHost=TcHmi.ControlFactory.createEx("TcHmi.Controls.System.TcHmiRegion",this.getId()+".Region",{...attributesExtended},this)}else if(path.toLowerCase().endsWith(".usercontrol")){let attributesExtended={"data-tchmi-target-user-control":path,"data-tchmi-left":0,"data-tchmi-top":0,"data-tchmi-width":100,"data-tchmi-height":100,"data-tchmi-width-unit":"%","data-tchmi-height-unit":"%"};this.__fileHost=TcHmi.ControlFactory.createEx("TcHmi.Controls.System.TcHmiUserControlHost",this.getId()+".UserControlHost",{...attributes,...attributesExtended},this)}this.__value.property&&(this.__value.writeToUserControl=!0,this.__processValueProperty())}}setTargetFile(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TargetFile"));let resolverInfo=this.__objectResolvers.get("targetFile");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy()),this.__targetFileAttributesPreserved=null,convertedValue?.attributes&&(this.__targetFileAttributesPreserved=convertedValue.attributes,convertedValue.attributes=void 0);let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,{parentControl:this,type:this.getAttributeDescription("TargetFile")?.type});this.__objectResolvers.set("targetFile",{resolver,watchCallback:this.__onResolverForTargetFileWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForTargetFileWatchCallback)})}__onResolverForTargetFileWatchCallback(data){if(this.__isAttached||this.__suspendObjectResolver("targetFile"),data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.Controls.error(this,TcHmiPopup.#tchmiFQN,{Attribute:"TargetFile"},`Resolving symbols from object failed with error: ${TcHmi.Log.buildMessage(data.details)}`);let newValue=data.value;newValue&&this.__targetFileAttributesPreserved&&(newValue.attributes=this.__targetFileAttributesPreserved),tchmi_equal(newValue,this.__targetFile)||(this.__targetFile=newValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TargetFile"}),this.__processTargetFile())}getTargetFile(){return this.__targetFile}__processTargetFile(){if(this.__attributesInitialized&&((this.__targetFileHostPreload||this.__popup?.isShowing())&&this.__buildFileHost(),this.__popup?.isShowing())){let fileHostElement=this.__fileHost?.getElement()[0];fileHostElement?this.__popup.setContentElement(fileHostElement):this.__popup.setContentElement(document.createElement("div"))}}setHeaderText(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("HeaderText")),convertedValue=tchmi_path(convertedValue),convertedValue!==this.__headerText&&(this.__headerText=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderText"}),this.__processHeaderText())}getHeaderText(){return this.__headerText}__processHeaderText(){this.__popup?.setTexts({headerText:this.__headerText?this.__headerText:""})}setButtons(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Buttons")),tchmi_equal(convertedValue,this.__buttons)||(this.__buttons=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Buttons"}),this.__processButtons())}getButtons(){return this.__buttons}__processButtons(){this.__popup&&(this.__popup.isShowing()?(this.__ignoreNextPromptAnswer=!0,this.__popup.abort({result:null}),this.__popup.destroy(),this.__popup=null,this.__boundsChangedDestroy?.(),this.__boundsChangedDestroy=void 0,this.__buttonPressedDestroy?.(),this.__buttonPressedDestroy=void 0,this.open(!0)):(this.__popup.destroy(),this.__popup=null,this.__boundsChangedDestroy?.(),this.__boundsChangedDestroy=void 0,this.__buttonPressedDestroy?.(),this.__buttonPressedDestroy=void 0))}setValueProperty(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ValueProperty")),convertedValue!==this.__value.property&&(this.__value.property=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ValueProperty"}),this.__processValueProperty())}getValueProperty(){return this.__value.property}__processValueProperty(){if(this.__value.destroyPropertyChanged?.(),this.__value.destroyPropertyChanged=null,this.__value.property&&this.__fileHost instanceof TcHmiUserControlHost){const parameters=Array.from(this.__fileHost.getParams().values()),description=parameters.find(parameter=>parameter.description.propertyName.toLowerCase()===this.__value.property?.toLowerCase())?.description;description&&(this.__value.description=description,this.__value.destroyPropertyChanged=TcHmi.EventProvider.register(`${this.__fileHost.getId()}.onPropertyChanged<${description.propertyName}>`,()=>{this.__setValue(this.__readValue(),!1)}))}this.__value.writeToUserControl?this.__processValue():this.__setValue(this.__readValue(),!1)}setValue(valueNew){this.__setValue(valueNew,!0)}__setValue(valueNew,writeToUserControl){tchmi_equal(valueNew,this.__value.value)||(this.__value.hasBeenSet=void 0!==this.__value.value&&null!==this.__value.value||null!=valueNew,this.__value.writeToUserControl=writeToUserControl,this.__value.value=valueNew,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Value"}),this.__processValue())}getValue(){return this.__value.value}__processValue(){if(!(this.__value.writeToUserControl&&this.__value.hasBeenSet&&this.__value.description?.propertySetterName&&this.__fileHost instanceof TcHmiUserControlHost))return;const setter=this.__fileHost[this.__value.description.propertySetterName];"function"==typeof setter&&setter(this.__value.value),this.__setValue(this.__readValue(),!1)}__readValue(){if(!(this.__value.description&&this.__fileHost instanceof TcHmiUserControlHost))return;const getter=this.__fileHost[this.__value.description.propertyGetterName];return"function"==typeof getter?getter():void 0}setRestoreBounds(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("RestoreBounds")),convertedValue=tchmi_path(convertedValue),convertedValue!==this.__restoreBounds&&(this.__restoreBounds=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"RestoreBounds"}),this.__processRestoreBounds())}getRestoreBounds(){return this.__restoreBounds}__processRestoreBounds(){this.__popup?.setStorageSettings({name:this.getId()+".Popup",restoreBounds:this.__restoreBounds})}setMovable(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Movable")),convertedValue=tchmi_path(convertedValue),convertedValue!==this.__movable&&(this.__movable=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Movable"}),this.__processMovable())}getMovable(){return this.__movable}__processMovable(){this.__setPopupOptions()}setModal(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Modal")),convertedValue=tchmi_path(convertedValue),convertedValue!==this.__modal&&(this.__modal=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Modal"}),this.__processModal())}getModal(){return this.__modal}__processModal(){this.__setPopupOptions()}setCloseOnBackground(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("CloseOnBackground")),convertedValue!==this.__closeOnBackground&&(this.__closeOnBackground=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"CloseOnBackground"}),this.__processCloseOnBackground())}getCloseOnBackground(){return this.__closeOnBackground}__processCloseOnBackground(){this.__setPopupOptions()}__setPopupOptions(){this.__popup&&(this.__popup.setCloseButton(!0),this.__popup.setCloseButtonAction?.({result:null}),this.__closeOnBackground?this.__popup.setBackgroundAction({close:!0,result:null}):this.__popup.setBackgroundAction({close:!1}),this.__popup.setStorageSettings({name:this.getId()+".Popup",restoreBounds:this.__restoreBounds}),this.__modal?(this.__popup.setBackgroundMode(TcHmi.UiProvider.PopupProvider.BackgroundMode.Dimmed),this.__popup.setPositioningMode(TcHmi.UiProvider.PopupProvider.PositioningMode.Centered),this.__popup.setMovable(!1)):(this.__popup.setBackgroundMode(TcHmi.UiProvider.PopupProvider.BackgroundMode.None),this.__popup.setPositioningMode(TcHmi.UiProvider.PopupProvider.PositioningMode.Floating),this.__popup.setMovable(this.__movable??this.getAttributeDefaultValueInternal("Movable"))))}setScrolling(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);if(null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Scrolling")),convertedValue!==this.__scrolling){switch(convertedValue){case"Yes":case"Auto":this.__scrolling=convertedValue;break;default:this.__scrolling="No"}TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Scrolling"}),this.__processScrolling()}}getScrolling(){return this.__scrolling}__processScrolling(){this.__fileHost instanceof TcHmiRegion&&this.__fileHost.setScrolling(this.__scrolling??null)}open(suppressEvents=!1){if(this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__buttons&&!this.__popup?.isShowing()){if(this.__fileHost||this.__buildFileHost(),this.__openInProgress=!0,this.__popup)this.__fileHost&&this.__popup.setContentElement(this.__fileHost.getElement()[0]);else{let popupUiProvider,element;try{popupUiProvider=TcHmi.UiProvider.getPreferredProvider("popup")}catch(ex){return void TcHmi.Log.Controls.error(this,TcHmiPopup.#tchmiFQN,"Could not open popup. An exception occured while loading popup ui provider.",ex)}if(!popupUiProvider)return void TcHmi.Log.Controls.error(this,TcHmiPopup.#tchmiFQN,"Could not open popup. Missing popup ui provider. Please check tchmiconfig.json and make sure that systemPopups property exists, is configured correctly and that the configured provider is loaded.");if(!popupUiProvider.createHtmlElementBox)return void TcHmi.Log.Controls.error(this,TcHmiPopup.#tchmiFQN,"Could not open popup. The configured popup ui provider does not implement the method 'createHtmlElementBox'. Please make sure that the provider configured in the systemPopups property of tchmiconfig.json implements this method.");element=this.__fileHost?this.__fileHost.getElement()[0]:document.createElement("div");const buttons={};for(const button of this.__buttons)buttons[button.name]={value:"value"in button?button.value:null,width:button.width,height:button.height,widthMode:button.widthMode,heightMode:button.heightMode,minWidth:button.minWidth,maxWidth:button.maxWidth,minHeight:button.minHeight,maxHeight:button.maxHeight,textPadding:button.textPadding,text:button.text,tooltip:button.tooltip,keepPopupOpen:button.keepPopupOpen,actions:button.actions};this.__popup=popupUiProvider.createHtmlElementBox(this.__headerText??"",element,buttons,this),this.__boundsChangedDestroy=this.__popup.onBoundsChange.add(({bounds})=>{if(!bounds||!this.__popup?.isShowing()&&!this.__openInProgress)return;const propertyCandidates=["top","left","width","height"],changedProperties=[];for(const property of propertyCandidates)this.__popupSize[property]!==bounds[property]&&(this.__popupSize[property]=bounds[property]??null,changedProperties.push(property));if(this.__popup?.isShowing())for(const property of changedProperties){const propertyName="Popup"+property.charAt(0).toUpperCase()+property.slice(1);TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName})}}),this.__buttonPressedDestroy=this.__popup.onButtonPressed?.add((name,value)=>{TcHmi.EventProvider.raise(this.__id+".onButtonPressed",{buttonName:name,value}),TcHmi.EventProvider.raise(`${this.__id}.onButtonPressed<${name}>`,{value})})}if(this.__popup.setBounds({width:this.getRenderedWidth(),height:this.getRenderedHeight(),left:this.__renderedSizeCache.viewportLeft,top:this.__renderedSizeCache.viewportTop}),this.__setPopupOptions(),this.__openInProgress=!1,this.__popup.prompt().then(result=>{if(this.__ignoreNextPromptAnswer)return void(this.__ignoreNextPromptAnswer=!1);!this.__fileHost||this.__targetFileHostPreload||this.__targetFileHostKeepAlive||(this.__value.destroyPropertyChanged?.(),this.__value.destroyPropertyChanged=null,this.__fileHost.destroy(),this.__fileHost=void 0),TcHmi.EventProvider.raise(this.__id+".onClosed",{result}),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IsOpen"});const changedProperties=["top","left","width","height"];for(const currentStyleName of changedProperties)this.__popupSize[currentStyleName]=null;for(const currentStyleName of changedProperties){const propertyName="Popup"+currentStyleName.charAt(0).toUpperCase()+currentStyleName.slice(1);TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName})}}),!suppressEvents){TcHmi.EventProvider.raise(this.__id+".onOpened"),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IsOpen"});const changedProperties=["top","left","width","height"];for(const currentStyleName of changedProperties){const propertyName="Popup"+currentStyleName.charAt(0).toUpperCase()+currentStyleName.slice(1);TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName})}}}}close(){this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__popup&&this.__popup.isShowing()&&(this.__popup.abort({result:null}),!this.__fileHost||this.__targetFileHostPreload||this.__targetFileHostKeepAlive||(this.__value.destroyPropertyChanged?.(),this.__value.destroyPropertyChanged=null,this.__fileHost.destroy(),this.__fileHost=void 0))}resetBounds(){this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&(this.__modal||(this.__popup?.resetBounds(),this.__popup?.setBounds({width:this.getRenderedWidth(),height:this.getRenderedHeight(),left:this.__renderedSizeCache.viewportLeft,top:this.__renderedSizeCache.viewportTop})))}getPopupLeft(){return this.__popupSize.left}getPopupTop(){return this.__popupSize.top}getPopupHeight(){return this.__popupSize.height}getPopupWidth(){return this.__popupSize.width}setTargetFileHostPreload(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TargetFileHostPreload")),convertedValue=tchmi_path(convertedValue),convertedValue!==this.__targetFileHostPreload&&(this.__targetFileHostPreload=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TargetFileHostPreload"}),this.__processTargetFileHostPreload())}getTargetFileHostPreload(){return this.__targetFileHostPreload}__processTargetFileHostPreload(){this.__targetFileHostPreload&&!this.__popup?.isShowing()&&this.__isAttached&&this.__buildFileHost()}setTargetFileHostKeepAlive(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("TargetFileHostKeepAlive")),convertedValue=tchmi_path(convertedValue),convertedValue!==this.__targetFileHostKeepAlive&&(this.__targetFileHostKeepAlive=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TargetFileHostKeepAlive"}))}getTargetFileHostKeepAlive(){return this.__targetFileHostKeepAlive}getIsOpen(){return this.__popup?.isShowing()??!1}}})();export{TcHmiPopup};TcHmi.Controls.registerEx("TcHmiPopup","TcHmi.Controls.System",TcHmiPopup,{injectInGlobalObject:!0});