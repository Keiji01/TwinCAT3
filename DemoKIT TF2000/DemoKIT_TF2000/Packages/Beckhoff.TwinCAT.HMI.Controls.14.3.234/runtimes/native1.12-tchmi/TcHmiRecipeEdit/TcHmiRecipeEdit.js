"use strict";var TcHmi,__runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};!function(TcHmi){!function(Controls){!function(Beckhoff){let TcHmiRecipeEdit=(()=>{let ___onNewFolderPressed_decorators,___onNewRecipePressed_decorators,___onRenamePressed_decorators,___onCopyPressed_decorators,___onCutPressed_decorators,___onPastePressed_decorators,___onDeletePressed_decorators,___onSelectionChanged_decorators,___onBeforePathChange_decorators,___onPathChanged_decorators,___onDragAndDropped_decorators,___onActivatePressed_decorators,___onTeachPressed_decorators,___onSavePressed_decorators,___onClosePressed_decorators,___onRecipeEditorChanged_decorators,___onResolverForAllowedRecipeTypesWatchCallback_decorators,___onRecipeListWatch_decorators,_classSuper=TcHmi.Controls.System.TcHmiControl,_instanceExtraInitializers=[];return class TcHmiRecipeEdit extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onNewFolderPressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onNewRecipePressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onRenamePressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onCopyPressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onCutPressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onPastePressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onDeletePressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onSelectionChanged_decorators=[TcHmi.EventHandler()],___onBeforePathChange_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate",earlyReturnValue:Promise.resolve(!0)})],___onPathChanged_decorators=[TcHmi.EventHandler()],___onDragAndDropped_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onActivatePressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onTeachPressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onSavePressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onClosePressed_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onRecipeEditorChanged_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onResolverForAllowedRecipeTypesWatchCallback_decorators=[TcHmi.CallbackMethod],___onRecipeListWatch_decorators=[TcHmi.EventHandler()],__esDecorate(this,null,___onNewFolderPressed_decorators,{kind:"method",name:"__onNewFolderPressed",static:!1,private:!1,access:{has:obj=>"__onNewFolderPressed"in obj,get:obj=>obj.__onNewFolderPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onNewRecipePressed_decorators,{kind:"method",name:"__onNewRecipePressed",static:!1,private:!1,access:{has:obj=>"__onNewRecipePressed"in obj,get:obj=>obj.__onNewRecipePressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onRenamePressed_decorators,{kind:"method",name:"__onRenamePressed",static:!1,private:!1,access:{has:obj=>"__onRenamePressed"in obj,get:obj=>obj.__onRenamePressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onCopyPressed_decorators,{kind:"method",name:"__onCopyPressed",static:!1,private:!1,access:{has:obj=>"__onCopyPressed"in obj,get:obj=>obj.__onCopyPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onCutPressed_decorators,{kind:"method",name:"__onCutPressed",static:!1,private:!1,access:{has:obj=>"__onCutPressed"in obj,get:obj=>obj.__onCutPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPastePressed_decorators,{kind:"method",name:"__onPastePressed",static:!1,private:!1,access:{has:obj=>"__onPastePressed"in obj,get:obj=>obj.__onPastePressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onDeletePressed_decorators,{kind:"method",name:"__onDeletePressed",static:!1,private:!1,access:{has:obj=>"__onDeletePressed"in obj,get:obj=>obj.__onDeletePressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onSelectionChanged_decorators,{kind:"method",name:"__onSelectionChanged",static:!1,private:!1,access:{has:obj=>"__onSelectionChanged"in obj,get:obj=>obj.__onSelectionChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onBeforePathChange_decorators,{kind:"method",name:"__onBeforePathChange",static:!1,private:!1,access:{has:obj=>"__onBeforePathChange"in obj,get:obj=>obj.__onBeforePathChange},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPathChanged_decorators,{kind:"method",name:"__onPathChanged",static:!1,private:!1,access:{has:obj=>"__onPathChanged"in obj,get:obj=>obj.__onPathChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onDragAndDropped_decorators,{kind:"method",name:"__onDragAndDropped",static:!1,private:!1,access:{has:obj=>"__onDragAndDropped"in obj,get:obj=>obj.__onDragAndDropped},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onActivatePressed_decorators,{kind:"method",name:"__onActivatePressed",static:!1,private:!1,access:{has:obj=>"__onActivatePressed"in obj,get:obj=>obj.__onActivatePressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onTeachPressed_decorators,{kind:"method",name:"__onTeachPressed",static:!1,private:!1,access:{has:obj=>"__onTeachPressed"in obj,get:obj=>obj.__onTeachPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onSavePressed_decorators,{kind:"method",name:"__onSavePressed",static:!1,private:!1,access:{has:obj=>"__onSavePressed"in obj,get:obj=>obj.__onSavePressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onClosePressed_decorators,{kind:"method",name:"__onClosePressed",static:!1,private:!1,access:{has:obj=>"__onClosePressed"in obj,get:obj=>obj.__onClosePressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onRecipeEditorChanged_decorators,{kind:"method",name:"__onRecipeEditorChanged",static:!1,private:!1,access:{has:obj=>"__onRecipeEditorChanged"in obj,get:obj=>obj.__onRecipeEditorChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onResolverForAllowedRecipeTypesWatchCallback_decorators,{kind:"method",name:"__onResolverForAllowedRecipeTypesWatchCallback",static:!1,private:!1,access:{has:obj=>"__onResolverForAllowedRecipeTypesWatchCallback"in obj,get:obj=>obj.__onResolverForAllowedRecipeTypesWatchCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onRecipeListWatch_decorators,{kind:"method",name:"__onRecipeListWatch",static:!1,private:!1,access:{has:obj=>"__onRecipeListWatch"in obj,get:obj=>obj.__onRecipeListWatch},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.Beckhoff."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs)}__elementTemplateRoot=__runInitializers(this,_instanceExtraInitializers);__elementPathBox;__serverDomain;__path;__oldPath;__allowedRecipeTypes;__unwatchRecipeManagementDomain=null;__unwatchRecipeList=null;__watchRecipeConditions={extensionLoaded:!1,userHasRights:!1};__watchRecipeListResult=null;__onRecipeListReceivedManager=new Controls.Helpers.CallbackManager;__activeRecipesSubscriptionId=null;__watchActiveRecipeConditions={extensionLoaded:!1,userHasRights:!1,recipe:""};__symbolAccessSubscriptionId=null;__symbolAccess={"{0}.Config":TcHmi.Server.ACCESS.NONE,Rename:TcHmi.Server.ACCESS.NONE,"{0}.ActivateRecipe":TcHmi.Server.ACCESS.NONE,"{0}.ReadFromTarget":TcHmi.Server.ACCESS.NONE,"{0}.UpdateRecipe":TcHmi.Server.ACCESS.NONE,"{0}.GetActiveRecipes":TcHmi.Server.ACCESS.NONE};__buttons;__clipboard=null;__recipeBrowser;__recipeEditor;__namePrompt=null;__createRecipePrompt=null;__confirmDeletionPrompt=null;__activatePrompt=null;__teachErrorPopup=null;__confirmClosePrompt=null;__childControls=[];__localizationReader=void 0;__isEnabledLock={locked:!1,unlockValue:null};__previnit(){if(super.__previnit(),this.__elementTemplateRoot=this.__element[0].querySelector(".TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-template")??void 0,!this.__elementTemplateRoot)throw new Error("Invalid Template.html - Missing element with class: 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-template'.");if(this.__elementPathBox=this.__elementTemplateRoot.querySelector("div.TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-path-box")??void 0,!this.__elementPathBox)throw new Error("Invalid Template.html - A div element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-path-box' must exist");this.__destroyOnDestroy.push(this.__localization.watch(data=>{data.error===TcHmi.Errors.NONE&&data.reader&&(this.__localizationReader=data.reader)}))}__init(){if(super.__init(),!this.__elementTemplateRoot)throw new Error("Invalid Template.html - Missing element with class: 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-template'.");if(!this.__elementPathBox)throw new Error("Invalid Template.html - A div element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-path-box' must exist");const elementBrowsingBox=this.__elementTemplateRoot.querySelector("ul.TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-box");if(!elementBrowsingBox)throw new Error("Invalid Template.html - An ul element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-box' must exist.");const pathDisplay=new Controls.Helpers.PathDisplay(this.__elementPathBox,this),browsingDisplay=new Controls.Helpers.ListBrowsingDisplay(elementBrowsingBox,this);this.__recipeBrowser=new Controls.Helpers.DirectoryBrowser([pathDisplay,browsingDisplay],this),this.__recipeBrowser.setMultiSelectAllowed(!0),this.__recipeBrowser.onBeforePathChange.add(this.__onBeforePathChange),this.__recipeBrowser.onSelectionChange.add(this.__onSelectionChanged),this.__recipeBrowser.onPathChange.add(this.__onPathChanged);const elementBrowsingButtons=this.__elementTemplateRoot.querySelector(".TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-pane .TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-container");if(!elementBrowsingButtons)throw new Error("Invalid Template.html - An element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-pane' must exist and contain a child element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-container'.");const newFolderButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonNewFolder",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_CreateFolder")},this);if(!newFolderButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const newFolderElement=newFolderButton.getElement()[0];newFolderElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-create-folder"),elementBrowsingButtons.appendChild(newFolderElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(newFolderButton.getId()+".onPressed",this.__onNewFolderPressed)),this.__childControls.push(newFolderButton);const newRecipeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonNewRecipe",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_CreateRecipe")},this);if(!newRecipeButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const newRecipeElement=newRecipeButton.getElement()[0];newRecipeElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-create-recipe"),elementBrowsingButtons.appendChild(newRecipeElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(newRecipeButton.getId()+".onPressed",this.__onNewRecipePressed)),this.__childControls.push(newRecipeButton);const renameButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonRename",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Rename"),"data-tchmi-is-enabled":!1},this);if(!renameButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const renameElement=renameButton.getElement()[0];renameElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-rename"),elementBrowsingButtons.appendChild(renameElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(renameButton.getId()+".onPressed",this.__onRenamePressed)),this.__childControls.push(renameButton);const copyButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonCopy",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Copy"),"data-tchmi-is-enabled":!1},this);if(!copyButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const copyElement=copyButton.getElement()[0];copyElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-copy"),elementBrowsingButtons.appendChild(copyElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(copyButton.getId()+".onPressed",this.__onCopyPressed)),this.__childControls.push(copyButton);const cutButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonCut",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Cut"),"data-tchmi-is-enabled":!1},this);if(!cutButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const cutElement=cutButton.getElement()[0];cutElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-cut"),elementBrowsingButtons.appendChild(cutElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(cutButton.getId()+".onPressed",this.__onCutPressed)),this.__childControls.push(cutButton);const pasteButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonPaste",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Paste"),"data-tchmi-is-enabled":!1},this);if(!pasteButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const pasteElement=pasteButton.getElement()[0];pasteElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-paste"),elementBrowsingButtons.appendChild(pasteElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(pasteButton.getId()+".onPressed",this.__onPastePressed)),this.__childControls.push(pasteButton);const deleteButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonDelete",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Delete"),"data-tchmi-is-enabled":!1},this);if(!deleteButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const deleteElement=deleteButton.getElement()[0];deleteElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-delete"),elementBrowsingButtons.appendChild(deleteElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(deleteButton.getId()+".onPressed",this.__onDeletePressed)),this.__childControls.push(deleteButton);const elementEditingArea=this.__elementTemplateRoot.querySelector(".TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-editing-area");if(!(elementEditingArea instanceof HTMLDivElement))throw new Error("Invalid Template.html - A <div> element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-editing-area' must exist.");this.__recipeEditor=new Beckhoff.TcHmiRecipeEditComponents.RecipeEditor(elementEditingArea,this),this.__recipeEditor.onChange.add(this.__onRecipeEditorChanged),this.__recipeEditor.setLocalizations({tableHeaderName:this.__expandLocalizationSymbol("Table_Header_Name"),tableHeaderValue:this.__expandLocalizationSymbol("Table_Header_Value"),tableHeaderMin:this.__expandLocalizationSymbol("Table_Header_Min"),tableHeaderMax:this.__expandLocalizationSymbol("Table_Header_Max"),tableHeaderUnit:this.__expandLocalizationSymbol("Table_Header_Unit"),tableHeaderComment:this.__expandLocalizationSymbol("Table_Header_Comment"),editorLocalizations:{optionalEditor:{optionalCheckboxTooltip:this.__expandLocalizationSymbol("Editor_Checkbox_Tooltip_Optional")},booleanEditor:{falseText:this.__expandLocalizationSymbol("Editor_Combobox_Text_False"),trueText:this.__expandLocalizationSymbol("Editor_Combobox_Text_True")},buttonBasedEditor:{buttonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_Open")},timeEditor:{dateTimeButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_DateTime"),timespanButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_Timespan")},choiceEditor:{comboboxText:this.__expandLocalizationSymbol("Editor_Combobox_Text_ChooseType")},arrayBasedEditorPane:{addButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_AddItem"),removeButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_RemoveItem"),upButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_ItemUp"),downButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_ItemDown")},objectEditorPane:{addButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_AddProperty"),acceptButtonText:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),acceptButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_AcceptProperty"),cancelButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_CancelProperty"),removeButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_RemoveProperty")},arrayEditorPrompt:{buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")},objectEditorPrompt:{buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")},tupleEditorPrompt:{buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")}},recipeReferenceEditorLocalizations:{buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel"),openPopupButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_Open"),recipePopupHeaderText:this.__expandLocalizationSymbol("Popup_Header_Recipe")}});const elementEditingButtons=this.__elementTemplateRoot.querySelector(".TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-editing-pane .TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-container");if(!elementEditingButtons)throw new Error("Invalid Template.html - An element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-pane' must exist and contain a child element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-container'.");const activateButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonActivate",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Activate")},this);if(!activateButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const activateElement=activateButton.getElement()[0];activateElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-activate-recipe"),elementEditingButtons.appendChild(activateElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(activateButton.getId()+".onPressed",this.__onActivatePressed)),this.__childControls.push(activateButton);const teachButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonTeach",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_ReadFromTarget")},this);if(!teachButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const teachElement=teachButton.getElement()[0];teachElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-teach-recipe"),elementEditingButtons.appendChild(teachElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(teachButton.getId()+".onPressed",this.__onTeachPressed)),this.__childControls.push(teachButton);const saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonSave",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Save"),"data-tchmi-is-enabled":!1},this);if(!saveButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const saveElement=saveButton.getElement()[0];saveElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-save"),elementEditingButtons.appendChild(saveElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(saveButton.getId()+".onPressed",this.__onSavePressed)),this.__childControls.push(saveButton);const closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonClose",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Close")},this);if(!closeButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const closeElement=closeButton.getElement()[0];closeElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-exit"),elementEditingButtons.appendChild(closeElement),this.__destroyOnDestroy.push(TcHmi.EventProvider.register(closeButton.getId()+".onPressed",this.__onClosePressed)),this.__childControls.push(closeButton),this.__buttons={createFolder:newFolderButton,createRecipe:newRecipeButton,rename:renameButton,copy:copyButton,cut:cutButton,paste:pasteButton,delete:deleteButton,activate:activateButton,teach:teachButton,save:saveButton,close:closeButton};const createMapping={controlRight:"operate",virtualControlRight:"create"};this.__buttons.createFolder.setVirtualControlRightMappings([createMapping]),this.__buttons.createRecipe.setVirtualControlRightMappings([createMapping]),this.__buttons.rename.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"rename"}]),this.__buttons.copy.setVirtualControlRightMappings([createMapping]),this.__buttons.cut.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"cut"}]),this.__buttons.paste.setVirtualControlRightMappings([createMapping]),this.__buttons.delete.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"delete"}]),this.__buttons.activate.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"activateRecipe"}]),this.__buttons.teach.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"teachRecipe"}]),this.__buttons.save.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"editRecipe"}]),this.__processPath()}__attach(){super.__attach(),this.__recipeBrowser?.resume(),this.__lockIsEnabled(),this.__updateRecipeWatches(),this.__updateSymbolAccessSubscription()}__detach(){super.__detach(),this.__updateRecipeWatches(!0),this.__updateSymbolAccessSubscription(!0)}destroy(){if(!this.__keepAlive){this.__recipeEditor?.destroy(),this.__namePrompt?.destroy(),this.__namePrompt=null,this.__createRecipePrompt?.destroy(),this.__createRecipePrompt=null,this.__confirmDeletionPrompt?.destroy(),this.__confirmDeletionPrompt=null,this.__activatePrompt?.destroy(),this.__activatePrompt=null,this.__teachErrorPopup?.destroy(),this.__teachErrorPopup=null,this.__confirmClosePrompt?.destroy(),this.__confirmClosePrompt=null;for(const control of this.__childControls)control.destroy();this.__childControls=[],super.destroy()}}__onNewFolderPressed(){this.__createFolder()}__onNewRecipePressed(){this.__createRecipe()}__onRenamePressed(){this.__rename()}__onCopyPressed(){this.__fillClipboard("copy")}__onCutPressed(){this.__fillClipboard("cut")}__onPastePressed(){this.__paste()}__onDeletePressed(){this.__delete()}__onSelectionChanged(selectedItems){TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SelectedItems"}),TcHmi.EventProvider.raise(this.__id+".onSelectionChanged"),this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__updateBrowsingButtons(selectedItems)}__onBeforePathChange(newCurrentItem,newPath,cancelable){return this.__checkUnsavedChanges()}__onPathChanged(currentItem,path){this.setPath(path?.join("::")??null),this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__openOrCloseEditor(currentItem?.payload,path)}__onDragAndDropped(dragged,droppedOnto){this.__moveItem(dragged,droppedOnto)}__onActivatePressed(){this.__activate()}__onTeachPressed(){this.__teach()}__onSavePressed(){try{this.__save()}catch(ex){}}__onClosePressed(){this.__closeEditor()}__onRecipeEditorChanged(editor){this.__updateEditingButtons()}__expandLocalizationSymbol(key){return`%l%Control::${TcHmiRecipeEdit.#tchmiFQN}::${key}%/l%`}__updateButtonAccess(){const canWriteConfig=this.__symbolAccess["{0}.Config"]>=TcHmi.Server.ACCESS.WRITE,canRename=this.__symbolAccess.Rename>=TcHmi.Server.ACCESS.WRITE,canActivateRecipe=this.__symbolAccess["{0}.ActivateRecipe"]>=TcHmi.Server.ACCESS.WRITE,canReadFromTarget=this.__symbolAccess["{0}.ReadFromTarget"]>=TcHmi.Server.ACCESS.WRITE,canUpdateRecipe=this.__symbolAccess["{0}.UpdateRecipe"]>=TcHmi.Server.ACCESS.WRITE;TcHmi.Access.setControlRightOverride(this.__buttons.createFolder,"operate",canWriteConfig?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig?"Button_Tooltip_CreateFolder":"Button_Tooltip_CreateFolder_MissingSymbolAccess"),"Tooltip",this.__buttons.createFolder),TcHmi.Access.setControlRightOverride(this.__buttons.createRecipe,"operate",canWriteConfig&&canUpdateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig&&canUpdateRecipe?"Button_Tooltip_CreateRecipe":"Button_Tooltip_CreateRecipe_MissingSymbolAccess"),"Tooltip",this.__buttons.createRecipe),TcHmi.Access.setControlRightOverride(this.__buttons.rename,"operate",canRename?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canRename?"Button_Tooltip_Rename":"Button_Tooltip_Rename_MissingSymbolAccess"),"Tooltip",this.__buttons.rename),TcHmi.Access.setControlRightOverride(this.__buttons.copy,"operate",canWriteConfig&&canUpdateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig&&canUpdateRecipe?"Button_Tooltip_Copy":"Button_Tooltip_Copy_MissingSymbolAccess"),"Tooltip",this.__buttons.copy),TcHmi.Access.setControlRightOverride(this.__buttons.cut,"operate",canRename?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canRename?"Button_Tooltip_Cut":"Button_Tooltip_Cut_MissingSymbolAccess"),"Tooltip",this.__buttons.cut),TcHmi.Access.setControlRightOverride(this.__buttons.paste,"operate",null===this.__clipboard||("copy"===this.__clipboard.action?canWriteConfig&&canUpdateRecipe:canRename)?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(null===this.__clipboard||("copy"===this.__clipboard.action?canWriteConfig&&canUpdateRecipe:canRename)?"Button_Tooltip_Paste":"Button_Tooltip_Paste_MissingSymbolAccess"),"Tooltip",this.__buttons.paste),TcHmi.Access.setControlRightOverride(this.__buttons.delete,"operate",canWriteConfig?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig?"Button_Tooltip_Delete":"Button_Tooltip_Delete_MissingSymbolAccess"),"Tooltip",this.__buttons.delete),TcHmi.Access.setControlRightOverride(this.__buttons.activate,"operate",canActivateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canActivateRecipe?"Button_Tooltip_Activate":"Button_Tooltip_Activate_MissingSymbolAccess"),"Tooltip",this.__buttons.activate),TcHmi.Access.setControlRightOverride(this.__buttons.teach,"operate",canReadFromTarget?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canReadFromTarget?"Button_Tooltip_ReadFromTarget":"Button_Tooltip_ReadFromTarget_MissingSymbolAccess"),"Tooltip",this.__buttons.teach),TcHmi.Access.setControlRightOverride(this.__buttons.save,"operate",canWriteConfig&&canUpdateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig&&canUpdateRecipe?"Button_Tooltip_Save":"Button_Tooltip_Save_MissingSymbolAccess"),"Tooltip",this.__buttons.save);const confirmCloseSaveButton=this.__confirmClosePrompt?.getButtons().get("save")?.button;confirmCloseSaveButton&&TcHmi.Access.setControlRightOverride(confirmCloseSaveButton,"operate",canWriteConfig&&canUpdateRecipe?null:"Deny")}__createNamePrompt(){const prompt=new Controls.Helpers.InputPrompt(this);return prompt.setBackgroundAction({close:!0,action:"cancel"}),prompt.setValidationPatterns([{pattern:/::/,expectedTestResult:!1},{pattern:/^(?:|\.\.?)$/,expectedTestResult:!1}]),prompt.setLocalizations({labelText:this.__expandLocalizationSymbol("Popup_Label_Name"),buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")}),prompt}async __createFolder(){if(!TcHmi.Access.checkAccess(this,"create"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;const currentItem=this.__recipeBrowser.getCurrentItem();if(!currentItem||currentItem.type===Controls.Helpers.DirectoryBrowser.ItemType.File)return;const path=this.__recipeBrowser.getPath();if(path){this.__namePrompt||(this.__namePrompt=this.__createNamePrompt()),this.__namePrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_NewFolder")});try{const result=await this.__namePrompt.prompt(currentItem.children.keys(),this.__localizationReader?.get("New_Folder"));if(result.isOk){path.push(result.value);const stringPath=path.join("::");TcHmi.Server.RecipeManagement.createRecipeFolderEx(stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to create recipe folder. ${TcHmi.Log.buildMessage(data.details)}`)})}}catch(e){}}}async __createRecipe(){if(!TcHmi.Access.checkAccess(this,"create"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;if(!this.__recipeEditor)return;const currentItem=this.__recipeBrowser.getCurrentItem();if(!currentItem||currentItem.type===Controls.Helpers.DirectoryBrowser.ItemType.File)return;const path=this.__recipeBrowser.getPath();if(path){this.__createRecipePrompt||(this.__createRecipePrompt=new Beckhoff.TcHmiRecipeEditComponents.CreateRecipePrompt(this),this.__createRecipePrompt.setBackgroundAction({close:!0,action:"cancel"}),this.__createRecipePrompt.setRecipeManagementDomain(this.__serverDomain),this.__createRecipePrompt.setAllowedRecipeTypes(this.__allowedRecipeTypes??null),this.__createRecipePrompt.setLocalizations({buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel"),headerText:this.__expandLocalizationSymbol("Popup_Header_NewRecipe"),nameLabelText:this.__expandLocalizationSymbol("Popup_Label_Name"),recipeTypeLabelText:this.__expandLocalizationSymbol("Popup_Label_RecipeType"),selectButtonTooltip:this.__expandLocalizationSymbol("Popup_Button_Tooltip_RecipeType"),recipeTypePopupHeaderText:this.__expandLocalizationSymbol("Popup_Header_RecipeType")}));try{const result=await this.__createRecipePrompt.prompt(currentItem.children.keys(),this.__localizationReader?.get("New_Recipe"));if(result.isOk){const recipePath=path.concat(result.value.name);this.__recipeBrowser.fakeFile(recipePath,{recipeTypeName:result.value.recipeTypeName,values:{}}),this.__element[0].classList.add("editing"),this.__recipeBrowser.setPath(recipePath),this.__recipeEditor.populate({name:result.value.recipeTypeName,recipeType:result.value.recipeType},{name:recipePath.join("::")}),this.__recipeBrowser.suspendDirectoryUpdates()}}catch(e){}}}async __rename(){if(!TcHmi.Access.checkAccess(this,"rename"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;const currentItem=this.__recipeBrowser.getCurrentItem();if(!currentItem||currentItem.type===Controls.Helpers.DirectoryBrowser.ItemType.File)return;const selectedItems=this.__recipeBrowser.getSelectedItems();if(!selectedItems||1!==selectedItems.length)return;const path=this.__recipeBrowser.getPath();if(!path)return;const selectedItem=selectedItems[0];this.__namePrompt||(this.__namePrompt=this.__createNamePrompt()),this.__namePrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_Rename")});try{const result=await this.__namePrompt.prompt(Array.from(currentItem.children.keys()).filter(name=>name!==selectedItem.name),selectedItem.name);if(result.isOk&&result.value!==selectedItem.name){const stringPath=path.join("::");TcHmi.Server.RecipeManagement.isRecipe(selectedItem.payload)?TcHmi.Server.RecipeManagement.renameRecipeEx(selectedItem.name,stringPath,result.value,stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to rename recipe. ${TcHmi.Log.buildMessage(data.details)}`)}):TcHmi.Server.RecipeManagement.renameRecipeFolderEx(selectedItem.name,stringPath,result.value,stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to rename recipe folder. ${TcHmi.Log.buildMessage(data.details)}`)})}}catch(e){}}async __delete(){if(!TcHmi.Access.checkAccess(this,"delete"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;const currentItem=this.__recipeBrowser.getCurrentItem()?.payload;if(!currentItem||TcHmi.Server.RecipeManagement.isRecipe(currentItem))return;const selectedItems=this.__recipeBrowser.getSelectedItems();if(!selectedItems||0===selectedItems.length)return;const path=this.__recipeBrowser.getPath();if(path){this.__confirmDeletionPrompt||(this.__confirmDeletionPrompt=new Controls.Helpers.TextAndButtonsPrompt({yes:{value:!0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_Yes")}},no:{value:!1,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_No")}}},this),this.__confirmDeletionPrompt.setBackgroundAction({close:!0,action:"no"}),this.__confirmDeletionPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_ConfirmDelete"),contentText:this.__expandLocalizationSymbol("Popup_Text_ConfirmDelete")}));try{if(await this.__confirmDeletionPrompt.prompt())for(const selectedItem of selectedItems)if(TcHmi.Server.RecipeManagement.isRecipe(selectedItem.payload)){const stringPath=path.join("::");TcHmi.Server.RecipeManagement.deleteRecipeEx(selectedItem.name,stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to delete recipe. ${TcHmi.Log.buildMessage(data.details)}`)})}else{path.push(selectedItem.name);const stringPath=path.join("::");TcHmi.Server.RecipeManagement.deleteRecipeFolderEx(stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to delete recipe folder. ${TcHmi.Log.buildMessage(data.details)}`)})}}catch(e){}}}__fillClipboard(action){const items=this.__recipeBrowser?.getSelectedItems(),path=this.__recipeBrowser?.getPath();items&&path&&(this.__clipboard={action,origin:path,items},this.__buttons.paste.setIsEnabled(!0),this.__updateButtonAccess(),this.__buttons.paste.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"cut"===action?"cut":"create"}]))}async __paste(){if(!this.__clipboard||!this.__recipeBrowser)return;if("cut"===this.__clipboard.action&&tchmi_equal(this.__clipboard.origin,this.__recipeBrowser.getFolderPath()))return void(this.__clipboard.action="copy");const itemsToPaste=new Map(this.__clipboard.items.map(item=>[item.name,item])),existingNames=new Set(this.__recipeBrowser.getCurrentFolder()?.children.keys()),conflictingNames=new Set;for(const name of itemsToPaste.keys())existingNames.has(name)&&conflictingNames.add(name),existingNames.add(name);if(conflictingNames.size>0){const result=await this.__resolveFileNameConflicts(conflictingNames,existingNames);if(!result.isOk)return;for(const name of conflictingNames){const resolvedName=result.value.get(name);if(resolvedName){if(resolvedName!==name){const item=itemsToPaste.get(name);item&&itemsToPaste.set(resolvedName,item),itemsToPaste.delete(name)}}else itemsToPaste.delete(name)}}if(0!==itemsToPaste.size)switch(this.__clipboard.action){case"copy":this.__copyPaste(itemsToPaste,this.__recipeBrowser.getFolderPath()??[]);break;case"cut":this.__cutPaste(itemsToPaste,this.__clipboard.origin,this.__recipeBrowser.getFolderPath()??[])}}__copyPaste(itemsToPaste,target){if(!this.__serverDomain)return;const path=target.join("::");for(const[name,item]of itemsToPaste)if(item.type===Controls.Helpers.DirectoryBrowser.ItemType.File)TcHmi.Server.RecipeManagement.createRecipeEx(name,path,item.payload,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to create recipe. ${TcHmi.Log.buildMessage(data.details)}`)});else{const subPath=target.concat(name);TcHmi.Server.RecipeManagement.createRecipeFolderEx(subPath.join("::"),{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE?TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to create recipe folder. ${TcHmi.Log.buildMessage(data.details)}`):this.__copyPaste(item.children,subPath)})}}__cutPaste(itemsToPaste,origin,target){if(!this.__clipboard||!this.__serverDomain)return;const oldPath=origin.join("::"),newPath=target.join("::");for(const[newName,item]of itemsToPaste)item.type===Controls.Helpers.DirectoryBrowser.ItemType.File?TcHmi.Server.RecipeManagement.renameRecipeEx(item.name,oldPath,newName,newPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to move recipe. ${TcHmi.Log.buildMessage(data.details)}`)}):TcHmi.Server.RecipeManagement.renameRecipeFolderEx(item.name,oldPath,newName,newPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to move recipe. ${TcHmi.Log.buildMessage(data.details)}`)});this.__clipboard.action="copy"}async __resolveFileNameConflicts(conflictingNames,existingNames){const currentFolder=this.__recipeBrowser?.getCurrentFolder();if(!currentFolder)return{isOk:!1};const conflictMap=new Map,canDelete=TcHmi.Access.checkAccess(this,"delete")??!1;for(const name of conflictingNames)conflictMap.set(name,canDelete);const popup=new Beckhoff.TcHmiRecipeEditComponents.FileConflictPrompt(conflictMap,existingNames,this);popup.setBackgroundAction({close:!0,action:"cancel"}),popup.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_FileConflict"),labelText:this.__expandLocalizationSymbol("Popup_Label_FileConflict"),labelDoForAll:this.__expandLocalizationSymbol("Popup_FileConflict_Label_DoForAll"),radioTextSkip:this.__expandLocalizationSymbol("Popup_FileConflict_Radio_Text_Skip"),radioTextReplace:this.__expandLocalizationSymbol("Popup_FileConflict_Radio_Text_Replace"),radioTextKeepBoth:this.__expandLocalizationSymbol("Popup_FileConflict_Radio_Text_KeepBoth"),buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")});const result=await popup.prompt();return popup.destroy(!0),result}__updateBrowsingButtons(selectedItems){this.__buttons.rename.setIsEnabled(selectedItems&&1===selectedItems.length),this.__buttons.copy.setIsEnabled(selectedItems&&selectedItems.length>0),this.__buttons.cut.setIsEnabled(selectedItems&&selectedItems.length>0),this.__buttons.delete.setIsEnabled(selectedItems&&selectedItems.length>0)}__openOrCloseEditor(currentItem,path){if(this.__recipeEditor)if(path&&currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)){if(!this.__element[0].classList.contains("editing")){const recipeName=path.join("::");this.__recipeEditor.populate({name:currentItem.recipeTypeName},{name:recipeName,recipe:currentItem}),this.__element[0].classList.add("editing"),this.__recipeBrowser?.suspendDirectoryUpdates(),this.__updateActiveRecipesSubscription(null,null,recipeName),TcHmi.EventProvider.raise(this.__id+".onEditStarted",{name:recipeName,recipe:currentItem})}}else this.__element[0].classList.contains("editing")&&(this.__element[0].classList.remove("editing"),this.__recipeEditor.clear(),this.__recipeBrowser?.clearFakedFile(),this.__recipeBrowser?.resumeDirectoryUpdates(),this.__updateActiveRecipesSubscription(null,null,""))}async __checkUnsavedChanges(){if(!this.__recipeEditor)return!0;if(!this.__element[0].classList.contains("editing")||!this.__recipeEditor.getRecipeName())return!0;const state=this.__recipeEditor.getState();if(state.isValid&&!state.hasChanges)return TcHmi.EventProvider.raise(this.__id+".onEditEnded",{name:state.recipeName,recipe:state.value}),!0;this.__confirmClosePrompt||(this.__confirmClosePrompt=new Controls.Helpers.TextAndButtonsPrompt({save:{value:"save",attributes:{"data-tchmi-width":120,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_SaveChanges")}},discard:{value:"discard",attributes:{"data-tchmi-width":120,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_DiscardChanges")}},cancel:{value:"cancel",attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_Cancel")}}},this),this.__confirmClosePrompt.setBackgroundAction({close:!0,action:"cancel"}),this.__confirmClosePrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_UnsavedChanges"),contentText:this.__expandLocalizationSymbol("Popup_Text_UnsavedChanges")}));const saveButton=this.__confirmClosePrompt.getButtons().get("save")?.button;saveButton?.setIsEnabled(state.isValid),saveButton?.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"editRecipe"}]),saveButton&&TcHmi.Access.setControlRightOverride(saveButton,"operate",this.__symbolAccess["{0}.Config"]>=TcHmi.Server.ACCESS.WRITE&&this.__symbolAccess["{0}.UpdateRecipe"]>=TcHmi.Server.ACCESS.WRITE?null:"Deny");try{switch(await this.__confirmClosePrompt.prompt()){case"save":try{await this.__save()}catch(e){return!1}return state.isValid&&TcHmi.EventProvider.raise(this.__id+".onEditEnded",{name:state.recipeName,recipe:state.value}),!0;case"discard":const path=this.__recipeBrowser?.getPath(),currentItem=this.__recipeBrowser?.getCurrentItem()?.payload;return path&&currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&TcHmi.EventProvider.raise(this.__id+".onEditEnded",{name:path.join("::"),recipe:currentItem}),!0;case"cancel":return!1}}catch(e){return!1}}__moveItem(dragged,droppedOnto){if(!TcHmi.Access.checkAccess(this,"rename"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;const currentItem=this.__recipeBrowser.getCurrentItem()?.payload;if(!currentItem||TcHmi.Server.RecipeManagement.isRecipe(currentItem))return;const path=this.__recipeBrowser.getPath();if(!path)return;const stringPath=path.join("::"),newPath=droppedOnto.isParent?path.slice(0,-1).join("::"):path.concat(droppedOnto.name).join("::");TcHmi.Server.RecipeManagement.isRecipe(currentItem[dragged])?TcHmi.Server.RecipeManagement.renameRecipeEx(dragged,stringPath,dragged,newPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to move recipe. ${TcHmi.Log.buildMessage(data.details)}`)}):TcHmi.Server.RecipeManagement.renameRecipeFolderEx(dragged,stringPath,dragged,newPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to move recipe folder. ${TcHmi.Log.buildMessage(data.details)}`)})}async __activate(){if(!this.__recipeEditor)return;const recipeName=this.__recipeEditor.getRecipeName();if(!recipeName)return;const state=this.__recipeEditor.getState();if(!state.isValid||state.hasChanges){this.__activatePrompt||(this.__activatePrompt=new Controls.Helpers.TextAndButtonsPrompt({saveAndActivate:{value:"saveAndActivate",attributes:{"data-tchmi-width":160,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_SaveAndActivate")}},justActivate:{value:"justActivate",attributes:{"data-tchmi-width":160,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_JustActivate")}},cancel:{value:"cancel",attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_Cancel")}}},this),this.__activatePrompt.setBackgroundAction({close:!0,action:"cancel"}),this.__activatePrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_UnsavedChanges"),contentText:this.__expandLocalizationSymbol("Popup_Text_UnsavedChangesActivating")}));const saveButton=this.__activatePrompt.getButtons().get("saveAndActivate")?.button;saveButton?.setIsEnabled(state.isValid),saveButton?.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"editRecipe"}]),saveButton&&TcHmi.Access.setControlRightOverride(saveButton,"operate",this.__symbolAccess["{0}.Config"]>=TcHmi.Server.ACCESS.WRITE&&this.__symbolAccess["{0}.UpdateRecipe"]>=TcHmi.Server.ACCESS.WRITE?null:"Deny");const activateButton=this.__activatePrompt.getButtons().get("justActivate")?.button;activateButton?.setIsEnabled(this.__recipeEditor.recipeExists());try{switch(await this.__activatePrompt.prompt()){case"saveAndActivate":await this.__save();break;case"justActivate":break;case"cancel":return}}catch(e){return}}TcHmi.Server.RecipeManagement.activateEx(recipeName,null,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to activate recipe. ${TcHmi.Log.buildMessage(data.details)}`),this.__watchActiveRecipeConditions.userHasRights&&this.__elementPathBox?.classList.add("active")})}async __teach(){if(!this.__recipeEditor)return;const recipeName=this.__recipeEditor.getRecipeName();if(recipeName){if(!this.__recipeEditor.recipeExists()){if(!this.__recipeEditor.getState().isValid)return this.__teachErrorPopup||(this.__teachErrorPopup=new Controls.Helpers.TextAndButtonsPrompt({ok:{value:void 0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_OK")}}},this),this.__teachErrorPopup.setBackgroundAction({close:!0,action:"ok"}),this.__teachErrorPopup.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_ReadFromTargetError"),contentText:this.__expandLocalizationSymbol("Popup_Text_ReadFromTargetError")})),void this.__teachErrorPopup.show();try{await this.__save()}catch(e){return}}TcHmi.Server.RecipeManagement.readFromTargetEx(recipeName,null,{domain:this.__serverDomain,parallel:!0},null,data=>{const recipe=data.value?.[recipeName];data.error===TcHmi.Errors.NONE&&recipe?this.__recipeEditor.setRecipeValues(recipe):TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to teach recipe. ${TcHmi.Log.buildMessage(data.details)}`)})}}__save(){return new Promise((resolve,reject)=>{if(!this.__recipeEditor)return void reject(new Error);const state=this.__recipeEditor.getState();if(state.isValid){const recipe=state.value;this.__recipeEditor.recipeExists()?TcHmi.Server.RecipeManagement.updateRecipeEx(state.recipeName,null,recipe.values,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE?(TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to update recipe. ${TcHmi.Log.buildMessage(data.details)}`),reject(new Error)):(this.__recipeEditor.confirmSave(),resolve())}):TcHmi.Server.RecipeManagement.createRecipeEx(state.recipeName,null,recipe,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE?(TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to create recipe. ${TcHmi.Log.buildMessage(data.details)}`),reject(new Error)):(this.__recipeEditor.confirmSave(),this.__recipeBrowser?.clearFakedFile(),resolve())})}else reject(new Error)})}async __closeEditor(){if(!this.__recipeBrowser)return;if(!this.__recipeEditor)return;await this.__checkUnsavedChanges()&&(this.__element[0].classList.remove("editing"),this.__recipeEditor.clear(),this.__recipeBrowser.clearFakedFile(),this.__recipeBrowser.resumeDirectoryUpdates(),this.__recipeBrowser.setPath(this.__recipeBrowser.getFolderPath()??[]))}__updateEditingButtons(){if(!this.__recipeEditor)return;const state=this.__recipeEditor.getState();this.__buttons.save.setIsEnabled(state.isValid&&state.hasChanges)}setServerDomain(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ServerDomain")),tchmi_equal(convertedValue,this.__serverDomain)||(this.__serverDomain=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ServerDomain"}),this.__processServerDomain())}getServerDomain(){return this.__serverDomain}__processServerDomain(){this.__updateRecipeWatches(),this.__updateSymbolAccessSubscription(),this.__serverDomain&&this.__createRecipePrompt?.setRecipeManagementDomain(this.__serverDomain)}setPath(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Path")),tchmi_equal(convertedValue,this.__path)||(this.__oldPath=this.__path,this.__path=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Path"}),this.__processPath())}getPath(){return this.__path}async __processPath(){if(!this.__recipeBrowser)return;await this.__recipeBrowser.setPath(this.__path?this.__path.split("::"):[])||(this.__path=this.__oldPath,TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Attribute:"Path"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_INVALID,message:TcHmi.Errors[TcHmi.Errors.E_INVALID],reason:`The path "${this.__path}" is invalid or was rejected by the user.`,domain:this.__type})))}setAllowedRecipeTypes(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew)??this.getAttributeDefaultValueInternal("AllowedRecipeTypes"),resolverInfo=this.__objectResolvers.get("allowedRecipeTypes");resolverInfo?.watchDestroyer?.(),resolverInfo?.resolver.destroy();let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,{parentControl:this,type:this.getAttributeDescription("AllowedRecipeTypes")?.type});this.__objectResolvers.set("allowedRecipeTypes",{resolver,watchCallback:this.__onResolverForAllowedRecipeTypesWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForAllowedRecipeTypesWatchCallback)})}__onResolverForAllowedRecipeTypesWatchCallback(data){this.__isAttached||this.__suspendObjectResolver("allowedRecipeTypes"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.getAllowedRecipeTypes())||(this.__allowedRecipeTypes=data.value??this.getAttributeDefaultValueInternal("AllowedRecipeTypes"),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowedRecipeTypes"}),this.__processAllowedRecipeTypes()):TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Attribute:"AllowedRecipeTypes"},TcHmi.Log.buildMessage(data.details),`Resolving symbols from object failed with error: ${TcHmi.Log.buildMessage(data.details)}`)}getAllowedRecipeTypes(){return this.__allowedRecipeTypes}__processAllowedRecipeTypes(){this.__unwatchRecipeList&&(this.__unwatchRecipeList(),this.__unwatchRecipeList=null,this.__updateRecipeListWatch(null,null)),this.__createRecipePrompt?.setAllowedRecipeTypes(this.__allowedRecipeTypes??null)}getSelectedItems(){return(this.__recipeBrowser?.getSelectedItems()??[]).map(item=>item.name)}__updateRecipeWatches(unwatchOnly=!1){TCHMI_DESIGNER||(this.__unwatchRecipeList?.(),this.__unwatchRecipeList=null,this.__unwatchRecipeManagementDomain?.(),this.__unwatchRecipeManagementDomain=null,null!==this.__activeRecipesSubscriptionId&&(TcHmi.Server.unsubscribeEx(this.__activeRecipesSubscriptionId,null),this.__activeRecipesSubscriptionId=null),!unwatchOnly&&this.__isAttached&&this.__serverDomain?this.__unwatchRecipeManagementDomain=TcHmi.Server.Domains.watch(this.__serverDomain,data=>{data.error===TcHmi.Errors.NONE?"Loaded"===data.value?.state||"Initialized"===data.value?.state?(this.__unlockIsEnabled(),this.__unwatchRecipeList||(this.__updateRecipeListWatch(!0,null),this.__updateActiveRecipesSubscription(!0,null,null)),this.__recipeEditor?.setRecipeManagementDomain(this.__serverDomain??null),this.__createRecipePrompt?.setRecipeManagementDomain(this.__serverDomain??null)):(this.__lockIsEnabled(),this.__updateRecipeListWatch(!1,null),this.__updateActiveRecipesSubscription(!1,null,null),this.__recipeEditor?.setRecipeManagementDomain(null),this.__createRecipePrompt?.setRecipeManagementDomain(null),TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Domain '${this.__serverDomain}' is not loaded. Please make sure the server extension is activated.`)):(this.__lockIsEnabled(),this.__updateRecipeListWatch(!1,null),this.__updateActiveRecipesSubscription(!1,null,null),this.__recipeEditor?.setRecipeManagementDomain(null),this.__createRecipePrompt?.setRecipeManagementDomain(null),TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Domain '${this.__serverDomain}' is not known. Please make sure the server extension is loaded and the domain name is correct. ${TcHmi.Log.buildMessage(data.details)}`))}):this.__recipeBrowser?.setDirectory(null,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipe))}__lockIsEnabled(){const unlockValue=this.__isEnabledLock.unlockValue;this.setIsEnabled(!1),this.__isEnabledLock.locked=!0,this.__isEnabledLock.unlockValue=unlockValue}__unlockIsEnabled(){this.__isEnabledLock.locked=!1,this.setIsEnabled(this.__isEnabledLock.unlockValue)}setIsEnabled(valueNew){this.__isEnabledLock.unlockValue=valueNew,this.__isEnabledLock.locked||super.setIsEnabled(valueNew)}__updateRecipeListWatch(extensionLoaded,userHasRights){if(TCHMI_DESIGNER)return;let conditionsChanged=!1;null!==extensionLoaded&&extensionLoaded!==this.__watchRecipeConditions.extensionLoaded&&(this.__watchRecipeConditions.extensionLoaded=extensionLoaded,conditionsChanged=!0),null!==userHasRights&&userHasRights!==this.__watchRecipeConditions.userHasRights&&(this.__watchRecipeConditions.userHasRights=userHasRights,conditionsChanged=!0),(conditionsChanged||null===this.__unwatchRecipeList)&&(this.__unwatchRecipeList?.(),this.__unwatchRecipeList=null,this.__isAttached&&this.__serverDomain&&this.__watchRecipeConditions.extensionLoaded&&this.__watchRecipeConditions.userHasRights?this.__unwatchRecipeList=TcHmi.Server.RecipeManagement.watchRecipeList({domain:this.__serverDomain,parallel:!0},this.__onRecipeListWatch):this.__recipeBrowser?.setDirectory(null,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipe))}__onRecipeListWatch(data){let recipes=null;if(data.error?TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to list recipes of domain '${this.__serverDomain}'. Please make sure the domain is a recipe management extension. ${TcHmi.Log.buildMessage(data.details)}`):data.value?recipes=data.value:TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,`Failed to list recipes of domain '${this.__serverDomain}'. Please make sure the domain is a recipe management extension.`),this.__watchRecipeListResult=recipes,this.__onRecipeListReceivedManager.trigger(recipes),recipes&&this.__allowedRecipeTypes?.length){const filter=folder=>{const filtered={};for(const[name,item]of Object.entries(folder))TcHmi.Server.RecipeManagement.isRecipe(item)?this.__allowedRecipeTypes.includes(item.recipeTypeName)&&(filtered[name]=item):filtered[name]=filter(item);return filtered};recipes=filter(recipes)}this.__recipeBrowser?.setDirectory(recipes,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipe)}__registerOnRecipeListReceived(callback){return callback(this.__watchRecipeListResult),this.__onRecipeListReceivedManager.add(callback)}__unregisterOnRecipeListReceived(callback){this.__onRecipeListReceivedManager.remove(callback)}__updateActiveRecipesSubscription(extensionLoaded,userHasRights,recipe){if(TCHMI_DESIGNER)return;let conditionsChanged=!1;if(null!==extensionLoaded&&extensionLoaded!==this.__watchActiveRecipeConditions.extensionLoaded&&(this.__watchActiveRecipeConditions.extensionLoaded=extensionLoaded,conditionsChanged=!0),null!==userHasRights&&userHasRights!==this.__watchActiveRecipeConditions.userHasRights&&(this.__watchActiveRecipeConditions.userHasRights=userHasRights,conditionsChanged=!0),null!==recipe&&recipe!==this.__watchActiveRecipeConditions.recipe&&(this.__watchActiveRecipeConditions.recipe=recipe,conditionsChanged=!0),!conditionsChanged&&null!==this.__activeRecipesSubscriptionId)return;if(null!==this.__activeRecipesSubscriptionId&&(TcHmi.Server.unsubscribeEx(this.__activeRecipesSubscriptionId,null),this.__activeRecipesSubscriptionId=null),!this.__isAttached||!this.__serverDomain)return void this.__elementPathBox?.classList.remove("active");if(!this.__watchActiveRecipeConditions.extensionLoaded||!this.__watchActiveRecipeConditions.userHasRights||!recipe)return void this.__elementPathBox?.classList.remove("active");const symbol=this.__serverDomain+".GetActiveRecipes";this.__activeRecipesSubscriptionId=TcHmi.Server.subscribeEx([{commandOptions:["SendErrorMessage","SendWriteValue"],symbol,writeValue:[recipe]}],TcHmi.Config.get().tcHmiServer.websocketIntervalTime,{parallel:!0},data=>{if(data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetActiveRecipes"},TcHmi.Log.buildMessage(data.details));if(!data.response)return void TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetActiveRecipes"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__type}));if(data.response.error)return void TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetActiveRecipes"},TcHmi.Log.buildMessage(data.response.error));if(!data.response.commands)return void TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetActiveRecipes"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__type}));const command=data.response.commands.find(command=>command.symbol===symbol&&command.writeValue?.includes(recipe));command?command.error?TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetActiveRecipes"},TcHmi.Log.buildMessage(command.error)):command.readValue?this.__elementPathBox?.classList.toggle("active",command.readValue.includes(recipe)):TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetActiveRecipes"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue in response from server with id: '${data.response.id}'.`,domain:this.__type})):TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetActiveRecipes"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMAND_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMAND_MISSING],reason:`Missing command for symbol '${symbol}' in response from server with id: '${data.response.id}'.`,domain:this.__type}))})}__updateSymbolAccessSubscription(unsubscribeOnly=!1){if(TCHMI_DESIGNER)return;if(null!==this.__symbolAccessSubscriptionId&&(TcHmi.Server.unsubscribeEx(this.__symbolAccessSubscriptionId,null),this.__symbolAccessSubscriptionId=null),unsubscribeOnly||!this.__isAttached||!this.__serverDomain)return;const writeValuePropertyMap={},commands=Object.keys(this.__symbolAccess).map(symbolName=>{const writeValue=tchmi_format_string(symbolName,this.__serverDomain);return writeValuePropertyMap[writeValue]=symbolName,{symbol:"GetSymbolAccess",writeValue,commandOptions:["SendWriteValue","SendErrorMessage"]}});this.__symbolAccessSubscriptionId=TcHmi.Server.subscribeEx(commands,TcHmi.Config.get().tcHmiServer.websocketIntervalTime,{parallel:!0},data=>{if(data.error===TcHmi.Errors.NONE)if(data.response)if(data.response.error)TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},TcHmi.Log.buildMessage(data.response.error));else if(data.response.commands){for(const command of data.response.commands)command.error?TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},TcHmi.Log.buildMessage(command.error)):void 0!==command.readValue?command.writeValue?this.__symbolAccess[writeValuePropertyMap[command.writeValue]]=command.readValue:TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_WRITEVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_WRITEVALUE_MISSING],reason:`Missing writeValue in response from server with id: '${data.response.id}'.`,domain:this.__type})):TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue in response from server with id: '${data.response.id}'.`,domain:this.__type}));this.__symbolAccess["{0}.Config"]===TcHmi.Server.ACCESS.NONE&&TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},`The TcHmiRecipeEdit control needs at least read access to the ${this.__serverDomain}.Config symbol to be able to display recipes.`),this.__symbolAccess["{0}.GetActiveRecipes"]<TcHmi.Server.ACCESS.WRITE&&TcHmi.Log.Controls.warn(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},`Without write access access to the ${this.__serverDomain}.GetActiveRecipes symbol the control cannot show recipe activation status.`),this.__updateButtonAccess(),this.__updateRecipeListWatch(null,!!(this.__symbolAccess["{0}.Config"]&TcHmi.Server.ACCESS.READ)),this.__updateActiveRecipesSubscription(null,this.__symbolAccess["{0}.GetActiveRecipes"]>=TcHmi.Server.ACCESS.WRITE,null)}else TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__type}));else TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__type}));else TcHmi.Log.Controls.error(this,TcHmiRecipeEdit.#tchmiFQN,{Symbol:"GetSymbolAccess"},TcHmi.Log.buildMessage(data.details))})}}})();Beckhoff.TcHmiRecipeEdit=TcHmiRecipeEdit}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiRecipeEdit","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiRecipeEdit),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){TcHmiRecipeEditComponents.RecipeTypeParser=class{__recipeManagementDomain;__parentControl;constructor(__recipeManagementDomain,__parentControl){this.__recipeManagementDomain=__recipeManagementDomain,this.__parentControl=__parentControl}async parse(recipeTypeName,recipeType){return recipeType||(recipeType=(await this.__getRecipeTypes([recipeTypeName]))[0]),await this.__parseRecipeType(recipeTypeName,recipeType)}__getRecipeTypes(names){return new Promise((resolve,reject)=>{if(!this.__recipeManagementDomain)return void reject(new Error(TcHmi.Log.buildMessage({code:TcHmi.Errors.ERROR,message:TcHmi.Errors[TcHmi.Errors.ERROR],reason:"No recipe management domain was specified.",domain:this.__parentControl?.getType()})));const recipeTypes=[];for(const name of names){const result=TcHmi.Server.RecipeManagement.getRecipeTypeEx(name,null,{domain:this.__recipeManagementDomain,parallel:!0},null,data=>{if(data.error===TcHmi.Errors.NONE&&data.value)recipeTypes.push(data.value),recipeTypes.length===names.length&&resolve(recipeTypes);else if(data.details)reject(new Error(TcHmi.Log.buildMessage(data.details)));else{let res={code:TcHmi.Errors.ERROR,message:TcHmi.Errors[TcHmi.Errors.ERROR],reason:"Unknown error occured while getting recipe type."};this.__parentControl&&(res.domain=this.__parentControl.getType()),reject(new Error(TcHmi.Log.buildMessage(res)))}});if(result.code!==TcHmi.Errors.NONE)return void reject(new Error(TcHmi.Log.buildMessage(result)))}})}async __parseRecipeType(recipeTypeName,recipeType){const parsed={name:recipeTypeName,ungroupedMembers:[],memberGroups:new Map,membersEnabled:"Disabled"!==recipeType.options?.enabled,comment:recipeType.options?.comment},symbols=new Map,parse=async recipeType=>{for(const key in recipeType.members){const member=recipeType.members[key];if(!member)continue;let parsedMember;if(member.group){let group=parsed.memberGroups.get(member.group);group||(group=[],parsed.memberGroups.set(member.group,group)),parsedMember=tchmi_clone_object(member),parsedMember.name=key,parsedMember.enabled=(parsed.membersEnabled&&parsedMember.enabled)??!1,group.push(parsedMember)}else parsedMember=tchmi_clone_object(member),parsedMember.name=key,parsedMember.enabled=(parsed.membersEnabled&&parsedMember.enabled)??!1,parsed.ungroupedMembers.push(parsedMember);if("symbol"in parsedMember){const symbolsEntry=symbols.get(parsedMember.symbol);symbolsEntry?symbolsEntry.push(parsedMember):symbols.set(parsedMember.symbol,[parsedMember])}}if(recipeType.recipeTypeNames&&recipeType.recipeTypeNames.length>0){const bases=await this.__getRecipeTypes(recipeType.recipeTypeNames);for(const base of bases)await parse(base)}};await parse(recipeType);const schemas=await this.__getSchemas(new Set(symbols.keys()));for(const[symbol,schema]of schemas){const symbolMembers=symbols.get(symbol);if(symbolMembers)for(const symbolMember of symbolMembers)symbolMember.symbolType=schema}const sort=(a,b)=>void 0!==a.order&&void 0!==b.order?a.order-b.order:void 0===a.order&&void 0===b.order?a.name<b.name?-1:a.name>b.name?1:0:void 0!==a.order?-1:1;return parsed.ungroupedMembers.sort(sort),parsed.memberGroups.forEach(memberGroup=>memberGroup.sort(sort)),parsed.memberGroups=new Map(Array.from(parsed.memberGroups).sort(([_a,aMembers],[_b,bMembers])=>sort(aMembers[0],bMembers[0]))),parsed}__getSchemas(symbols){return 0===symbols.size?Promise.resolve(new Map):new Promise((resolve,reject)=>{const schemas=new Map;for(const symbol of symbols)TcHmi.Symbol.resolveSchema(`%s%${symbol}%/s%`,data=>{if(data.error!==TcHmi.Errors.NONE||!data.schema){const details=data.details||{code:data.error,message:TcHmi.Errors[data.error],domain:"TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents.RecipeTypeParser"};return void reject(new TcHmi.Exception(details))}schemas.set(symbol,data.schema),schemas.size===symbols.size&&resolve(schemas)})})}}}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){let RecipeEditor=(()=>{let ___onEditorChanged_decorators,_instanceExtraInitializers=[];return class RecipeEditor{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onEditorChanged_decorators=[TcHmi.CallbackMethod],__esDecorate(this,null,___onEditorChanged_decorators,{kind:"method",name:"__onEditorChanged",static:!1,private:!1,access:{has:obj=>"__onEditorChanged"in obj,get:obj=>obj.__onEditorChanged},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__element=__runInitializers(this,_instanceExtraInitializers);__parentControl;static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents."+this.name;__tableBody;__recipeManagementDomain=null;__recipe=null;__recipeName=null;__recipeTypeName=null;__editorFactory;__editors=new Map;__tableHeaders;__localizations=void 0;__localizationSymbols=new Map;__onChangeManager=new Controls.Helpers.CallbackManager;onChange=this.__onChangeManager.getManipulators();constructor(__element,__parentControl){this.__element=__element,this.__parentControl=__parentControl,this.__editorFactory=new Controls.Helpers.EditorFactory({parentControl:this.__parentControl,texts:this.__localizations?.editorLocalizations});const table=document.createElement("table"),thead=document.createElement("thead");table.appendChild(thead);const tr=document.createElement("tr");thead.appendChild(tr),this.__tableHeaders={name:tr.appendChild(document.createElement("th")),value:tr.appendChild(document.createElement("th")),min:tr.appendChild(document.createElement("th")),max:tr.appendChild(document.createElement("th")),unit:tr.appendChild(document.createElement("th")),comment:tr.appendChild(document.createElement("th"))},this.__tableBody=document.createElement("tbody"),table.appendChild(this.__tableBody),__element.appendChild(table)}destroy(){this.clear();for(const entry of this.__localizationSymbols.values())entry.destroyWatch(),entry.symbol.destroy();this.__localizationSymbols.clear()}async populate(recipeType,recipe){let parsedRecipeType;try{parsedRecipeType=await new TcHmiRecipeEditComponents.RecipeTypeParser(this.__recipeManagementDomain,this.__parentControl).parse(recipeType.name,recipeType.recipeType)}catch(e){return void TcHmi.Log.Controls.error(this.__parentControl,RecipeEditor.#tchmiFQN,`Could not populate recipe editor. ${e instanceof Error?e.message:"Unknown error"}`)}this.__recipe=recipe.recipe??null,this.__recipeName=recipe.name,this.__recipeTypeName=recipeType.name,this.__render(parsedRecipeType,recipe.recipe),this.__onChangeManager.trigger(this)}clear(){this.__recipe=null,this.__recipeName=null,this.__recipeTypeName=null,this.__clearTableBodyAndEditors(),this.__onChangeManager.trigger(this)}__clearTableBodyAndEditors(){for(const editor of this.__editors.values())editor.destroy();for(this.__editors.clear();this.__tableBody.firstElementChild;)this.__tableBody.firstElementChild.remove()}__render(recipeType,recipe){this.__clearTableBodyAndEditors();const fragment=document.createDocumentFragment();for(const member of recipeType.ungroupedMembers)fragment.appendChild(this.__createMemberRow(member,recipe?.values[member.name]));for(const[groupName,group]of recipeType.memberGroups){const tr=document.createElement("tr"),groupCell=document.createElement("td");groupCell.colSpan=6,groupCell.textContent=groupName,tr.appendChild(groupCell),fragment.appendChild(tr);for(const member of group)fragment.appendChild(this.__createMemberRow(member,recipe?.values[member.name]))}this.__tableBody.appendChild(fragment)}__createMemberRow(member,value){const tr=document.createElement("tr"),nameCell=document.createElement("td");if(TcHmi.Symbol.isSymbolExpression(member.name)?this.__watchLocalization(member.name,{symbolExpression:member.name,formatValues:[]},text=>{nameCell.textContent=text}):nameCell.textContent=member.name,tr.appendChild(nameCell),"symbol"in member){const valueCell=document.createElement("td");valueCell.classList.add("value-cell");let editorInfo=Controls.Helpers.SchemaParser.parse(member.symbolType);member.schema&&Object.keys(member.schema).length>0&&(editorInfo=Controls.Helpers.SchemaParser.mergeEditorInfos(editorInfo,Controls.Helpers.SchemaParser.parse(member.schema)));const editor=this.__editorFactory.fromEditorInfo(editorInfo,valueCell);this.__editors.set(member.name,editor),editor.setIsEnabled(member.enabled),void 0!==value?editor.setValue(value):void 0!==member.defaultValue&&editor.setValue(member.defaultValue),editor.onChange.add(this.__onEditorChanged),tr.appendChild(valueCell);const minCell=document.createElement("td");void 0!==member.schema?.minimum&&(minCell.textContent=member.schema.minimum.toString()),tr.appendChild(minCell);const maxCell=document.createElement("td");void 0!==member.schema?.maximum&&(maxCell.textContent=member.schema.maximum.toString()),tr.appendChild(maxCell);const unitCell=document.createElement("td");member.unit&&(unitCell.textContent=member.unit),tr.appendChild(unitCell);const commentCell=document.createElement("td");member.comment&&(commentCell.textContent=member.comment),tr.appendChild(commentCell)}else{const valueCell=document.createElement("td");valueCell.classList.add("value-cell");const editor=new TcHmiRecipeEditComponents.RecipeReferenceEditor(valueCell,member.recipeType,this.__parentControl);editor.setLocalizations(this.__localizations?.recipeReferenceEditorLocalizations??{}),this.__editors.set(member.name,editor),editor.setIsEnabled(member.enabled),void 0!==value&&editor.setValue(value),editor.onChange.add(this.__onEditorChanged),tr.appendChild(valueCell);const spanCell=document.createElement("td");spanCell.colSpan=3,tr.appendChild(spanCell);const commentCell=document.createElement("td");member.comment&&(commentCell.textContent=member.comment),tr.appendChild(commentCell)}return tr}__onEditorChanged(){this.__onChangeManager.trigger(this)}setRecipeValues(recipe){if(this.__recipeTypeName===recipe.recipeTypeName)for(const[name,editor]of this.__editors)name in recipe.values&&editor.setValue(recipe.values[name])}getState(){if(null===this.__recipeTypeName)return{isValid:!1};if(null===this.__recipeName)return{isValid:!1};const values={};for(const[name,editor]of this.__editors){const state=editor.getState();if(!state.isValid)return{isValid:!1};values[name]=state.value}const value={recipeTypeName:this.__recipeTypeName,values};return{isValid:!0,value,recipeName:this.__recipeName,recipeTypeName:this.__recipeTypeName,hasChanges:!tchmi_equal(this.__recipe,value)}}getRecipeName(){return this.__recipeName}recipeExists(){return null!==this.__recipe}confirmSave(){const state=this.getState();state.isValid&&(this.__recipe=state.value),this.__onChangeManager.trigger(this)}setRecipeManagementDomain(domain){this.__recipeManagementDomain!==domain&&(this.__recipeManagementDomain=domain)}getRecipeManagementDomain(){return this.__recipeManagementDomain}setLocalizations(texts){if(this.__localizations||(this.__localizations=texts),texts.tableHeaderName&&(this.__watchLocalization("tableHeaderName","string"==typeof texts.tableHeaderName?{symbolExpression:texts.tableHeaderName,formatValues:[]}:texts.tableHeaderName,text=>this.__tableHeaders.name.textContent=text),this.__localizations.tableHeaderName=texts.tableHeaderName),texts.tableHeaderValue&&(this.__watchLocalization("tableHeaderValue","string"==typeof texts.tableHeaderValue?{symbolExpression:texts.tableHeaderValue,formatValues:[]}:texts.tableHeaderValue,text=>this.__tableHeaders.value.textContent=text),this.__localizations.tableHeaderValue=texts.tableHeaderValue),texts.tableHeaderMin&&(this.__watchLocalization("tableHeaderMin","string"==typeof texts.tableHeaderMin?{symbolExpression:texts.tableHeaderMin,formatValues:[]}:texts.tableHeaderMin,text=>this.__tableHeaders.min.textContent=text),this.__localizations.tableHeaderMin=texts.tableHeaderMin),texts.tableHeaderMax&&(this.__watchLocalization("tableHeaderMax","string"==typeof texts.tableHeaderMax?{symbolExpression:texts.tableHeaderMax,formatValues:[]}:texts.tableHeaderMax,text=>this.__tableHeaders.max.textContent=text),this.__localizations.tableHeaderMax=texts.tableHeaderMax),texts.tableHeaderUnit&&(this.__watchLocalization("tableHeaderUnit","string"==typeof texts.tableHeaderUnit?{symbolExpression:texts.tableHeaderUnit,formatValues:[]}:texts.tableHeaderUnit,text=>this.__tableHeaders.unit.textContent=text),this.__localizations.tableHeaderUnit=texts.tableHeaderUnit),texts.tableHeaderComment&&(this.__watchLocalization("tableHeaderComment","string"==typeof texts.tableHeaderComment?{symbolExpression:texts.tableHeaderComment,formatValues:[]}:texts.tableHeaderComment,text=>this.__tableHeaders.comment.textContent=text),this.__localizations.tableHeaderComment=texts.tableHeaderComment),texts.editorLocalizations){if(this.__localizations.editorLocalizations)for(const[name,subEditorLocalizations]of Object.entries(texts.editorLocalizations))if(this.__localizations.editorLocalizations[name])for(const[textName,text]of Object.entries(subEditorLocalizations))this.__localizations.editorLocalizations[name][textName]=text;else this.__localizations.editorLocalizations[name]=subEditorLocalizations;else this.__localizations.editorLocalizations=texts.editorLocalizations;for(const editor of this.__editors.values())editor instanceof Controls.Helpers.Editor&&editor.setLocalizations(texts.editorLocalizations)}if(texts.recipeReferenceEditorLocalizations){if(this.__localizations.recipeReferenceEditorLocalizations)for(const[name,text]of Object.entries(texts.recipeReferenceEditorLocalizations))this.__localizations.recipeReferenceEditorLocalizations[name]=text;else this.__localizations.recipeReferenceEditorLocalizations=texts.recipeReferenceEditorLocalizations;for(const editor of this.__editors.values())editor instanceof TcHmiRecipeEditComponents.RecipeReferenceEditor&&editor.setLocalizations(texts.recipeReferenceEditorLocalizations)}}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);existing?.destroyWatch(),existing?.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbolExpression),destroyWatch=symbol.watch(data=>{if(data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.Controls.error(this.__parentControl,RecipeEditor.#tchmiFQN,{SymbolExpression:localization.symbolExpression},TcHmi.Log.buildMessage(data.details));let text=data.value??"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)});this.__localizationSymbols.set(name,{symbol,destroyWatch})}}})();TcHmiRecipeEditComponents.RecipeEditor=RecipeEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){let RecipeReferenceEditor=(()=>{let ___onPressed_decorators,___onPathItemClicked_decorators,___onRecipeListReceived_decorators,_instanceExtraInitializers=[];return class RecipeReferenceEditor{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onPressed_decorators=[TcHmi.CallbackMethod],___onPathItemClicked_decorators=[TcHmi.CallbackMethod],___onRecipeListReceived_decorators=[TcHmi.CallbackMethod],__esDecorate(this,null,___onPressed_decorators,{kind:"method",name:"__onPressed",static:!1,private:!1,access:{has:obj=>"__onPressed"in obj,get:obj=>obj.__onPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPathItemClicked_decorators,{kind:"method",name:"__onPathItemClicked",static:!1,private:!1,access:{has:obj=>"__onPathItemClicked"in obj,get:obj=>obj.__onPathItemClicked},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onRecipeListReceived_decorators,{kind:"method",name:"__onRecipeListReceived",static:!1,private:!1,access:{has:obj=>"__onRecipeListReceived"in obj,get:obj=>obj.__onRecipeListReceived},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__element=__runInitializers(this,_instanceExtraInitializers);__recipeType;__parentControl;static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents."+this.name;__eventDestroyers=new Set;__container;__pathBoxElement;__button;__selectRecipePrompt;__recipe=null;__isEnabled=!0;__localizationSymbols=new Map;__onChangeManager=new Controls.Helpers.CallbackManager;onChange=this.__onChangeManager.getManipulators();constructor(__element,__recipeType,__parentControl){this.__element=__element,this.__recipeType=__recipeType,this.__parentControl=__parentControl;const controlClass=this.__parentControl.getType().replace(/\./g,"_");__element.classList.add(`${controlClass}-editor`,"TcHmi_Controls_Helpers_Editor"),this.__container=document.createElement("div"),this.__container.classList.add("compound-control-container","with-validation","invalid"),this.__pathBoxElement=this.__container.appendChild(document.createElement("div"));const pathDisplay=new Controls.Helpers.PathDisplay(this.__pathBoxElement,this.__parentControl);this.__selectRecipePrompt=new TcHmiRecipeEditComponents.SelectRecipePrompt(pathDisplay,this.__parentControl),this.__selectRecipePrompt.setBackgroundAction({close:!0,action:"cancel"});const name=`${this.__parentControl.getId()}.${this.constructor.name}-${tchmi_create_guid()}`,button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${name}.button`,{"data-tchmi-width":26,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-text":"..."},this.__parentControl);if(!button)throw new Error("Could not create controls for button based editor.");this.__button=button,this.__container.appendChild(button.getElement()[0]),this.__element.appendChild(this.__container),this.__eventDestroyers.add(TcHmi.EventProvider.register(button.getId()+".onPressed",this.__onPressed)),this.__pathBoxElement.addEventListener("click",this.__onPathItemClicked),this.__parentControl.__registerOnRecipeListReceived(this.__onRecipeListReceived),this.__selectRecipePrompt.resume()}destroy(){TcHmi.Binding.removeEx2(null,"Tooltip",this.__button);for(const destroy of this.__eventDestroyers)destroy();this.__eventDestroyers.clear(),this.__pathBoxElement.removeEventListener("click",this.__onPathItemClicked),this.__button.destroy(),this.__parentControl.__unregisterOnRecipeListReceived(this.__onRecipeListReceived),this.__selectRecipePrompt.suspend();for(const entry of this.__localizationSymbols.values())entry.destroyWatch(),entry.symbol.destroy();this.__localizationSymbols.clear()}async setValue(value){value?this.__setRecipe(await this.__selectRecipePrompt.setPath(value.split("::"))):(this.__selectRecipePrompt.reset(),this.__setRecipe(null))}getState(){return this.__recipe&&this.__recipe.recipe.recipeTypeName===this.__recipeType?{isValid:!0,value:this.__recipe.name}:{isValid:!1}}setIsEnabled(isEnabled){this.__isEnabled=isEnabled,this.__element.classList.toggle("disabled",!isEnabled),this.__button.setIsEnabled(isEnabled)}getIsEnabled(){return this.__isEnabled}__onPressed(){this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__promptRecipe()}__onPathItemClicked(event){this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&event.target instanceof Element&&event.target.closest("li")&&this.__promptRecipe()}async __promptRecipe(){try{const result=await this.__selectRecipePrompt.prompt();result.isOk&&this.__setRecipe(result.value)}catch(e){}}__setRecipe(recipe){this.__recipe=recipe,this.__container.classList.toggle("invalid",!this.__recipe||this.__recipe.recipe.recipeTypeName!==this.__recipeType),this.__onChangeManager.trigger(this)}__onRecipeListReceived(rootDirectory){const filteredRecipes=tchmi_clone_object(rootDirectory),filter=dir=>{for(const[name,value]of Object.entries(dir))TcHmi.Server.RecipeManagement.isRecipe(value)?value.recipeTypeName!==this.__recipeType&&delete dir[name]:filter(value)};null!==filteredRecipes&&filter(filteredRecipes),this.__selectRecipePrompt.setRecipeList(filteredRecipes)}setLocalizations(texts){texts.openPopupButtonTooltip&&("string"==typeof texts.openPopupButtonTooltip?(this.__unwatchLocalization("openPopupButtonTooltip"),TcHmi.Binding.createEx2(texts.openPopupButtonTooltip,"Tooltip",this.__button)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__button),this.__watchLocalization("openPopupButtonTooltip",texts.openPopupButtonTooltip,text=>this.__button.setTooltip(text)))),this.__selectRecipePrompt.setLocalizations({buttonTextOk:texts.buttonTextOk,buttonTooltipOk:texts.buttonTooltipOk,buttonTextCancel:texts.buttonTextCancel,buttonTooltipCancel:texts.buttonTooltipCancel,headerText:texts.recipePopupHeaderText})}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);existing?.destroyWatch(),existing?.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbolExpression),destroyWatch=symbol.watch(data=>{if(data.error!==TcHmi.Errors.NONE)return void TcHmi.Log.Controls.error(this.__parentControl,RecipeReferenceEditor.#tchmiFQN,{SymbolExpression:localization.symbolExpression},TcHmi.Log.buildMessage(data.details));let text=data.value??"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)});this.__localizationSymbols.set(name,{symbol,destroyWatch})}__unwatchLocalization(name){const existing=this.__localizationSymbols.get(name);existing&&(existing.destroyWatch(),existing.symbol.destroy(),this.__localizationSymbols.delete(name))}}})();TcHmiRecipeEditComponents.RecipeReferenceEditor=RecipeReferenceEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){let CreateRecipePrompt=(()=>{let ___onTextChanged_decorators,___onSelectPressed_decorators,___onPathItemClicked_decorators,_classSuper=Controls.Helpers.OkCancelPrompt,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onTextChanged_decorators=[TcHmi.CallbackMethod],___onSelectPressed_decorators=[TcHmi.CallbackMethod],___onPathItemClicked_decorators=[TcHmi.CallbackMethod],__esDecorate(this,null,___onTextChanged_decorators,{kind:"method",name:"__onTextChanged",static:!1,private:!1,access:{has:obj=>"__onTextChanged"in obj,get:obj=>obj.__onTextChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onSelectPressed_decorators,{kind:"method",name:"__onSelectPressed",static:!1,private:!1,access:{has:obj=>"__onSelectPressed"in obj,get:obj=>obj.__onSelectPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPathItemClicked_decorators,{kind:"method",name:"__onPathItemClicked",static:!1,private:!1,access:{has:obj=>"__onPathItemClicked"in obj,get:obj=>obj.__onPathItemClicked},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__textbox=__runInitializers(this,_instanceExtraInitializers);__forbiddenNames=new Set;__nameLabel;__recipeTypeLabel;__pathBoxElement;__selectRecipeTypePrompt;__selectButton;__recipeType=null;constructor(parentControl){super(parentControl),this.__nameLabel=document.createElement("span"),this.__nameLabel.className=`${this.__className}-label-block`,this.__elementContent.appendChild(this.__nameLabel);const textbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}Popup.textbox`,{"data-tchmi-width":300,"data-tchmi-height":26,"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl);if(!textbox)throw new Error("Could not create controls for NamePrompt.");this.__textbox=textbox;const textboxElement=textbox.getElement()[0];textboxElement.classList.add("with-validation"),this.__elementContent.appendChild(textboxElement),this.__destroyers.push(TcHmi.EventProvider.register(textbox.getId()+".onTextChanged",this.__onTextChanged)),this.__recipeTypeLabel=document.createElement("span"),this.__recipeTypeLabel.className=`${this.__className}-label-block`,this.__elementContent.appendChild(this.__recipeTypeLabel),this.__pathBoxElement=document.createElement("div"),this.__pathBoxElement.className=`${this.__className}-path-box`,this.__elementContent.appendChild(this.__pathBoxElement);const selectButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}Popup.selectButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-text":"..."},this.__parentControl);if(!selectButton)throw new Error("Could not create controls for NamePrompt.");const selectButtonElement=selectButton.getElement()[0];selectButtonElement.classList.add(`${this.__className}-select-button`),this.__elementContent.appendChild(selectButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(selectButton.getId()+".onPressed",this.__onSelectPressed));const pathDisplay=new Controls.Helpers.PathDisplay(this.__pathBoxElement,this.__parentControl);this.__selectRecipeTypePrompt=new TcHmiRecipeEditComponents.SelectRecipeTypePrompt(pathDisplay,this.__parentControl),this.__selectRecipeTypePrompt.setBackgroundAction({close:!0,action:"cancel"}),this.__childControls.push(textbox,selectButton),this.__selectButton=selectButton}destroy(force=!1){TcHmi.Binding.removeEx2(null,"Tooltip",this.__selectButton),super.destroy(force)}__onTextChanged(){if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;const text=this.__textbox.getText(),isValid=void 0!==text&&this.__isValidName(text);this.__okButton.setIsEnabled(null!==this.__recipeType&&isValid),this.__textbox.getElement()[0].classList.toggle("invalid",!isValid)}__onSelectPressed(){this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__promptRecipeType()}__onPathItemClicked(event){this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&event.target instanceof Element&&event.target.closest("li")&&this.__promptRecipeType()}__isValidName(text){return text.length>0&&!text.includes("::")&&".."!==text&&"."!==text&&!this.__forbiddenNames.has(text)}async __promptRecipeType(){try{const result=await this.__selectRecipeTypePrompt.prompt();if(result.isOk){this.__recipeType=result.value;const text=this.__textbox.getText();this.__okButton.setIsEnabled(void 0!==text&&this.__isValidName(text))}}catch(e){}}__ok(){const text=this.__textbox.getText();this.__recipeType&&void 0!==text&&this.__isValidName(text)?this.__prompt?.answer({isOk:!0,value:{name:text,recipeTypeName:this.__recipeType.name,recipeType:this.__recipeType.recipeType}}):this.__prompt?.error(new Error("Invalid name or missing recipe type."))}setRecipeManagementDomain(recipeManagementDomain){this.__selectRecipeTypePrompt.setRecipeManagementDomain(recipeManagementDomain)}setAllowedRecipeTypes(allowedRecipeTypes){this.__selectRecipeTypePrompt.setAllowedRecipeTypes(allowedRecipeTypes)}prompt(forbiddenNames=null,defaultValue=""){this.__forbiddenNames=new Set(forbiddenNames),this.__recipeType=null,this.__textbox.setText(defaultValue);const input=this.__textbox.getElement()[0].querySelector("input");return input instanceof HTMLInputElement&&(input.selectionDirection="forward",input.selectionStart=0,input.selectionEnd=input.value.length),this.__okButton.setIsEnabled(!1),super.prompt()}show(){const oldOpeningState=this.isShowing();if(super.show(),oldOpeningState)return;this.__selectRecipeTypePrompt.resume();const input=this.__textbox.getElement()[0].querySelector("input");input instanceof HTMLInputElement&&input.focus(),this.__pathBoxElement.addEventListener("click",this.__onPathItemClicked)}hide(){super.hide(),this.__selectRecipeTypePrompt.reset(),this.__selectRecipeTypePrompt.suspend(),this.__pathBoxElement.removeEventListener("click",this.__onPathItemClicked)}setLocalizations(texts){super.setLocalizations(texts),this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader),this.__applyTextToElement("nameLabelText",texts.nameLabelText,this.__nameLabel),this.__applyTextToElement("recipeTypeLabelText",texts.recipeTypeLabelText,this.__recipeTypeLabel),this.__applyTextToControl("selectButtonTooltip",texts.selectButtonTooltip,this.__selectButton,"Tooltip"),this.__selectRecipeTypePrompt.setLocalizations({buttonTextOk:texts.buttonTextOk,buttonTooltipOk:texts.buttonTooltipOk,buttonTextCancel:texts.buttonTextCancel,buttonTooltipCancel:texts.buttonTooltipCancel,headerText:texts.recipeTypePopupHeaderText})}}})();TcHmiRecipeEditComponents.CreateRecipePrompt=CreateRecipePrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){let SelectRecipePrompt=(()=>{let ___onPathChanged_decorators,___onSelectionChanged_decorators,_classSuper=Controls.Helpers.OkCancelPrompt,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onPathChanged_decorators=[TcHmi.CallbackMethod],___onSelectionChanged_decorators=[TcHmi.CallbackMethod],__esDecorate(this,null,___onPathChanged_decorators,{kind:"method",name:"__onPathChanged",static:!1,private:!1,access:{has:obj=>"__onPathChanged"in obj,get:obj=>obj.__onPathChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onSelectionChanged_decorators,{kind:"method",name:"__onSelectionChanged",static:!1,private:!1,access:{has:obj=>"__onSelectionChanged"in obj,get:obj=>obj.__onSelectionChanged},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents."+this.name;__recipeBrowser=__runInitializers(this,_instanceExtraInitializers);__initialPath=null;constructor(pathDisplay,parentControl){super(parentControl);const ulist=document.createElement("ul");ulist.className=`${this.__className}-browsing-box`,this.__elementContent.appendChild(ulist);const browsingDisplay=new Controls.Helpers.ListBrowsingDisplay(ulist,this.__parentControl);this.__recipeBrowser=new Controls.Helpers.DirectoryBrowser([pathDisplay,browsingDisplay],this.__parentControl),this.__recipeBrowser.onPathChange.add(this.__onPathChanged),this.__recipeBrowser.onSelectionChange.add(this.__onSelectionChanged)}__onPathChanged(currentItem,path){currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem.payload)?(this.__okButton.setIsEnabled(!0),this.__ok()):this.__okButton.setIsEnabled(!1)}__onSelectionChanged(selectedItems){selectedItems&&1===selectedItems.length&&TcHmi.Server.RecipeManagement.isRecipe(selectedItems[0].payload)?this.__okButton.setIsEnabled(!0):this.__okButton.setIsEnabled(!1)}suspend(){this.__recipeBrowser.suspend(!0)}resume(){this.__recipeBrowser.resume()}async setPath(value){await this.__recipeBrowser.setPath(value);const currentItem=this.__recipeBrowser.getCurrentItem()?.payload,path=this.__recipeBrowser.getPath();return currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&path?{name:path.join("::"),recipe:currentItem}:null}reset(){this.__recipeBrowser.setPath([])}setRecipeList(rootDirectory){this.__recipeBrowser.setDirectory(rootDirectory,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipe)}async __ok(){let currentItem=this.__recipeBrowser.getCurrentItem()?.payload;if(!currentItem)return void this.__prompt?.error(new Error("No recipe types available."));const selectedItem=this.__recipeBrowser.getSelectedItems()?.[0];let path=this.__recipeBrowser.getPath();!TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&selectedItem&&path&&(await this.__recipeBrowser.setPath(path.concat(selectedItem.name)),currentItem=this.__recipeBrowser.getCurrentItem()?.payload,path=this.__recipeBrowser.getPath()),currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&path?this.__prompt?.answer({isOk:!0,value:{name:path.join("::"),recipe:currentItem}}):this.__prompt?.error(new Error("Invalid recipe type selection."))}__cancel(){this.__initialPath&&this.__recipeBrowser.setPath(this.__initialPath),super.__cancel()}async prompt(){this.__initialPath=this.__recipeBrowser.getPath();const currentItem=this.__recipeBrowser.getCurrentItem()?.payload,promise=super.prompt();return this.__initialPath&&this.__initialPath.length>0&&currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&await this.__recipeBrowser.setPath(this.__initialPath.slice(0,-1))&&this.__recipeBrowser.selectItem(this.__initialPath[this.__initialPath.length-1],!1),promise}setLocalizations(texts){super.setLocalizations(texts),this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader)}}})();TcHmiRecipeEditComponents.SelectRecipePrompt=SelectRecipePrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){let SelectRecipeTypePrompt=(()=>{let ___onPathChanged_decorators,___onSelectionChanged_decorators,___onRecipeTypeListWatch_decorators,_classSuper=Controls.Helpers.OkCancelPrompt,_instanceExtraInitializers=[];return class SelectRecipeTypePrompt extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onPathChanged_decorators=[TcHmi.CallbackMethod],___onSelectionChanged_decorators=[TcHmi.CallbackMethod],___onRecipeTypeListWatch_decorators=[TcHmi.CallbackMethod],__esDecorate(this,null,___onPathChanged_decorators,{kind:"method",name:"__onPathChanged",static:!1,private:!1,access:{has:obj=>"__onPathChanged"in obj,get:obj=>obj.__onPathChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onSelectionChanged_decorators,{kind:"method",name:"__onSelectionChanged",static:!1,private:!1,access:{has:obj=>"__onSelectionChanged"in obj,get:obj=>obj.__onSelectionChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onRecipeTypeListWatch_decorators,{kind:"method",name:"__onRecipeTypeListWatch",static:!1,private:!1,access:{has:obj=>"__onRecipeTypeListWatch"in obj,get:obj=>obj.__onRecipeTypeListWatch},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents."+this.name;__recipeTypeBrowser=__runInitializers(this,_instanceExtraInitializers);__initialPath=null;__recipeManagementDomain=null;__allowedRecipeTypes=null;__unwatchRecipeTypesList=null;constructor(pathDisplay,parentControl){super(parentControl);const ulist=document.createElement("ul");ulist.className=`${this.__className}-browsing-box`,this.__elementContent.appendChild(ulist);const browsingDisplay=new Controls.Helpers.ListBrowsingDisplay(ulist,this.__parentControl);this.__recipeTypeBrowser=new Controls.Helpers.DirectoryBrowser([pathDisplay,browsingDisplay],this.__parentControl),this.__recipeTypeBrowser.onPathChange.add(this.__onPathChanged),this.__recipeTypeBrowser.onSelectionChange.add(this.__onSelectionChanged)}__onPathChanged(currentItem,path){currentItem&&TcHmi.Server.RecipeManagement.isRecipeType(currentItem.payload)?(this.__okButton.setIsEnabled(!0),this.__ok()):this.__okButton.setIsEnabled(!1)}__onSelectionChanged(selectedItems){selectedItems&&1===selectedItems.length&&TcHmi.Server.RecipeManagement.isRecipeType(selectedItems[0].payload)?this.__okButton.setIsEnabled(!0):this.__okButton.setIsEnabled(!1)}suspend(){this.__recipeTypeBrowser.suspend(!0),this.__unwatchRecipeTypesList?.(),this.__unwatchRecipeTypesList=null}resume(){this.__recipeManagementDomain&&(this.__unwatchRecipeTypesList=TcHmi.Server.RecipeManagement.watchRecipeTypesList({domain:this.__recipeManagementDomain,parallel:!0},this.__onRecipeTypeListWatch)),this.__recipeTypeBrowser.resume()}reset(){this.__recipeTypeBrowser.setPath([])}setRecipeManagementDomain(recipeManagementDomain){this.__recipeManagementDomain=recipeManagementDomain,this.__watchRecipeTypes()}setAllowedRecipeTypes(allowedRecipeTypes){this.__allowedRecipeTypes=allowedRecipeTypes,this.__watchRecipeTypes()}__watchRecipeTypes(){this.__unwatchRecipeTypesList?.(),this.__isShowing&&this.__recipeManagementDomain?this.__unwatchRecipeTypesList=TcHmi.Server.RecipeManagement.watchRecipeTypesList({domain:this.__recipeManagementDomain,parallel:!0},this.__onRecipeTypeListWatch):this.__unwatchRecipeTypesList=null}__onRecipeTypeListWatch(data){let recipeTypes=null;if(data.error?TcHmi.Log.Controls.error(this.__parentControl,SelectRecipeTypePrompt.#tchmiFQN,`Failed to list recipe types of domain ${this.__recipeManagementDomain}. Please make sure the domain is a recipe management extension. ${TcHmi.Log.buildMessage(data.details)}`):data.value?recipeTypes=data.value:TcHmi.Log.Controls.error(this.__parentControl,SelectRecipeTypePrompt.#tchmiFQN,`Failed to list recipe types of domain ${this.__recipeManagementDomain}. Please make sure the domain is a recipe management extension.`),recipeTypes&&this.__allowedRecipeTypes?.length){const filter=(folder,path=[])=>{const filtered={};for(const[name,item]of Object.entries(folder))TcHmi.Server.RecipeManagement.isRecipeType(item)?this.__allowedRecipeTypes.includes(path.concat(name).join("::"))&&(filtered[name]=item):filtered[name]=filter(item,path.concat(name));return filtered};recipeTypes=filter(recipeTypes)}this.__recipeTypeBrowser.setDirectory(recipeTypes,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipeType)}async __ok(){let currentItem=this.__recipeTypeBrowser.getCurrentItem()?.payload;if(!currentItem)return void this.__prompt?.error(new Error("No recipe types available."));const selectedItem=this.__recipeTypeBrowser.getSelectedItems()?.[0];let path=this.__recipeTypeBrowser.getPath();!TcHmi.Server.RecipeManagement.isRecipeType(currentItem)&&selectedItem&&path&&(await this.__recipeTypeBrowser.setPath(path.concat(selectedItem.name)),currentItem=this.__recipeTypeBrowser.getCurrentItem()?.payload,path=this.__recipeTypeBrowser.getPath()),currentItem&&TcHmi.Server.RecipeManagement.isRecipeType(currentItem)&&path?this.__prompt?.answer({isOk:!0,value:{name:path.join("::"),recipeType:currentItem}}):this.__prompt?.error(new Error("Invalid recipe type selection."))}__cancel(){this.__initialPath&&this.__recipeTypeBrowser.setPath(this.__initialPath),super.__cancel()}async prompt(){this.__initialPath=this.__recipeTypeBrowser.getPath();const currentItem=this.__recipeTypeBrowser.getCurrentItem()?.payload,promise=super.prompt();return this.__initialPath&&this.__initialPath.length>0&&currentItem&&TcHmi.Server.RecipeManagement.isRecipeType(currentItem)&&await this.__recipeTypeBrowser.setPath(this.__initialPath.slice(0,-1))&&this.__recipeTypeBrowser.selectItem(this.__initialPath[this.__initialPath.length-1],!1),promise}setLocalizations(texts){super.setLocalizations(texts),this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader)}}})();TcHmiRecipeEditComponents.SelectRecipeTypePrompt=SelectRecipeTypePrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){let FileConflictPrompt=(()=>{let ___onRadioStateChanged_decorators,_classSuper=Controls.Helpers.OkCancelPrompt,_instanceExtraInitializers=[];return class extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___onRadioStateChanged_decorators=[TcHmi.CallbackMethod],__esDecorate(this,null,___onRadioStateChanged_decorators,{kind:"method",name:"__onRadioStateChanged",static:!1,private:!1,access:{has:obj=>"__onRadioStateChanged"in obj,get:obj=>obj.__onRadioStateChanged},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}__existingNames=__runInitializers(this,_instanceExtraInitializers);__elementLabel;__rows;__doAll=void 0;constructor(conflictingNames,existingNames,parentControl){super(parentControl),this.__existingNames=new Set(existingNames),this.__elementLabel=this.__elementContent.appendChild(document.createElement("span")),this.__elementLabel.className=`${this.__className}-label-block`;const elementScrollContainer=this.__elementContent.appendChild(document.createElement("div"));elementScrollContainer.className=`${this.__className}-scroll-container`,this.__rows=new Map;for(const[name,replaceable]of conflictingNames){const row=this.__buildRow(name,replaceable,this.__onRadioStateChanged);elementScrollContainer.appendChild(row.container),this.__rows.set(name,row.controls)}if(this.__rows.size>1){const row=this.__buildRow("");TcHmi.EventProvider.register(row.controls.skip.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("skip")),TcHmi.EventProvider.register(row.controls.replace.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("replace")),TcHmi.EventProvider.register(row.controls.both.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("both")),this.__elementContent.insertBefore(row.container,elementScrollContainer),this.__doAll={label:row.label,controls:row.controls}}}destroy(force=!1){for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.skip),TcHmi.Binding.removeEx2(null,"Text",row.replace),TcHmi.Binding.removeEx2(null,"Text",row.both);this.__doAll&&(TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.skip),TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.replace),TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.both)),super.destroy(force)}__buildRow(labelText,replaceable=!0,eventHandler){const container=document.createElement("div");container.className=`${this.__className}-radio-row`;const label=container.appendChild(document.createElement("span"));label.textContent=labelText;const guid=tchmi_create_guid(),[skip,replace,both]=["skip","replace","both"].map(controlName=>{const control=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.${controlName}.${guid}`,{"data-tchmi-radio-group":guid,"data-tchmi-is-enabled":"replace"!==controlName||replaceable,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl);if(!control)throw new Error("Could not create controls for FileConflictPrompt");return eventHandler&&TcHmi.EventProvider.register(control.getId()+".onRadioStateChanged",eventHandler),container.appendChild(control.getElement()[0]),this.__childControls.push(control),control});return{container,label,controls:{skip,replace,both}}}__onRadioStateChanged(){let isValid=!0;const allActive={skip:!0,replace:!0,both:!0};for(const controls of this.__rows.values()){let activeRadios=0;for(const[controlName,radio]of Object.entries(controls))"Active"===radio.getRadioState()&&radio.getIsEnabled()?activeRadios++:allActive[controlName]=!1;if(1!==activeRadios){isValid=!1;break}}this.__okButton.setIsEnabled(isValid),this.__doAll&&(this.__doAll.controls.skip.setRadioState(allActive.skip&&isValid?"Active":"Normal"),this.__doAll.controls.replace.setRadioState(allActive.replace&&isValid?"Active":"Normal"),this.__doAll.controls.both.setRadioState(allActive.both&&isValid?"Active":"Normal"))}__getOnAllRadioStateChangedHandler(name){return()=>{for(const controls of this.__rows.values())controls[name].getIsEnabled()&&controls[name].setRadioState("Active")}}__ok(){const answerValue=new Map;for(const[name,controls]of this.__rows)if("Active"===controls.replace.getRadioState())answerValue.set(name,name),this.__existingNames.add(name);else if("Active"===controls.both.getRadioState()){const dotIndex=name.lastIndexOf(".");let rawName=dotIndex>0?name.slice(0,dotIndex):name;const extension=dotIndex>0?name.slice(dotIndex):"",counterEnding=rawName.match(/\((\d+)\)$/);let counter,newName;counterEnding?(counter=parseInt(counterEnding[1],10),rawName=rawName.slice(0,counterEnding.index),Number.isNaN(counter)&&(counter=0)):(counter=0,rawName+=" ");do{counter++,newName=`${rawName}(${counter})${extension}`}while(this.__existingNames.has(newName));answerValue.set(name,newName),this.__existingNames.add(newName)}this.__prompt?.answer({isOk:!0,value:answerValue})}setLocalizations(texts){if(super.setLocalizations(texts),this.__applyTextToElement("headerText",texts.headerText,this.__elementHeader),this.__applyTextToElement("labelText",texts.labelText,this.__elementLabel),this.__doAll&&this.__applyTextToElement("labelDoForAll",texts.labelDoForAll,this.__doAll.label),texts.radioTextSkip)if("string"==typeof texts.radioTextSkip){this.__unwatchLocalization("buttonTextSkip");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextSkip,"Text",row.skip);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextSkip,"Text",this.__doAll.controls.skip)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.skip);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.skip),this.__watchLocalization("buttonTextSkip",texts.radioTextSkip,text=>{for(const row of this.__rows.values())row.skip.setText(text);this.__doAll&&this.__doAll.controls.skip.setText(text)})}if(texts.radioTextReplace)if("string"==typeof texts.radioTextReplace){this.__unwatchLocalization("buttonTextReplace");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextReplace,"Text",row.replace);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextReplace,"Text",this.__doAll.controls.replace)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.replace);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.replace),this.__watchLocalization("buttonTextReplace",texts.radioTextReplace,text=>{for(const row of this.__rows.values())row.replace.setText(text);this.__doAll&&this.__doAll.controls.replace.setText(text)})}if(texts.radioTextKeepBoth)if("string"==typeof texts.radioTextKeepBoth){this.__unwatchLocalization("buttonTextKeepBoth");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextKeepBoth,"Text",row.both);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextKeepBoth,"Text",this.__doAll.controls.both)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.both);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.both),this.__watchLocalization("buttonTextKeepBoth",texts.radioTextKeepBoth,text=>{for(const row of this.__rows.values())row.both.setText(text);this.__doAll&&this.__doAll.controls.both.setText(text)})}}}})();TcHmiRecipeEditComponents.FileConflictPrompt=FileConflictPrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));