"use strict";var TcHmi;!function(TcHmi){!function(Controls){!function(Helpers){class ContentTabs extends HTMLElement{static#tchmiFQN="TcHmi.Controls.Helpers."+this.name;constructor(){super(),this.__resizeObserver=new ResizeObserver(()=>{this.isConnected&&this.arrangeTabLinks()}),this.__openDropdown=this.__openDropdown.bind(this)}connectedCallback(){this.__updateLinksAndContents(),this.__findActiveTab(),this.__addEvents(),this.openTab(),this.__resizeObserver.observe(this),this.__tabLinksOverflowElement.addEventListener("click",this.__openDropdown)}disconnectedCallback(){this.__removeEvents(),this.__resizeObserver.disconnect(),this.__tabLinksOverflowElement.removeEventListener("click",this.__openDropdown)}addContentTab(name,link,content){if(this.__tabs.has(name)){const ownerControl=this.closest("div[data-tchmi-type]");return void TcHmi.Log.warnEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] ContentTab with the name '${name}' already exists.`)}const tabToAdd={disabled:link.hasAttribute("disabled")||content.hasAttribute("disabled"),dropdown:!1,link,content,openTabHandler:this.openTab.bind(this,name)};link.setAttribute("ref",name),content.setAttribute("name",name),tabToAdd.disabled?(link.setAttribute("disabled",""),content.setAttribute("disabled","")):link.addEventListener("click",tabToAdd.openTabHandler),this.__tabs.set(name,tabToAdd);this.__getTabContentsWrapper().append(content),this.arrangeTabLinks()}arrangeTabLinks(){this.__removeTabLinksOverflowElement();const tabLinksWrapper=this.__getTabLinksWrapper();this.__tabs.forEach(tab=>{tab.link.remove()});let overflow=!1;const tabNames=Array.from(this.__tabs.keys());for(const[tabName,tab]of this.__tabs)if(overflow)tab.dropdown=!0;else if(tabLinksWrapper.append(tab.link),"Top"===this.__tabAlignment||"Bottom"===this.__tabAlignment)if(tabLinksWrapper.scrollWidth>tabLinksWrapper.clientWidth){overflow=!0,this.__appendTabLinksOverflowElement(),tab.link.remove(),tab.dropdown=!0;let j=tabNames.indexOf(tabName);for(;tabLinksWrapper.scrollWidth>tabLinksWrapper.clientWidth&&(j--,!(j<0));){const tabName_2=tabNames[j],tab_2=this.__tabs.get(tabName_2);tab_2&&(tab_2.link.remove(),tab_2.dropdown=!0,tabName_2===this.__activeTab&&(this.__tabLinksOverflowElement.setAttribute("active",""),TcHmi.TopMostLayer.removeEx(this.__tabLinkDropdown),this.__tabLinksOverflowElement.textContent="",this.__tabLinksOverflowElement.appendChild(tab_2.link.cloneNode(!0))))}}else tab.dropdown&&tabName===this.__activeTab&&(this.__tabLinksOverflowElement.textContent="",this.__tabLinksOverflowElement.removeAttribute("active")),tab.dropdown=!1;else if(tabLinksWrapper.scrollHeight>tabLinksWrapper.clientHeight){overflow=!0,this.__appendTabLinksOverflowElement(),tab.link.remove(),tab.dropdown=!0;let j=tabNames.indexOf(tabName);for(;tabLinksWrapper.scrollHeight>tabLinksWrapper.clientHeight&&(j--,!(j<0));){const tabName_2=tabNames[j],tab_2=this.__tabs.get(tabName_2);tab_2&&(tab_2.link.remove(),tab_2.dropdown=!0,tabName_2===this.__activeTab&&(this.__tabLinksOverflowElement.setAttribute("active",""),TcHmi.TopMostLayer.removeEx(this.__tabLinkDropdown),this.__tabLinksOverflowElement.textContent="",this.__tabLinksOverflowElement.appendChild(tab_2.link.cloneNode(!0))))}}else tab.dropdown&&tabName===this.__activeTab&&(this.__tabLinksOverflowElement.textContent="",this.__tabLinksOverflowElement.removeAttribute("active")),tab.dropdown=!1;this.__tabs.forEach(tab=>{tab.dropdown&&this.__tabLinkDropdown.append(tab.link)})}removeContentTab(name){const tabToRemove=this.__tabs.get(name);if(!tabToRemove){const ownerControl=this.closest("div[data-tchmi-type]");return void TcHmi.Log.warnEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] No ContentTab with the name '${name}' found.`)}tabToRemove.link.remove(),tabToRemove.content.removeAttribute("active"),tabToRemove.content.remove(),tabToRemove.link.removeEventListener("click",tabToRemove.openTabHandler),this.__tabs.delete(name),this.arrangeTabLinks()}openTab(nameOfTabToOpen){const ownerControl=this.closest("div[data-tchmi-type]");if(!this.isConnected)return void(nameOfTabToOpen&&(this.__activeTab=nameOfTabToOpen));if(!nameOfTabToOpen&&!(nameOfTabToOpen=this.__activeTab)&&([nameOfTabToOpen]=this.__tabs.keys(),!nameOfTabToOpen))return;const tabToOpen=this.__tabs.get(nameOfTabToOpen);if(!tabToOpen)return void TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] No tab called '${nameOfTabToOpen}' found.`);if(tabToOpen.link.hasAttribute("disabled"))return void TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] You tried to open a disabled tab. Please enable tab first.`);for(const[tabName,tab]of this.__tabs)tabName!==nameOfTabToOpen&&(tab.link.removeAttribute("active"),tab.content.removeAttribute("active"));if(this.__tabLinksOverflowElement.querySelectorAll("[active]").forEach(element=>{element.removeAttribute("active")}),tabToOpen.link.setAttribute("active",""),tabToOpen.content.setAttribute("active",""),this.__activeTab=nameOfTabToOpen,this.__tabChangeCallbacks.trigger(nameOfTabToOpen),tabToOpen.dropdown){for(this.__tabLinksOverflowElement.setAttribute("active",""),TcHmi.TopMostLayer.removeEx(this.__tabLinkDropdown);this.__tabLinksOverflowElement.firstChild;)this.__tabLinksOverflowElement.removeChild(this.__tabLinksOverflowElement.firstChild);this.__tabLinksOverflowElement.appendChild(tabToOpen.link.cloneNode(!0)),this.arrangeTabLinks()}else this.__tabLinksOverflowElement.removeAttribute("active")}__openDropdown(){this.__resizeDropdown(),TcHmi.TopMostLayer.addEx(this.__tabLinkDropdown)}__resizeDropdown(){const tabLinksWrapperBCR=this.__getTabLinksWrapper().getBoundingClientRect(),contentTabBCR=this.getBoundingClientRect();switch(this.__tabAlignment){case"Top":this.__tabLinkDropdown.style.top=tabLinksWrapperBCR.top+"px",this.__tabLinkDropdown.style.right=window.innerWidth-tabLinksWrapperBCR.right+"px",this.__tabLinkDropdown.style.maxHeight=contentTabBCR.height+"px",this.__tabLinkDropdown.style.bottom="",this.__tabLinkDropdown.style.left="";break;case"Bottom":case"Right":this.__tabLinkDropdown.style.bottom=window.innerHeight-tabLinksWrapperBCR.bottom+"px",this.__tabLinkDropdown.style.right=window.innerWidth-tabLinksWrapperBCR.right+"px",this.__tabLinkDropdown.style.maxHeight=contentTabBCR.height+"px",this.__tabLinkDropdown.style.top="",this.__tabLinkDropdown.style.left="";break;case"Left":this.__tabLinkDropdown.style.bottom=window.innerHeight-tabLinksWrapperBCR.bottom+"px",this.__tabLinkDropdown.style.left=tabLinksWrapperBCR.left+"px",this.__tabLinkDropdown.style.maxHeight=contentTabBCR.height+"px",this.__tabLinkDropdown.style.top="",this.__tabLinkDropdown.style.right=""}}getTab(tabName){return this.__tabs.get(tabName)}get activeTab(){return this.__activeTab}enableTab(tabName){const tab=this.__tabs.get(tabName);if(!tab){const ownerControl=this.closest("div[data-tchmi-type]");return void TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] No tab with name ${tabName} found.`)}tab.link.removeAttribute("disabled"),tab.content.removeAttribute("disabled"),tab.link.addEventListener("click",tab.openTabHandler)}disableTab(tabName){const ownerControl=this.closest("div[data-tchmi-type]"),tab=this.__tabs.get(tabName);tab?(this.__activeTab===tabName&&TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] You tried to disable an active tab. Please make this tab not active first.`),tab.link.setAttribute("disabled",""),tab.content.setAttribute("disabled",""),tab.link.removeEventListener("click",tab.openTabHandler)):TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] No tab with name ${tabName} found.`)}disableContentTabs(){this.setAttribute("disabled","")}enableContentTabs(){this.removeAttribute("disabled")}useMaxContent(){this.__getTabContentsWrapper().setAttribute("use-max-content","")}doNotUseMaxContent(){this.__getTabContentsWrapper().removeAttribute("use-max-content")}addTabChangeCallback(cb){this.__tabChangeCallbacks.add(cb)}removeTabChangeCallback(cb){this.__tabChangeCallbacks.remove(cb)}setTabAlignment(tabAlignment){this.__tabAlignment=tabAlignment,this.setAttribute("tab-alignment",tabAlignment),this.__tabLinkDropdown.setAttribute("tab-alignment",tabAlignment),this.arrangeTabLinks()}__getTabLinksWrapper(){let tabLinksWrapper=this.querySelector("tchmi-tab-links");return tabLinksWrapper||(tabLinksWrapper=document.createElement("tchmi-tab-links"),this.append(tabLinksWrapper)),tabLinksWrapper}__getTabContentsWrapper(){let tabContentsWrapper=this.querySelector("tchmi-tab-contents");return tabContentsWrapper||(tabContentsWrapper=document.createElement("tchmi-tab-contents"),this.append(tabContentsWrapper)),tabContentsWrapper}__appendTabLinksOverflowElement(){this.__getTabLinksWrapper().append(this.__tabLinksOverflowElement)}__removeTabLinksOverflowElement(){this.__tabLinksOverflowElement.remove()}__updateLinksAndContents(){const ownerControl=this.closest("div[data-tchmi-type]"),tabLinksByName=new Map,tabLinksWrapper=this.__getTabLinksWrapper(),tabContentsWrapper=this.__getTabContentsWrapper(),tabLinks=tabLinksWrapper.querySelectorAll("tchmi-tab-link");for(const tabLink of tabLinks){const tabRef=tabLink.getAttribute("ref");tabRef?tabLinksByName.set(tabRef,tabLink):TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] Tab link has no attribute 'ref'.`)}this.__tabs.clear();const tabContents=tabContentsWrapper.children;for(const tabContent of tabContents){const tabName=tabContent.getAttribute("name");if(!tabName){TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] Tab content has no attribute 'name'.`);continue}const tabLinkOfContent=tabLinksByName.get(tabName);if(!tabLinkOfContent){TcHmi.Log.errorEx(`[Source=ControlHelpers, Module=${ContentTabs.#tchmiFQN}${ownerControl?`, Id=${ownerControl.id}`:""}] No tab link found for content '${tabName}'.`);continue}const tab={link:tabLinkOfContent,content:tabContent,openTabHandler:this.openTab.bind(this,tabName),disabled:tabLinkOfContent.hasAttribute("disabled")||tabContent.hasAttribute("disabled"),dropdown:tabLinkOfContent.hasAttribute("dropdown")||tabContent.hasAttribute("dropdown")};this.__tabs.set(tabName,tab),tab.disabled&&(tab.link.setAttribute("disabled",""),tab.content.setAttribute("disabled",""))}}__addEvents(){for(const tab of this.__tabs.values())tab.link.hasAttribute("disabled")||tab.link.addEventListener("click",tab.openTabHandler)}__removeEvents(){for(const tab of this.__tabs.values())tab.link.removeEventListener("click",tab.openTabHandler)}__findActiveTab(){let foundActiveTab=!1;for(const[tabName,tab]of this.__tabs)(tab.link.hasAttribute("active")||tab.content.hasAttribute("active"))&&(foundActiveTab?(tab.link.removeAttribute("active"),tab.content.removeAttribute("active")):(this.__activeTab=tabName,foundActiveTab=!0,tab.link.setAttribute("active",""),tab.content.setAttribute("active","")))}__tabs=new Map;__activeTab;__resizeObserver;__tabLinksOverflowElement=document.createElement("tchmi-tab-links-overflow");__tabLinkDropdown=document.createElement("tchmi-content-tabs-dropdown");__tabAlignment="Top";__tabChangeCallbacks=new Helpers.CallbackManager}Helpers.ContentTabs=ContentTabs,customElements.define("tchmi-content-tabs",ContentTabs),customElements.define("tchmi-tab-links",class extends HTMLElement{}),customElements.define("tchmi-tab-link",class extends HTMLElement{}),customElements.define("tchmi-tab-contents",class extends HTMLElement{}),customElements.define("tchmi-tab-content",class extends HTMLElement{}),customElements.define("tchmi-tab-links-overflow",class extends HTMLElement{}),customElements.define("tchmi-content-tabs-dropdown",class extends HTMLElement{})}(Controls.Helpers||(Controls.Helpers={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));