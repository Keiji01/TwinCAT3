var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{designerModeManager}from"./DesignerModeManager.js";import{metaDataManager}from"./DesignerModeControlMetaDataMngr.js";import{rootControlManager}from"./DesignerModeMasterRootControlMngr.js";import{interactionManager}from"./DesignerModeMasterInteractionMngr.js";import{hierarchyManager}from"./DesignerModeMasterHierarchyMngr.js";import{controlMoveManager}from"./DesignerModeMasterControlMoveMngr.js";import{controlResizeManager}from"./DesignerModeMasterControlResizeMngr.js";TCHMI_DESIGNER||TcHmi.Log.errorEx(`Internal error: The file "${import.meta.url}" is restricted to use within the designer.`);let DesignerModeMasterControlHighlightManager=(()=>{var _a,_b,_c,_d,_e,_f,_g;let ___onControlsResized_decorators,___onControlsMoved_decorators,___onControlVisibilityChanged_decorators,___onGridRowOrColumnIndexChanged_decorators,___onGridRowOrColumnChanged_decorators,___onGridCellResized_decorators,_updateEngineeringStyles_decorators,_instanceExtraInitializers=[];return class{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onControlsResized_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onControlsMoved_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onControlVisibilityChanged_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___onGridRowOrColumnIndexChanged_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],___onGridRowOrColumnChanged_decorators=[(_e=TcHmi).CallbackMethod.bind(_e)],___onGridCellResized_decorators=[(_f=TcHmi).CallbackMethod.bind(_f)],_updateEngineeringStyles_decorators=[(_g=TcHmi).CallbackMethod.bind(_g)],__esDecorate(this,null,___onControlsResized_decorators,{kind:"method",name:"__onControlsResized",static:!1,private:!1,access:{has:obj=>"__onControlsResized"in obj,get:obj=>obj.__onControlsResized},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onControlsMoved_decorators,{kind:"method",name:"__onControlsMoved",static:!1,private:!1,access:{has:obj=>"__onControlsMoved"in obj,get:obj=>obj.__onControlsMoved},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onControlVisibilityChanged_decorators,{kind:"method",name:"__onControlVisibilityChanged",static:!1,private:!1,access:{has:obj=>"__onControlVisibilityChanged"in obj,get:obj=>obj.__onControlVisibilityChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onGridRowOrColumnIndexChanged_decorators,{kind:"method",name:"__onGridRowOrColumnIndexChanged",static:!1,private:!1,access:{has:obj=>"__onGridRowOrColumnIndexChanged"in obj,get:obj=>obj.__onGridRowOrColumnIndexChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onGridRowOrColumnChanged_decorators,{kind:"method",name:"__onGridRowOrColumnChanged",static:!1,private:!1,access:{has:obj=>"__onGridRowOrColumnChanged"in obj,get:obj=>obj.__onGridRowOrColumnChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onGridCellResized_decorators,{kind:"method",name:"__onGridCellResized",static:!1,private:!1,access:{has:obj=>"__onGridCellResized"in obj,get:obj=>obj.__onGridCellResized},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_updateEngineeringStyles_decorators,{kind:"method",name:"updateEngineeringStyles",static:!1,private:!1,access:{has:obj=>"updateEngineeringStyles"in obj,get:obj=>obj.updateEngineeringStyles},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}constructor(){TcHmi.EventProvider.register("System.onControlsResized",this.__onControlsResized),TcHmi.EventProvider.register("System.onControlsMoved",this.__onControlsMoved),TcHmi.EventProvider.register("System.onControlVisibilityChanged",this.__onControlVisibilityChanged),TcHmi.EventProvider.register("System.onControlGetRowCountChanged",this.__onGridRowOrColumnChanged),TcHmi.EventProvider.register("System.onControlGetColumnCountChanged",this.__onGridRowOrColumnChanged),TcHmi.EventProvider.register("System.onGridCellResized",this.__onGridCellResized),TcHmi.EventProvider.register("System.onControlGridRowIndexChanged",this.__onGridRowOrColumnIndexChanged),TcHmi.EventProvider.register("System.onControlGridColumnIndexChanged",this.__onGridRowOrColumnIndexChanged),TcHmi.EventProvider.register("onThemeDataChanged",this.updateEngineeringStyles);let tempDiv=document.createElement("div");tempDiv.innerHTML='<div data-tchmi-creator-target-control=""\n                                class="tchmi-creator-controlposition tchmi-box"\n                                style="z-index:0;">\n                                <div data-tchmi-creator-target-control=""\n                                    class="tchmi-creator-controlname tchmi-box"\n                                    title=""><bdi></bdi></div>\n                        </div>';let controlPosition=tempDiv.firstElementChild;tempDiv.innerHTML='<div data-tchmi-creator-target-control=""\n                                class="tchmi-creator-hierarchy-controlposition tchmi-box"\n                                style="z-index:0;">\n                        </div>';let hierarchyControlPosition=tempDiv.firstElementChild;tempDiv.innerHTML='<div data-tchmi-creator-target-control=""\n                                class="tchmi-creator-originalposition tchmi-box"\n                                style="z-index:0;">\n\n                                <div class="tchmi-creator-distance-top    tchmi-creator-distance-line tchmi-box"></div>\n                                <div class="tchmi-creator-distance-left   tchmi-creator-distance-line tchmi-box"></div>\n                                <div class="tchmi-creator-distance-width  tchmi-creator-distance-line tchmi-box"></div>\n                                <div class="tchmi-creator-distance-right  tchmi-creator-distance-line tchmi-box"></div>\n                                <div class="tchmi-creator-distance-height tchmi-creator-distance-line tchmi-box"></div>\n                                <div class="tchmi-creator-distance-bottom tchmi-creator-distance-line tchmi-box"></div>\n\n                                <div class="tchmi-creator-snapline-top tchmi-creator-snapline tchmi-box"></div>\n                                <div class="tchmi-creator-snapline-left tchmi-creator-snapline tchmi-box"></div>\n                                <div class="tchmi-creator-snapline-right tchmi-creator-snapline tchmi-box"></div>\n                                <div class="tchmi-creator-snapline-bottom tchmi-creator-snapline tchmi-box"></div>\n\n                        </div>';let originalPosition=tempDiv.firstElementChild;tempDiv.innerHTML='<div data-tchmi-creator-target-control=""\n                                class="tchmi-creator-anchorcontainer tchmi-box"\n                                style="border-width: 1px;z-index:0;">\n\n                                <div data-tchmi-creator-anchor-name="TopLeft"      class="tchmi-creator-anchor-top-left      tchmi-creator-anchor-rect tchmi-box"></div>\n                                <div data-tchmi-creator-anchor-name="TopCenter"    class="tchmi-creator-anchor-top-center    tchmi-creator-anchor-rect tchmi-box"></div>\n                                <div data-tchmi-creator-anchor-name="TopRight"     class="tchmi-creator-anchor-top-right     tchmi-creator-anchor-rect tchmi-box"></div>\n                                <div data-tchmi-creator-anchor-name="CenterLeft"   class="tchmi-creator-anchor-center-left   tchmi-creator-anchor-rect tchmi-box"></div>\n                                <div data-tchmi-creator-anchor-name="CenterRight"  class="tchmi-creator-anchor-center-right  tchmi-creator-anchor-rect tchmi-box"></div>\n                                <div data-tchmi-creator-anchor-name="BottomLeft"   class="tchmi-creator-anchor-bottom-left   tchmi-creator-anchor-rect tchmi-box"></div>\n                                <div data-tchmi-creator-anchor-name="BottomCenter" class="tchmi-creator-anchor-bottom-center tchmi-creator-anchor-rect tchmi-box"></div>\n                                <div data-tchmi-creator-anchor-name="BottomRight"  class="tchmi-creator-anchor-bottom-right  tchmi-creator-anchor-rect tchmi-box"></div>\n                        </div>';let anchorContainer=tempDiv.firstElementChild;tempDiv.innerHTML='<div data-tchmi-creator-target-control=""\n                                class="tchmi-creator-hierarchy-anchorcontainer tchmi-box"\n                                style="z-index:0;">\n                        </div>';let hierarchyAnchorContainer=tempDiv.firstElementChild;this.__cloneSource={controlPosition,hierarchyControlPosition,originalPosition,anchorContainer,hierarchyAnchorContainer}}__highlightContainerVisibility=(__runInitializers(this,_instanceExtraInitializers),!0);__cloneSource;handleControlRemoved(ctrlMeta){ctrlMeta.jOriginalPosition.remove(),ctrlMeta.jControlPosition.remove(),ctrlMeta.jHierarchyControlposition.remove(),ctrlMeta.jAnchorContainer.remove(),ctrlMeta.jHierarchyAnchorContainer.remove()}__asyncWorkData={animationFrameId:0,ctrlList:new Map};requestAsyncHighlighterUpdate(){0===this.__asyncWorkData.animationFrameId&&(this.__asyncWorkData.animationFrameId=window.requestAnimationFrame(()=>{const ctrlListForPositionUpdate=new Set;for(const[tco,asyncData]of this.__asyncWorkData.ctrlList){const ctrlMeta=metaDataManager.getControlMetaData(tco.getId());if(!ctrlMeta)continue;ctrlListForPositionUpdate.add(tco);const ctrlParent=tco.getParent();ctrlParent&&ctrlMeta.parent&&ctrlMeta.parent.isGridControl&&(ctrlListForPositionUpdate.has(ctrlParent)||ctrlListForPositionUpdate.add(ctrlParent)),asyncData.highlightInsertionNeeded&&insertHighlighterInDom(tco,ctrlParent,ctrlMeta),asyncData.rowColumnChanged&&this.createGridHighlighter(tco,ctrlMeta),asyncData.resized&&ctrlMeta.isPartialRoot&&rootControlManager?.setCreatorViewPortPosition(tco),this.updateGripCursors(ctrlMeta)}this.setContainerPositions(ctrlListForPositionUpdate),interactionManager?.clearControlSnapPositionCache(),interactionManager?.refreshControlSnapPositionCache(),this.__asyncWorkData.ctrlList.clear(),this.__asyncWorkData.animationFrameId=0}))}__onControlsResized(_event,ctrls){if(!controlResizeManager.getControlResizing())for(let ctrl of ctrls){this.requestAsyncHighlighterUpdateForControl(ctrl).resized=!0}}__onControlsMoved(_event,ctrls){if(!controlMoveManager.getControlMoveActive())for(let ctrl of ctrls){this.requestAsyncHighlighterUpdateForControl(ctrl).moved=!0}}requestAsyncHighlighterUpdateForControl(ctrl){this.requestAsyncHighlighterUpdate();let resizeMoveInfo=this.__asyncWorkData.ctrlList.get(ctrl);return resizeMoveInfo||(resizeMoveInfo={resized:!1,moved:!1,rowColumnChanged:!1,highlightInsertionNeeded:!1},this.__asyncWorkData.ctrlList.set(ctrl,resizeMoveInfo)),resizeMoveInfo}__onControlVisibilityChanged(_event,tco){const ctrlMeta=metaDataManager.getControlMetaData(tco.getId());if(!ctrlMeta)return;"Collapsed"===tco.getVisibility()?ctrlMeta.controlCollapsed=!0:ctrlMeta.controlCollapsed=!1;let ctrlAsyncData=this.requestAsyncHighlighterUpdateForControl(tco);ctrlAsyncData.moved=!0,ctrlAsyncData.resized=!0}__onGridRowOrColumnIndexChanged(_event,tco){let tcoPar=tco.getParent();if(!tcoPar||!TcHmi.System.Services.controlManager.getDescriptionTypes(tcoPar.getType()).includes("TcHmi.Controls.System.TcHmiGrid"))return;const ctrlMeta=metaDataManager.getControlMetaData(tco.getId());if(!ctrlMeta||null===ctrlMeta.parent)return;let targetRowIndex=tco.getGridRowIndex();(!targetRowIndex||targetRowIndex>=(tco.getParent()?.__rowOptions?.length??0))&&(targetRowIndex=0);let targetColumnIndex=tco.getGridColumnIndex();(!targetColumnIndex||targetColumnIndex>=(tco.getParent()?.__columnOptions?.length??0))&&(targetColumnIndex=0);const targetCell=ctrlMeta.parent.jHierarchyControlposition.children("[data-tchmi-creator-grid-rowindex="+targetRowIndex+"][data-tchmi-creator-grid-cellindex="+targetColumnIndex+"]");0===targetCell.length&&TcHmi.Log.error("[Source=Framework, Module=TcHmi.System.Engineering.DesignerModeMasterHighlightManager] Fatal internal error: Could not find target grid cell for "+tcoPar.getId()+" to attach highlight container."),targetCell.append(ctrlMeta.jOriginalPosition),targetCell.append(ctrlMeta.jControlPosition),targetCell.append(ctrlMeta.jHierarchyControlposition),targetCell.append(ctrlMeta.jAnchorContainer),targetCell.append(ctrlMeta.jHierarchyAnchorContainer)}__onGridRowOrColumnChanged(_event,tco){this.requestAsyncHighlighterUpdateForControl(tco).rowColumnChanged=!0;const gridChildren=tco.getChildren();for(const gridChild of gridChildren){this.requestAsyncHighlighterUpdateForControl(gridChild).resized=!0}}__onGridCellResized(_event,tco){if(controlResizeManager.getControlResizing())return;this.requestAsyncHighlighterUpdateForControl(tco).resized=!0}setHighlightContainerVisibility(valueNew){this.__highlightContainerVisibility=valueNew;const controlsMetaData=metaDataManager.getControlMetaData();for(const ctrlMeta of controlsMetaData.values())this.processHighlightType(ctrlMeta);this.processDomVisibility()}setCreatorVisibilityAttribute(targetControl,bVisibility){let ctrlMeta=metaDataManager.getControlMetaData(targetControl);ctrlMeta&&(ctrlMeta.domVisibility=bVisibility,this.processDomVisibility(ctrlMeta))}processDomVisibility(processCtrlMeta){if(!TCHMI_DESIGNER)return;let controlsMetaData;controlsMetaData=processCtrlMeta?new Map([["singleControl",processCtrlMeta]]):metaDataManager.getControlMetaData();for(const ctrlMeta of controlsMetaData.values()){const tco=TcHmi.Controls.get(ctrlMeta.id);tco?(tco.getElement()[0].classList.toggle("tchmi-creator-controlhidden",!ctrlMeta.domVisibility),!ctrlMeta.domVisibility||ctrlMeta.controlCollapsed?(ctrlMeta.jOriginalPosition[0].style.display="none",ctrlMeta.jControlPosition[0].style.display="none",ctrlMeta.jHierarchyControlposition[0].style.display="none",ctrlMeta.jAnchorContainer[0].style.display="none",ctrlMeta.jHierarchyAnchorContainer[0].style.display="none"):(ctrlMeta.jOriginalPosition[0].style.display="",ctrlMeta.jControlPosition[0].style.display="",ctrlMeta.jHierarchyControlposition[0].style.display="",ctrlMeta.jAnchorContainer[0].style.display="",ctrlMeta.jHierarchyAnchorContainer[0].style.display="")):TcHmi.Log.error(`[Source=Framework, Module=TcHmi.System.Engineering.DesignerModeMasterHighlightManager] Failed to handle control "${ctrlMeta.id}": Not found in control cache.\n`)}}__handleOuterDimension(dimension,renderedDimension,dimensionName,controlSizeValue,controlSizeUnit,defineCount,tco,ctrlMeta,creatorZoomFactor){const element=tco.getElement(),distanceline=ctrlMeta.jOriginalPosition[0].querySelector(".tchmi-creator-distance-"+dimensionName),controlPixelSize=renderedDimension[dimensionName],normalizedControlPixelSize=controlPixelSize*creatorZoomFactor;distanceline.style.fontSize="top"!==dimensionName&&normalizedControlPixelSize>=30||"top"===dimensionName&&normalizedControlPixelSize>=50?"":"0px",distanceline.style.width=normalizedControlPixelSize+"px",distanceline.style.display="",distanceline.style.backgroundColor="",distanceline.style.borderColor="",distanceline.style.opacity="",normalizedControlPixelSize>=10?distanceline.classList.remove("no-triangle"):distanceline.classList.add("no-triangle");let dimensionActive=!0;if(null!=controlSizeValue){if("px"===controlSizeUnit)dimension[dimensionName]=normalizedControlPixelSize+controlSizeUnit,controlResizeManager.getControlResizing()||controlMoveManager.getControlMoveActive()||!controlSizeValue?distanceline.textContent=controlPixelSize.toFixed(0)+controlSizeUnit:distanceline.textContent=controlSizeValue.toFixed(0)+controlSizeUnit;else if("%"===controlSizeUnit){let controlParentPixelSize;"top"===dimensionName||"bottom"===dimensionName?controlParentPixelSize=parseFloat(element.parent().css("height")):"left"!==dimensionName&&"right"!==dimensionName||(controlParentPixelSize=parseFloat(element.parent().css("width")));let realValue=controlPixelSize/controlParentPixelSize*100;dimension[dimensionName]=realValue+controlSizeUnit,controlResizeManager.getControlResizing()||controlMoveManager.getControlMoveActive()||!controlSizeValue?distanceline.textContent=realValue.toFixed(1)+controlSizeUnit:distanceline.textContent=controlSizeValue.toFixed(1)+controlSizeUnit}3!==++defineCount||"right"!==dimensionName&&"bottom"!==dimensionName||(distanceline.style.opacity="0.5")}else dimensionActive=!1,distanceline.style.display="none";return ctrlMeta.jOriginalPosition[0].classList.toggle("tchmi-creator-control-definedfrom"+dimensionName,dimensionActive),defineCount}__handleInnerDimension(dimension,renderedDimension,dimensionName,controlSizeValue,controlSizeUnit,elementSizeMode,defineCount,tco,ctrlMeta,creatorZoomFactor){const element=tco.getElement(),distanceline=ctrlMeta.jOriginalPosition[0].querySelector(".tchmi-creator-distance-"+dimensionName),controlPixelSize=renderedDimension[dimensionName];if(ctrlMeta.controlCollapsed)dimension[dimensionName]="0",distanceline.style.display="none",defineCount++;else{if(TcHmi.StyleProvider.setSimpleElementStyle(distanceline,{width:controlPixelSize*creatorZoomFactor+"px",display:"",opacity:""}),"px"===controlSizeUnit){let realValue=controlPixelSize*creatorZoomFactor;dimension[dimensionName]=realValue+controlSizeUnit,controlResizeManager.getControlResizing()||controlMoveManager.getControlMoveActive()||!controlSizeValue?distanceline.textContent=controlPixelSize.toFixed(0)+controlSizeUnit:distanceline.textContent=controlSizeValue.toFixed(0)+controlSizeUnit,"Parent"!==elementSizeMode&&null!=controlSizeValue&&defineCount++}else if("%"===controlSizeUnit){let realValue=controlPixelSize/parseFloat(element.parent().css(dimensionName))*100;if(dimension[dimensionName]=realValue+controlSizeUnit,controlResizeManager.getControlResizing()||controlMoveManager.getControlMoveActive()||!controlSizeValue){const activeAnchor=interactionManager.getAnchorName();ctrlMeta.isPartialRoot&&activeAnchor&&("height"===dimensionName&&(activeAnchor.includes("Top")||activeAnchor.includes("Bottom"))||"width"===dimensionName&&(activeAnchor.includes("Left")||activeAnchor.includes("Right")))?distanceline.textContent=(controlPixelSize*creatorZoomFactor).toFixed(0)+"px":distanceline.textContent=realValue.toFixed(1)+controlSizeUnit}else distanceline.textContent=controlSizeValue.toFixed(1)+controlSizeUnit;"Parent"!==elementSizeMode&&null!=controlSizeValue&&defineCount++}"Parent"===elementSizeMode||"Content"===elementSizeMode?null!=controlSizeValue?distanceline.style.opacity="0.5":distanceline.style.display="none":"Value"===elementSizeMode&&(null!=controlSizeValue?distanceline.style.opacity="1.0":distanceline.style.display="none")}return defineCount}setContainerPositions(ctrlList){if(!ctrlList||0===ctrlList.size)return;const creatorZoomFactor=rootControlManager.getCreatorZoomFactor(),dimensionCacheControl=new Map,dimensionCacheGridCells=new Map;for(const tco of ctrlList){if(!tco.getIsAttached()||tco.getIsDestroyed())continue;const element=tco.getElement();if(!element||0===element.length)continue;const ctrlMeta=metaDataManager.getControlMetaData(tco.getId());if(!ctrlMeta)continue;if(!ctrlMeta.domVisibility)continue;let renderedDimension={top:0,height:0,bottom:0,left:0,width:0,right:0,transform:"","transform-origin":"","border-width":"","border-style":"","--tchmi-designer-global-left":"","--tchmi-designer-global-top":""},elementBCR={top:0,left:0,width:0,height:0};if(!ctrlMeta.controlCollapsed){let currentStyle=TcHmi.StyleProvider.getComputedElementStyle(element,Object.keys(renderedDimension));elementBCR=element[0].getBoundingClientRect(),renderedDimension.top=parseFloat(currentStyle.top),renderedDimension.height=parseFloat(currentStyle.height),renderedDimension.bottom=parseFloat(currentStyle.bottom),renderedDimension.left=parseFloat(currentStyle.left),renderedDimension.width=parseFloat(currentStyle.width),renderedDimension.right=parseFloat(currentStyle.right),renderedDimension.transform=currentStyle.transform,renderedDimension["transform-origin"]=currentStyle["transform-origin"],renderedDimension["border-width"]=currentStyle["border-width"],renderedDimension["border-style"]=currentStyle["border-style"],renderedDimension["--tchmi-designer-global-left"]=elementBCR.left+"px",renderedDimension["--tchmi-designer-global-top"]=elementBCR.top+"px",ctrlMeta.isPartialRoot&&(renderedDimension["--tchmi-designer-root-width"]=elementBCR.width+"px",renderedDimension["--tchmi-designer-root-height"]=elementBCR.height+"px",renderedDimension["--tchmi-designer-root-scroll-left"]=document.documentElement.scrollLeft+"px",renderedDimension["--tchmi-designer-root-scroll-top"]=document.documentElement.scrollTop+"px")}if(ctrlMeta.controlCollapsed||!ctrlMeta.domVisibility?(ctrlMeta.jAnchorContainer[0].style.display="none",ctrlMeta.jControlPosition[0].style.display="none",ctrlMeta.jHierarchyAnchorContainer[0].style.display="none",ctrlMeta.jHierarchyControlposition[0].style.display="none",ctrlMeta.jOriginalPosition[0].style.display="none"):(ctrlMeta.jAnchorContainer[0].style.display="",ctrlMeta.jControlPosition[0].style.display="",ctrlMeta.jHierarchyAnchorContainer[0].style.display="",ctrlMeta.jHierarchyControlposition[0].style.display="",ctrlMeta.jOriginalPosition[0].style.display=""),dimensionCacheControl.set(tco,renderedDimension),ctrlMeta.isGridControl){tco.getChildren().forEach(ctrl=>{ctrlList.has(ctrl)||ctrlList.add(ctrl)});let allGridCells=ctrlMeta.jHierarchyControlposition.children(".tchmi-creator-hierarchy-gridcellposition");allGridCells=allGridCells.add(ctrlMeta.jControlPosition.children(".tchmi-creator-gridcell"));for(const creatorCell of allGridCells){const rowIndex=parseInt(creatorCell.getAttribute("data-tchmi-creator-grid-rowindex")??"0",10),rowElement=element.children().children(".TcHmi_Controls_System_TcHmiGrid-grid").children().eq(rowIndex),cellIndex=parseInt(creatorCell.getAttribute("data-tchmi-creator-grid-cellindex")??"0",10),cellElement=rowElement.children()[cellIndex];if(0===rowElement.length||!cellElement)return;const elmStyles=TcHmi.StyleProvider.getComputedElementStyle(element,["border-top-width","border-left-width"]),cellStyles=TcHmi.StyleProvider.getComputedElementStyle(cellElement,["border-top-width","border-left-width","padding-top","padding-left"]),gridTopBorderWidth=parseFloat(elmStyles["border-top-width"])*creatorZoomFactor,gridLeftBorderWidth=parseFloat(elmStyles["border-left-width"])*creatorZoomFactor,cellTopOffset=parseFloat(cellStyles["border-top-width"])*creatorZoomFactor+parseFloat(cellStyles["padding-top"])*creatorZoomFactor,cellLeftOffset=parseFloat(cellStyles["border-left-width"])*creatorZoomFactor+parseFloat(cellStyles["padding-left"])*creatorZoomFactor;let offsetHeight,offsetWidth,offsetTop,offsetLeft,creatorCellStyle;if(0===ctrlMeta.absoluteParentRotation&&0===ctrlMeta.relativeControlRotation){const cellBCR=cellElement.getBoundingClientRect();offsetHeight=cellBCR.height,offsetWidth=cellBCR.width,offsetTop=cellBCR.top-elementBCR.top-gridTopBorderWidth,offsetLeft=cellBCR.left-elementBCR.left-gridLeftBorderWidth}else offsetHeight=cellElement.offsetHeight*creatorZoomFactor,offsetWidth=cellElement.offsetWidth*creatorZoomFactor,offsetTop=cellElement.offsetTop*creatorZoomFactor,offsetLeft=cellElement.offsetLeft*creatorZoomFactor;creatorCellStyle=creatorCell.classList.contains("tchmi-creator-gridcell")?{height:offsetHeight+"px",width:offsetWidth+"px",top:gridTopBorderWidth+offsetTop+"px",left:gridLeftBorderWidth+offsetLeft+"px"}:{height:offsetHeight-2*cellTopOffset+"px",width:offsetWidth-2*cellLeftOffset+"px",top:cellTopOffset+offsetTop+"px",left:cellLeftOffset+offsetLeft+"px"},dimensionCacheGridCells.set(creatorCell,creatorCellStyle)}}}for(const[tco,renderedDimension]of dimensionCacheControl){const dimension={top:"",height:"",bottom:"",left:"",width:"",right:"","--tchmi-designer-global-left":renderedDimension["--tchmi-designer-global-left"],"--tchmi-designer-global-top":renderedDimension["--tchmi-designer-global-top"]},ctrlMeta=metaDataManager.getControlMetaData(tco.getId());ctrlMeta.isPartialRoot&&(dimension["--tchmi-designer-root-width"]=renderedDimension["--tchmi-designer-root-width"],dimension["--tchmi-designer-root-height"]=renderedDimension["--tchmi-designer-root-height"],dimension["--tchmi-designer-root-scroll-left"]=renderedDimension["--tchmi-designer-root-scroll-left"],dimension["--tchmi-designer-root-scroll-top"]=renderedDimension["--tchmi-designer-root-scroll-top"]);let defineCount=0,controlSizeValue=tco.getTop(),controlSizeUnit=tco.getTopUnit();defineCount=this.__handleOuterDimension(dimension,renderedDimension,"top",controlSizeValue,controlSizeUnit,defineCount,tco,ctrlMeta,creatorZoomFactor),controlSizeValue=tco.getHeight(),controlSizeUnit=tco.getHeightUnit();let elementSizeMode=tco.getHeightMode();defineCount=this.__handleInnerDimension(dimension,renderedDimension,"height",controlSizeValue,controlSizeUnit,elementSizeMode,defineCount,tco,ctrlMeta,creatorZoomFactor),controlSizeValue=tco.getBottom(),controlSizeUnit=tco.getBottomUnit(),defineCount=this.__handleOuterDimension(dimension,renderedDimension,"bottom",controlSizeValue,controlSizeUnit,defineCount,tco,ctrlMeta,creatorZoomFactor),defineCount<2&&this.__handleOuterDimension(dimension,renderedDimension,"top",0,"px",defineCount,tco,ctrlMeta,creatorZoomFactor),defineCount=0,controlSizeValue=tco.getLeft(),controlSizeUnit=tco.getLeftUnit(),defineCount=this.__handleOuterDimension(dimension,renderedDimension,"left",controlSizeValue,controlSizeUnit,defineCount,tco,ctrlMeta,creatorZoomFactor),controlSizeValue=tco.getWidth(),controlSizeUnit=tco.getWidthUnit(),elementSizeMode=tco.getWidthMode(),defineCount=this.__handleInnerDimension(dimension,renderedDimension,"width",controlSizeValue,controlSizeUnit,elementSizeMode,defineCount,tco,ctrlMeta,creatorZoomFactor),controlSizeValue=tco.getRight(),controlSizeUnit=tco.getRightUnit(),defineCount=this.__handleOuterDimension(dimension,renderedDimension,"right",controlSizeValue,controlSizeUnit,defineCount,tco,ctrlMeta,creatorZoomFactor),defineCount<2&&this.__handleOuterDimension(dimension,renderedDimension,"left",0,"px",defineCount,tco,ctrlMeta,creatorZoomFactor),defineCount=0,TcHmi.StyleProvider.setSimpleElementStyle(ctrlMeta.jOriginalPosition,dimension);const orgTransform=renderedDimension.transform;if(1!==creatorZoomFactor&&orgTransform.startsWith("matrix")){let transformtype="",twoDimMatrixEnties=[],orgTransformArray=orgTransform.substring(orgTransform.lastIndexOf("(")+1,orgTransform.lastIndexOf(")")).split(",");6===orgTransformArray.length?(transformtype="matrix",twoDimMatrixEnties=[4,5]):16===orgTransformArray.length&&(transformtype="matrix3d",twoDimMatrixEnties=[12,13,14]);for(let it of twoDimMatrixEnties)orgTransformArray[it]=(parseInt(orgTransformArray[it],10)*creatorZoomFactor).toString();dimension.transform=transformtype+"("+orgTransformArray.join(",")+")"}else dimension.transform="none"!==orgTransform?orgTransform:"";if(""!==dimension.transform){const orgTransformOrigin=renderedDimension["transform-origin"];if(orgTransformOrigin){let orgTransformOriginArray=orgTransformOrigin.split(" ");for(let it=0,itl=orgTransformOriginArray.length;it<itl;it++)orgTransformOriginArray[it].includes("px")&&(orgTransformOriginArray[it]=parseInt(orgTransformOriginArray[it],10)*creatorZoomFactor+"px");dimension["transform-origin"]=orgTransformOriginArray.join(" ")}else dimension["transform-origin"]=""}else dimension["transform-origin"]="";TcHmi.StyleProvider.setSimpleElementStyle(ctrlMeta.jControlPosition,dimension),TcHmi.StyleProvider.setSimpleElementStyle(ctrlMeta.jHierarchyControlposition,dimension),TcHmi.StyleProvider.setSimpleElementStyle(ctrlMeta.jAnchorContainer,dimension),TcHmi.StyleProvider.setSimpleElementStyle(ctrlMeta.jHierarchyAnchorContainer,dimension);let borderWidth=renderedDimension["border-width"];borderWidth||(borderWidth="0px");let borderStyle=renderedDimension["border-style"];borderStyle||(borderStyle="none");const borderWidthArray=borderWidth.split("px");let normalizedBorderWidth="";for(const strvalue of borderWidthArray){let valueNumber=parseFloat(strvalue);isNaN(valueNumber)||(normalizedBorderWidth+=valueNumber*creatorZoomFactor+"px ")}const borderClone={"border-width":normalizedBorderWidth,"border-style":borderStyle,"border-color":"transparent"};if(TcHmi.StyleProvider.setSimpleElementStyle(ctrlMeta.jHierarchyControlposition,borderClone),TcHmi.StyleProvider.setSimpleElementStyle(ctrlMeta.jHierarchyAnchorContainer,borderClone),tco.getParent()&&ctrlMeta.parent&&ctrlMeta.parent.isGridControl&&0===ctrlMeta.jHierarchyControlposition.parent().length){let targetRowIndex=tco.getGridRowIndex();(!targetRowIndex||targetRowIndex>=(tco.getParent()?.__rowOptions?.length??0))&&(targetRowIndex=0);let targetColumnIndex=tco.getGridColumnIndex();(!targetColumnIndex||targetColumnIndex>=(tco.getParent()?.__columnOptions?.length??0))&&(targetColumnIndex=0);const targetCell=ctrlMeta.parent.jHierarchyControlposition.children("[data-tchmi-creator-grid-rowindex="+targetRowIndex+"][data-tchmi-creator-grid-cellindex="+targetColumnIndex+"]");0===targetCell.length&&TcHmi.Log.error("[Source=Framework, Module=TcHmi.System.Engineering.DesignerModeMasterHighlightManager] Fatal internal error: Could not find target grid cell for "+tco.getParent()?.getId()+" to attach highlight container."),ctrlMeta.jHierarchyControlposition.parent().is(targetCell)||(targetCell.append(ctrlMeta.jOriginalPosition),targetCell.append(ctrlMeta.jControlPosition),targetCell.append(ctrlMeta.jHierarchyControlposition),targetCell.append(ctrlMeta.jAnchorContainer),targetCell.append(ctrlMeta.jHierarchyAnchorContainer))}}for(const[creatorCell,creatorCellStyle]of dimensionCacheGridCells)TcHmi.StyleProvider.setSimpleElementStyle(creatorCell,creatorCellStyle)}__selectorGripsId=["TopLeft","TopCenter","TopRight","CenterRight","BottomRight","BottomCenter","BottomLeft","CenterLeft"];__selectorGrips=["nwse","ns","nesw","ew","nwse","ns","nesw","ew"];updateGripCursors(ctrlMeta){let i,steps=Math.round(((ctrlMeta.relativeControlRotation??0)+(ctrlMeta.absoluteParentRotation??0))*(8/360));for(steps<0&&(steps+=8),i=0;i<8;i++){const index=(i+steps)%8;TcHmi.StyleProvider.setSimpleElementStyle(ctrlMeta.jAnchorContainer[0].querySelectorAll(`[data-tchmi-creator-anchor-name="${this.__selectorGripsId[i]}"]`),"cursor",this.__selectorGrips[index]+"-resize")}}processHighlightType(ctrlMeta){ctrlMeta.isSelected?ctrlMeta.jControlPosition[0].classList.remove("tchmi-creator-active-highlight"):ctrlMeta.jControlPosition[0].classList.toggle("tchmi-creator-active-highlight",this.__highlightContainerVisibility),ctrlMeta.jControlPosition[0].classList.toggle("tchmi-creator-control-selected",ctrlMeta.isSelected),ctrlMeta.jOriginalPosition[0].classList.toggle("tchmi-creator-control-selected",ctrlMeta.isSelected),ctrlMeta.jAnchorContainer[0].classList.toggle("tchmi-creator-control-selected",ctrlMeta.isSelected),ctrlMeta.jOriginalPosition[0].classList.toggle("tchmi-creator-active-highlight",this.__highlightContainerVisibility)}updateEngineeringStyles(){const linkElem=document.querySelector('link[href*="StyleEngineering.css"]');if(!linkElem?.sheet)return;const settings=designerModeManager.getSettings(),cssRules=linkElem.sheet.cssRules[0];if(":root"!==cssRules.selectorText)throw new SyntaxError("StyleEngineering.css has invalid format: First selector has to be :root");const cssStyle=cssRules.style;if(!(cssStyle.getPropertyValue("--tchmi-designer-control-untransformed-color")&&cssStyle.getPropertyValue("--tchmi-designer-control-unselected-color")&&cssStyle.getPropertyValue("--tchmi-designer-control-selected-color")&&cssStyle.getPropertyValue("--tchmi-designer-control-selected-secondary-color")&&cssStyle.getPropertyValue("--tchmi-designer-control-snap-color")))throw new SyntaxError("StyleEngineering.css has invalid format: CSS custom properties missing");const systemColorToRgba=function(color){return"rgba("+color.r+","+color.g+","+color.b+","+color.a/255+")"};settings.untransformedColor&&cssStyle.setProperty("--tchmi-designer-control-untransformed-color",systemColorToRgba(settings.untransformedColor)),settings.unSelectedHighlightColor&&cssStyle.setProperty("--tchmi-designer-control-unselected-color",systemColorToRgba(settings.unSelectedHighlightColor)),settings.selectionHighlightColor&&cssStyle.setProperty("--tchmi-designer-control-selected-color",systemColorToRgba(settings.selectionHighlightColor)),settings.selectedSecondaryColor&&cssStyle.setProperty("--tchmi-designer-control-selected-secondary-color",systemColorToRgba(settings.selectedSecondaryColor)),settings.snapHighlightColor&&cssStyle.setProperty("--tchmi-designer-control-snap-color",systemColorToRgba(settings.snapHighlightColor)),cssStyle.setProperty("--tchmi-designer-control-remote-snap-distance",settings.snapDistanceToControls*(rootControlManager?.getCreatorZoomFactor()??1)+"px"),settings.theme?.ChessboardLight&&cssStyle.setProperty("--tchmi-designer-vs-theme-chessboard-light",systemColorToRgba(settings.theme.ChessboardLight)),settings.theme?.ChessboardDark&&cssStyle.setProperty("--tchmi-designer-vs-theme-chessboard-dark",systemColorToRgba(settings.theme.ChessboardDark));let vsDarkTheme=!1;settings.theme?.ThemeName?vsDarkTheme="Dark"===settings.theme.ThemeName:settings.theme?.ChessboardDark&&(vsDarkTheme=(settings.theme.ChessboardDark.r??246)<100&&(settings.theme.ChessboardDark.g??246)<100&&(settings.theme.ChessboardDark.b??246)<100),document.documentElement.classList.toggle("tchmi-visual-studio-dark",vsDarkTheme),settings.theme?.ThemeName||(document.body.style.overflow="hidden")}createControlPosition(relatedControl,zindex){let controlId=relatedControl.getId(),typeDisplayName=relatedControl.getType(),module=TcHmi.System.Data.Modules.controls.map.get(typeDisplayName);module&&module.error===TcHmi.Errors.NONE&&module.descriptionExpanded&&(typeDisplayName=module.descriptionExpanded.displayName||"");let highlighterElement=this.__cloneSource.controlPosition.cloneNode(!0);highlighterElement.setAttribute("data-tchmi-creator-target-control",controlId),highlighterElement.style.zIndex=zindex.toString();let child=highlighterElement.firstElementChild;return child.title=controlId+": "+typeDisplayName,child.firstElementChild.textContent=controlId,child.setAttribute("data-tchmi-creator-target-control",controlId),$(highlighterElement)}createHierarchyControlPosition(relatedControl,zindex){let controlId=relatedControl.getId(),highlighterElement=this.__cloneSource.hierarchyControlPosition.cloneNode(!0);return highlighterElement.setAttribute("data-tchmi-creator-target-control",controlId),highlighterElement.style.zIndex=zindex.toString(),$(highlighterElement)}createOriginalPosition(relatedControl,zindex){let controlId=relatedControl.getId(),highlighterElement=this.__cloneSource.originalPosition.cloneNode(!0);return highlighterElement.setAttribute("data-tchmi-creator-target-control",controlId),highlighterElement.style.zIndex=zindex.toString(),$(highlighterElement)}createAnchorContainer(relatedControl,zindex,locked){let controlId=relatedControl.getId(),highlighterElement=this.__cloneSource.anchorContainer.cloneNode(!0);return highlighterElement.setAttribute("data-tchmi-creator-target-control",controlId),highlighterElement.style.zIndex=zindex.toString(),locked&&highlighterElement.classList.add("tchmi-creator-control-locked"),$(highlighterElement)}createHierarchyAnchorContainer(relatedControl,zindex,locked){let controlId=relatedControl.getId(),highlighterElement=this.__cloneSource.hierarchyAnchorContainer.cloneNode(!0);return highlighterElement.setAttribute("data-tchmi-creator-target-control",controlId),highlighterElement.style.zIndex=zindex.toString(),locked&&highlighterElement.classList.add("tchmi-creator-control-locked"),$(highlighterElement)}createGridHighlighter(gridControl,ctrlMeta){if(!ctrlMeta)return;if(!gridControl.__rowOptions)return void TcHmi.Log.error("[Source=Framework, Module=TcHmi.System.Engineering.DesignerModeMasterHighlightManager] Grid control "+gridControl.getId()+" has invalid Row Options.");if(!gridControl.__columnOptions)return void TcHmi.Log.error("[Source=Framework, Module=TcHmi.System.Engineering.DesignerModeMasterHighlightManager] Grid control "+gridControl.getId()+" has invalid Column Options.");const oldGridcells=ctrlMeta.jHierarchyControlposition.children(".tchmi-creator-hierarchy-gridcellposition");oldGridcells.children().detach(),oldGridcells.remove(),ctrlMeta.jControlPosition.children(".tchmi-creator-gridcell").remove();let zIndexControlposition=TcHmi.StyleProvider.getSimpleElementStyle(ctrlMeta.jControlPosition,"z-index"),hierarchyGridcellpositionCollection=$(),gridcellCollection=$(),tempDiv=document.createElement("div");for(let i=0;i<(gridControl.__rowOptions?.length??0);i++)for(let j=0;j<(gridControl.__columnOptions?.length??0);j++){tempDiv.innerHTML=`<div data-tchmi-creator-target-control="${gridControl.getId()}"\n                                                class="tchmi-creator-hierarchy-gridcellposition tchmi-box"\n                                                style="z-index:${zIndexControlposition["z-index"]}"\n                                                data-tchmi-creator-grid-rowindex="${i}" data-tchmi-creator-grid-cellindex="${j}">\n                                                </div>`;const hierarchyGridcell=$(tempDiv.firstElementChild);hierarchyGridcellpositionCollection=hierarchyGridcellpositionCollection.add(hierarchyGridcell),tempDiv.innerHTML=`<div data-tchmi-creator-target-control="${gridControl.getId()}"\n                                                class="tchmi-creator-gridcell tchmi-box"\n                                                style="z-index:${zIndexControlposition["z-index"]}"\n                                                data-tchmi-creator-grid-rowindex="${i}" data-tchmi-creator-grid-cellindex="${j}">\n                                                </div>`;const highlightGridcell=$(tempDiv.firstElementChild);hierarchyManager.registerContainerElement(highlightGridcell),gridcellCollection=gridcellCollection.add(highlightGridcell)}ctrlMeta.jHierarchyControlposition.append(hierarchyGridcellpositionCollection),ctrlMeta.jControlPosition.append(gridcellCollection)}}})();export{DesignerModeMasterControlHighlightManager};function insertHighlighterInDom(tco,tcoPar,ctrlMeta){if(ctrlMeta.parent&&tcoPar){const nextCtrl=tco.getElement().next();let nextCtrlMeta;if(0!==nextCtrl.length&&(nextCtrlMeta=metaDataManager.getControlMetaData(nextCtrl[0].id)),nextCtrlMeta&&nextCtrlMeta.jOriginalPosition[0].parentElement)nextCtrlMeta.jOriginalPosition.before(ctrlMeta.jOriginalPosition),nextCtrlMeta.jControlPosition.before(ctrlMeta.jControlPosition),nextCtrlMeta.jControlPosition.before(ctrlMeta.jHierarchyControlposition),nextCtrlMeta.jAnchorContainer.before(ctrlMeta.jAnchorContainer),nextCtrlMeta.jAnchorContainer.before(ctrlMeta.jHierarchyAnchorContainer);else if(ctrlMeta.parent.isGridControl){let targetRowIndex=tco.getGridRowIndex();(!targetRowIndex||targetRowIndex>=tcoPar.__rowOptions.length)&&(targetRowIndex=0);let targetColumnIndex=tco.getGridColumnIndex();(!targetColumnIndex||targetColumnIndex>=tcoPar.__columnOptions.length)&&(targetColumnIndex=0);const targetCell=ctrlMeta.parent.jHierarchyControlposition.children("[data-tchmi-creator-grid-rowindex="+targetRowIndex+"][data-tchmi-creator-grid-cellindex="+targetColumnIndex+"]");0===targetCell.length&&TcHmi.Log.errorEx(`[Source=Framework, Module=TcHmi.System.Engineering.DesignerModeManager] Fatal internal error: Could not find target grid cell for ${tco.getParent().getId()} to attach highlight container.`),targetCell.append(ctrlMeta.jOriginalPosition),targetCell.append(ctrlMeta.jControlPosition),targetCell.append(ctrlMeta.jHierarchyControlposition),targetCell.append(ctrlMeta.jAnchorContainer),targetCell.append(ctrlMeta.jHierarchyAnchorContainer)}else ctrlMeta.parent.jHierarchyControlposition.append(ctrlMeta.jOriginalPosition),ctrlMeta.parent.jHierarchyControlposition.append(ctrlMeta.jControlPosition),ctrlMeta.parent.jHierarchyControlposition.append(ctrlMeta.jHierarchyControlposition),ctrlMeta.parent.jHierarchyAnchorContainer.append(ctrlMeta.jAnchorContainer),ctrlMeta.parent.jHierarchyAnchorContainer.append(ctrlMeta.jHierarchyAnchorContainer)}else{const highlightingContainer=rootControlManager.getViewPortHighlightingContainer();highlightingContainer.append(ctrlMeta.jOriginalPosition[0],ctrlMeta.jControlPosition[0],ctrlMeta.jHierarchyControlposition[0],ctrlMeta.jAnchorContainer[0],ctrlMeta.jHierarchyAnchorContainer[0]);const backgroundTarget=rootControlManager.getBackgroundTarget();document.body.append(backgroundTarget,highlightingContainer)}}export const highlightManager=new DesignerModeMasterControlHighlightManager;