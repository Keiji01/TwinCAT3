var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};let highlightManager,rootControlManager;TCHMI_DESIGNER&&(import("./DesignerModeMasterControlHighlightMngr.js").then(module=>{highlightManager=module.highlightManager}),import("./DesignerModeMasterRootControlMngr.js").then(module=>{rootControlManager=module.rootControlManager}));let DesignerModeControlMetaDataManager=(()=>{var _a;let ___onControlDetached_decorators,_instanceExtraInitializers=[];return class{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onControlDetached_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],__esDecorate(this,null,___onControlDetached_decorators,{kind:"method",name:"__onControlDetached",static:!1,private:!1,access:{has:obj=>"__onControlDetached"in obj,get:obj=>obj.__onControlDetached},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}constructor(){TcHmi.EventProvider.register("onControlDetached",this.__onControlDetached)}__controlsMetaData=(__runInitializers(this,_instanceExtraInitializers),new Map);__selectedControlsMetaData=new Map;__selectedControlsMetaDataHasChanged=!1;__changedControlsMetaData=new Map;__changedControlsMetaDataHasChanged=!1;__selectedControlIdsWithChildren=[];register(ctrlMeta){this.__controlsMetaData.set(ctrlMeta.id,ctrlMeta)}unregister(tcoId){this.__controlsMetaData.has(tcoId)&&(TCHMI_DESIGNER&&highlightManager&&rootControlManager&&(highlightManager.handleControlRemoved(this.__controlsMetaData.get(tcoId)),rootControlManager.setCreatorViewPortPosition(TcHmi.System.Services.viewManager.getView()),highlightManager.requestAsyncHighlighterUpdate()),this.__controlsMetaData.delete(tcoId)),this.__selectedControlsMetaData.has(tcoId)&&(this.__selectedControlsMetaData.delete(tcoId),this.rebuildCacheAndClasses())}__onControlDetached(_event,tco){null!=tco&&this.unregister(tco.getId())}getControlMetaData(id){return null==id?this.__controlsMetaData:this.__controlsMetaData.get(id)}refreshControlMetaData(idOrControl){let ctrlMeta,id;if("string"==typeof idOrControl)ctrlMeta=this.getControlMetaData(idOrControl),id=idOrControl;else{if(!idOrControl){for(const ctrlMeta of this.__controlsMetaData.values())this.refreshControlMetaData(ctrlMeta);return null}ctrlMeta=idOrControl,id=ctrlMeta.id}if(!ctrlMeta||!highlightManager)return null;const tco=TcHmi.Controls.get(id);if(!tco)return TcHmi.Log.error(`[Source=Framework, Module=TcHmi.System.Engineering.DesignerModeControlMetaDataManager] Failed to refresh Control Meta Data of control "${id}": Not found in control cache.\n`),null;const element=tco.getElement();ctrlMeta.controlAttributeDimension=this.__getControlAttributeDimension(tco),ctrlMeta.relativeControlRotation=this.__getRelativeRotation(element[0]),ctrlMeta.absoluteParentRotation=this.__getAbsoluteRotation(element.offsetParent()[0]),ctrlMeta.controlCssPixelDimension=this.__getControlCssPixelDimension(tco);let ctrlAsyncData=highlightManager.requestAsyncHighlighterUpdateForControl(tco);return ctrlAsyncData.moved=!0,ctrlAsyncData.resized=!0,ctrlMeta}getChangedControlsMetaData(){return this.__changedControlsMetaData}resetChangedControlsMetaData(){this.__changedControlsMetaDataHasChanged=!1,this.__changedControlsMetaData.clear()}getChangedControlsMetaDataHasChanged(){return this.__changedControlsMetaDataHasChanged}addChangedControlsMetaData(ctrlMeta){this.__changedControlsMetaData.has(ctrlMeta.id)||(this.__changedControlsMetaDataHasChanged=!0),this.__changedControlsMetaData.set(ctrlMeta.id,ctrlMeta)}getSelectedControlsMetaData(){return this.__selectedControlsMetaData}resetSelectedControlsMetaDataHasChanged(){this.__selectedControlsMetaDataHasChanged=!1}getSelectedControlsMetaDataHasChanged(){return this.__selectedControlsMetaDataHasChanged}selectControl({ctrlMeta,rebuildCacheAndClasses="all"}){this.__selectedControlsMetaData.has(ctrlMeta.id)||(this.__selectedControlsMetaDataHasChanged=!0),this.__selectedControlsMetaData.set(ctrlMeta.id,ctrlMeta);const tco=TcHmi.Controls.get(ctrlMeta.id);if(!tco)return;const hierarchy=TcHmi.System.resolveControlHierarchy(tco,null),getAllChildren=h=>{const ctrl=h.ctrl;if(this.__selectedControlIdsWithChildren.includes(ctrl.getId())||this.__selectedControlIdsWithChildren.push(ctrl.getId()),ctrl.getIsContainerControl()&&!(ctrl.getElement()?.[0]?.hasAttribute("data-tchmi-designer-ignore")??1))for(let i=0,ii=h.children_hierarchy.length;i<ii;i++)getAllChildren(h.children_hierarchy[i])};getAllChildren(hierarchy),"none"===rebuildCacheAndClasses||("this"===rebuildCacheAndClasses?this.rebuildCacheAndClasses(ctrlMeta):"all"===rebuildCacheAndClasses&&this.rebuildCacheAndClasses())}unselectControl({ctrlMeta,rebuildCacheAndClasses="all"}){this.__selectedControlsMetaData.has(ctrlMeta.id)&&(this.__selectedControlsMetaDataHasChanged=!0),this.__selectedControlsMetaData.delete(ctrlMeta.id),"all"===rebuildCacheAndClasses&&this.rebuildCacheAndClasses()}getSelectedControlIdsWithChildren(){return this.__selectedControlIdsWithChildren}rebuildCacheAndClasses(ctrlMeta){if(void 0===ctrlMeta){this.__selectedControlIdsWithChildren=[];for(const ctrlMeta2 of this.__controlsMetaData.values())ctrlMeta2.jControlPosition[0].classList.remove("tchmi-creator-childcontrol-selected");for(const selectedCtrlMeta of this.__selectedControlsMetaData.values())selectedCtrlMeta.isPartialRoot||this.rebuildCacheAndClasses(selectedCtrlMeta);return}if(ctrlMeta.isPartialRoot)return;ctrlMeta.isSelected&&ctrlMeta.parent&&ctrlMeta.parent.jControlPosition[0].classList.add("tchmi-creator-childcontrol-selected");const tco=TcHmi.Controls.get(ctrlMeta.id);if(!tco)return;const hierarchy=TcHmi.System.resolveControlHierarchy(tco,null),getAllChildren=h=>{const ctrl=h.ctrl;if(this.__selectedControlIdsWithChildren.includes(ctrl.getId())||this.__selectedControlIdsWithChildren.push(ctrl.getId()),ctrl.getIsContainerControl()&&!(ctrl.getElement()?.[0]?.hasAttribute("data-tchmi-designer-ignore")??1))for(let i=0,ii=h.children_hierarchy.length;i<ii;i++)getAllChildren(h.children_hierarchy[i])};getAllChildren(hierarchy)}__getControlAttributeDimension(tco){return{topValue:tco.getTop()??null,topUnit:tco.getTopUnit()??"px",leftValue:tco.getLeft()??null,leftUnit:tco.getLeftUnit()??"px",widthValue:tco.getWidth()??null,widthUnit:tco.getWidthUnit()??"px",minWidthValue:tco.getMinWidth()??null,minWidthUnit:tco.getMinWidthUnit()??"px",maxWidthValue:tco.getMaxWidth()??null,maxWidthUnit:tco.getMaxWidthUnit()??"px",widthMode:tco.getWidthMode()??"Value",rightValue:tco.getRight()??null,rightUnit:tco.getRightUnit()??"px",heightValue:tco.getHeight()??null,heightUnit:tco.getHeightUnit()??"px",heightMode:tco.getHeightMode()??"Value",minHeightValue:tco.getMinHeight()??null,minHeightUnit:tco.getMinHeightUnit()??"px",maxHeightValue:tco.getMaxHeight()??null,maxHeightUnit:tco.getMaxHeightUnit()??"px",bottomValue:tco.getBottom()??null,bottomUnit:tco.getBottomUnit()??"px"}}__getControlCssPixelDimension(tco){let res={width:null,height:null,left:null,top:null,right:null,bottom:null},element=tco.getElement();if(element){let width=element.css("width");width&&(res.width=parseFloat(width));let height=element.css("height");height&&(res.height=parseFloat(height));let left=element.css("left");left&&(res.left=parseFloat(left));let top=element.css("top");top&&(res.top=parseFloat(top));let right=element.css("right");right&&(res.right=parseFloat(right));let bottom=element.css("bottom");bottom&&(res.bottom=parseFloat(bottom))}return res}__getAbsoluteRotation(jElem){if(!jElem)return 0;let angleParent=0;const offsetParent=jElem.parentElement;!offsetParent||offsetParent.nodeName&&"HTML"===offsetParent.tagName||(angleParent=this.__getAbsoluteRotation(offsetParent));return angleParent+this.__getRelativeRotation(jElem)}__getRelativeRotation(Elem){if(!Elem)return 0;const tr=TcHmi.StyleProvider.getComputedElementStyle(Elem,"transform").transform;let angle=0;if(tr&&"none"!==tr){const arrMatrixContent=tr.substring(tr.indexOf("(")+1,tr.lastIndexOf(")")).split(",");if(6===arrMatrixContent.length){const a=parseFloat(arrMatrixContent[0]),b=parseFloat(arrMatrixContent[1]);angle=Math.round(Math.atan2(b,a)*(180/Math.PI))}}return angle}}})();export{DesignerModeControlMetaDataManager};export const metaDataManager=new DesignerModeControlMetaDataManager;